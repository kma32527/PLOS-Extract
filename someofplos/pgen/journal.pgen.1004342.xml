<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE article
  PUBLIC "-//NLM//DTD Journal Publishing DTD v3.0 20080202//EN" "http://dtd.nlm.nih.gov/publishing/3.0/journalpublishing3.dtd">
<article xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xlink="http://www.w3.org/1999/xlink" article-type="research-article" dtd-version="3.0" xml:lang="en">
<front>
<journal-meta>
<journal-id journal-id-type="publisher-id">plos</journal-id>
<journal-id journal-id-type="nlm-ta">PLoS Genet</journal-id>
<journal-id journal-id-type="pmc">plosgen</journal-id><journal-title-group>
<journal-title>PLoS Genetics</journal-title></journal-title-group>
<issn pub-type="ppub">1553-7390</issn>
<issn pub-type="epub">1553-7404</issn>
<publisher>
<publisher-name>Public Library of Science</publisher-name>
<publisher-loc>San Francisco, USA</publisher-loc></publisher>
</journal-meta>
<article-meta>
<article-id pub-id-type="publisher-id">PGENETICS-D-13-03319</article-id>
<article-id pub-id-type="doi">10.1371/journal.pgen.1004342</article-id>
<article-categories><subj-group subj-group-type="heading"><subject>Research Article</subject></subj-group><subj-group subj-group-type="Discipline-v2"><subject>Biology and life sciences</subject><subj-group><subject>Computational biology</subject><subj-group><subject>Genome analysis</subject><subj-group><subject>Genome scans</subject></subj-group></subj-group><subj-group><subject>Evolutionary modeling</subject></subj-group></subj-group><subj-group><subject>Ecology</subject><subj-group><subject>Ecological metrics</subject><subj-group><subject>Population size</subject><subj-group><subject>Effective population size</subject></subj-group></subj-group></subj-group></subj-group><subj-group><subject>Evolutionary biology</subject><subj-group><subject>Evolutionary processes</subject><subj-group><subject>Genetic drift</subject><subject>Natural selection</subject></subj-group></subj-group><subj-group><subject>Population genetics</subject><subj-group><subject>Gene flow</subject><subject>Genetic polymorphism</subject><subject>Haplotypes</subject><subject>Neutral theory</subject></subj-group></subj-group></subj-group><subj-group><subject>Genetics</subject><subj-group><subject>Genomics</subject><subject>Human genetics</subject><subject>Mutation</subject></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v2"><subject>Physical sciences</subject><subj-group><subject>Mathematics</subject><subj-group><subject>Statistics (mathematics)</subject><subj-group><subject>Biostatistics</subject></subj-group></subj-group></subj-group></subj-group></article-categories>
<title-group>
<article-title>Genome-Wide Inference of Ancestral Recombination Graphs</article-title>
<alt-title alt-title-type="running-head">Genome-Wide ARG Inference</alt-title>
</title-group>
<contrib-group>
<contrib contrib-type="author" xlink:type="simple"><name name-style="western"><surname>Rasmussen</surname><given-names>Matthew D.</given-names></name><xref ref-type="aff" rid="aff1"><sup>1</sup></xref><xref ref-type="corresp" rid="cor1"><sup>*</sup></xref><xref ref-type="fn" rid="fn1"><sup>¤</sup></xref></contrib>
<contrib contrib-type="author" xlink:type="simple"><name name-style="western"><surname>Hubisz</surname><given-names>Melissa J.</given-names></name><xref ref-type="aff" rid="aff1"><sup>1</sup></xref></contrib>
<contrib contrib-type="author" xlink:type="simple"><name name-style="western"><surname>Gronau</surname><given-names>Ilan</given-names></name><xref ref-type="aff" rid="aff1"><sup>1</sup></xref></contrib>
<contrib contrib-type="author" xlink:type="simple"><name name-style="western"><surname>Siepel</surname><given-names>Adam</given-names></name><xref ref-type="aff" rid="aff1"><sup>1</sup></xref><xref ref-type="aff" rid="aff2"><sup>2</sup></xref><xref ref-type="corresp" rid="cor1"><sup>*</sup></xref></contrib>
</contrib-group>
<aff id="aff1"><label>1</label><addr-line>Department of Biological Statistics and Computational Biology, Cornell University, Ithaca, New York, United States of America</addr-line></aff>
<aff id="aff2"><label>2</label><addr-line>European Molecular Biology Laboratory, European Bioinformatics Institute, Wellcome Trust Genome Campus, Hinxton, Cambs, United Kingdom</addr-line></aff>
<contrib-group>
<contrib contrib-type="editor" xlink:type="simple"><name name-style="western"><surname>Coop</surname><given-names>Graham</given-names></name>
<role>Editor</role>
<xref ref-type="aff" rid="edit1"/></contrib>
</contrib-group>
<aff id="edit1"><addr-line>University of California Davis, United States of America</addr-line></aff>
<author-notes>
<corresp id="cor1">* E-mail: <email xlink:type="simple">rasmussen@cornell.edu</email> (MDR); <email xlink:type="simple">acs4@cornell.edu</email> (AS)</corresp>
<fn fn-type="conflict"><p>The authors have declared that no competing interests exist.</p></fn>
<fn fn-type="con"><p>Conceived and designed the experiments: MDR MJH IG AS. Performed the experiments: MDR MJH IG. Analyzed the data: MDR MJH IG AS. Wrote the paper: MDR MJH IG AS. Designed and implemented the ARGweaver software: MDR.</p></fn>
<fn id="fn1" fn-type="current-aff"><label>¤</label><p>Current address: Counsyl, South San Francisco, California, United States of America</p></fn>
</author-notes>
<pub-date pub-type="collection"><month>5</month><year>2014</year></pub-date>
<pub-date pub-type="epub"><day>15</day><month>5</month><year>2014</year></pub-date>
<volume>10</volume>
<issue>5</issue>
<elocation-id>e1004342</elocation-id>
<history>
<date date-type="received"><day>3</day><month>12</month><year>2013</year></date>
<date date-type="accepted"><day>17</day><month>3</month><year>2014</year></date>
</history>
<permissions>
<copyright-year>2014</copyright-year>
<copyright-holder>Rasmussen et al</copyright-holder><license xlink:type="simple"><license-p>This is an open-access article distributed under the terms of the <ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by/4.0/" xlink:type="simple">Creative Commons Attribution License</ext-link>, which permits unrestricted use, distribution, and reproduction in any medium, provided the original author and source are credited.</license-p></license></permissions>
<abstract>
<p>The complex correlation structure of a collection of orthologous DNA sequences is uniquely captured by the “ancestral recombination graph” (ARG), a complete record of coalescence and recombination events in the history of the sample. However, existing methods for ARG inference are computationally intensive, highly approximate, or limited to small numbers of sequences, and, as a consequence, explicit ARG inference is rarely used in applied population genomics. Here, we introduce a new algorithm for ARG inference that is efficient enough to apply to dozens of complete mammalian genomes. The key idea of our approach is to sample an ARG of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e001" xlink:type="simple"/></inline-formula> chromosomes conditional on an ARG of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e002" xlink:type="simple"/></inline-formula> chromosomes, an operation we call “threading.” Using techniques based on hidden Markov models, we can perform this threading operation exactly, up to the assumptions of the sequentially Markov coalescent and a discretization of time. An extension allows for threading of subtrees instead of individual sequences. Repeated application of these threading operations results in highly efficient Markov chain Monte Carlo samplers for ARGs. We have implemented these methods in a computer program called <italic>ARGweaver</italic>. Experiments with simulated data indicate that <italic>ARGweaver</italic> converges rapidly to the posterior distribution over ARGs and is effective in recovering various features of the ARG for dozens of sequences generated under realistic parameters for human populations. In applications of <italic>ARGweaver</italic> to 54 human genome sequences from Complete Genomics, we find clear signatures of natural selection, including regions of unusually ancient ancestry associated with balancing selection and reductions in allele age in sites under directional selection. The patterns we observe near protein-coding genes are consistent with a primary influence from background selection rather than hitchhiking, although we cannot rule out a contribution from recurrent selective sweeps.</p>
</abstract>
<abstract abstract-type="summary"><title>Author Summary</title>
<p>The unusual and complex correlation structure of population samples of genetic sequences presents a fundamental statistical challenge that pervades nearly all areas of population genetics. Historical recombination events produce an intricate network of intertwined genealogies, which impedes demography inference, the detection of natural selection, association mapping, and other applications. It is possible to capture these complex relationships using a representation called the ancestral recombination graph (ARG), which provides a complete description of coalescence and recombination events in the history of the sample. However, previous methods for ARG inference have not been adequately fast and accurate for practical use with large-scale genomic sequence data. In this article, we introduce a new algorithm for ARG inference that has vastly improved scaling properties. Our algorithm is implemented in a computer program called <italic>ARGweaver</italic>, which is fast enough to be applied to sequences megabases in length. With the aid of a large computer cluster, <italic>ARGweaver</italic> can be used to sample full ARGs for entire mammalian genome sequences. We show that <italic>ARGweaver</italic> performs well in simulation experiments and demonstrate that it can be used to provide new insights about both demographic processes and natural selection when applied to real human genome sequence data.</p>
</abstract>
<funding-group><funding-statement>This project was supported by a David and Lucile Packard Fellowship for Science and Engineering (to AS), NIH/NIGMS grant GM102192 (to AS), and postdoctoral fellowships from the Cornell Center for Comparative and Population Genomics (to MDR and IG). The funders had no role in study design, data collection and analysis, decision to publish, or preparation of the manuscript.</funding-statement></funding-group><counts><page-count count="27"/></counts></article-meta>
</front>
<body><sec id="s1">
<title>Introduction</title>
<p>At each genomic position, orthologous DNA sequences drawn from one or more populations are related by a branching structure known as a genealogy <xref ref-type="bibr" rid="pgen.1004342-Hein1">[1]</xref>, <xref ref-type="bibr" rid="pgen.1004342-Wakeley1">[2]</xref>. Historical recombination events lead to changes in these genealogies from one genomic position to the next, resulting in a correlation structure that is complex, analytically intractable, and poorly approximated by standard representations of high-dimensional data. Over a period of many decades, these unique features of genetic data have inspired numerous innovative techniques for probabilistic modeling and statistical inference <xref ref-type="bibr" rid="pgen.1004342-Fisher1">[3]</xref>–<xref ref-type="bibr" rid="pgen.1004342-Kingman1">[9]</xref>, and, more recently, they have led to a variety of creative approaches that achieve computational tractability by operating on various summaries of the data <xref ref-type="bibr" rid="pgen.1004342-Sawyer1">[10]</xref>–<xref ref-type="bibr" rid="pgen.1004342-Harris1">[17]</xref>. Nevertheless, none of these approaches fully captures the correlation structure of collections of DNA sequences, which inevitably leads to limitations in power, accuracy, and generality in genetic analysis.</p>
<p>In principle, the correlation structure of a collection of colinear orthologous sequences can be fully described by a network known as an <italic>ancestral recombination graph</italic> (ARG) <xref ref-type="bibr" rid="pgen.1004342-Hudson1">[18]</xref>–<xref ref-type="bibr" rid="pgen.1004342-Griffiths2">[20]</xref>. An ARG provides a record of all coalescence and recombination events since the divergence of the sequences under study and specifies a complete genealogy at each genomic position (<xref ref-type="fig" rid="pgen-1004342-g001">Figure 1A</xref>). In many senses, the ARG is the ideal data structure for population genomic analysis. Indeed, if an accurate ARG could be obtained, many problems of interest today—such as the estimation of recombination rates or ancestral effective population sizes—would become trivial, while many other problems—such as the estimation of population divergence times, rates of gene flow between populations, or the detection of selective sweeps—would be greatly simplified. Various data representations in wide use today, including the site frequency spectrum, principle components, haplotype maps, and identity by descent spectra, can be thought of as low-dimensional summaries of the ARG and are strictly less informative.</p>
<fig id="pgen-1004342-g001" position="float"><object-id pub-id-type="doi">10.1371/journal.pgen.1004342.g001</object-id><label>Figure 1</label><caption>
<title>An ancestral recombination graph (ARG) for four sequences.</title>
<p>(A) Going backwards in time (from bottom to top), the graph shows how lineages that lead to modern-day chromosomes (bottom) either “coalesce” into common ancestral lineages (dark blue circles), or split into the distinct parental chromosomes that were joined (in forward time) by recombination events (light blue circles). Each coalescence and recombination event is associated with a specific time (dashed lines), and each recombination event is also associated with a specific breakpoint along the chromosomes (here, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e003" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e004" xlink:type="simple"/></inline-formula>). Each non-recombining interval of the sequences (shown in red, green, and purple) corresponds to a “local tree” embedded in the ARG (shown in matching colors). Recombinations cause these trees to change along the length of the sequences, making the correlation structure of the data set highly complex. The ARG for four sequences is denoted <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e005" xlink:type="simple"/></inline-formula> in our notation. (B) Representation of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e006" xlink:type="simple"/></inline-formula> in terms of a sequence of local trees <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e007" xlink:type="simple"/></inline-formula> and recombination events <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e008" xlink:type="simple"/></inline-formula>. A local tree <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e009" xlink:type="simple"/></inline-formula> is shown for each nonrecombining segment in colors matching those in (A). Each tree, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e010" xlink:type="simple"/></inline-formula>, can be viewed as being constructed from the previous tree, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e011" xlink:type="simple"/></inline-formula>, by placing a recombination event along the branches of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e012" xlink:type="simple"/></inline-formula> (light blue circles), breaking the branch at this location, and then allowing the broken lineage to re-coalesce to the rest of the tree (dashed lines in matching colors; new coalescence points are shown in gray). Together, the local trees and recombinations provide a complete description of the ARG. The Sequentially Markov Coalescent (SMC) approximate the full coalescent-with-recombination by assuming that <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e013" xlink:type="simple"/></inline-formula> is statistically independent of all previous trees given <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e014" xlink:type="simple"/></inline-formula>. (C) An alignment of four sequences, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e015" xlink:type="simple"/></inline-formula>, corresponding to the linearized ARG shown in (B). For simplicity, only the derived alleles at polymorphic sites are shown. The sequences are assumed to be generated by a process that samples an ancestral sequences from a suitable background distribution, then allows each nonrecombining segment of this sequence to mutate stochastically along the branches of the corresponding local tree. Notice that the correlation structure of the sequences is fully determined by the local trees; that is, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e016" xlink:type="simple"/></inline-formula> is conditionally independent of the recombinations <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e017" xlink:type="simple"/></inline-formula> given the local trees <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e018" xlink:type="simple"/></inline-formula>.</p>
</caption><graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pgen.1004342.g001" position="float" xlink:type="simple"/></fig>
<p>An extension of the widely used coalescent framework <xref ref-type="bibr" rid="pgen.1004342-Hein1">[1]</xref>, <xref ref-type="bibr" rid="pgen.1004342-Wakeley1">[2]</xref>, <xref ref-type="bibr" rid="pgen.1004342-Kingman1">[9]</xref> that includes recombination <xref ref-type="bibr" rid="pgen.1004342-Hudson2">[21]</xref> is regarded as an adequately rich generative process for ARGs in most settings of interest. While simulating an ARG under this model is fairly straightforward, however, using it to reconstruct an ARG from sequence data is notoriously difficult. Furthermore, the data are generally only weakly informative about the ARG, so it is often desirable to regard it as a “nuisance” variable to be integrated out during statistical inference (e.g., <xref ref-type="bibr" rid="pgen.1004342-Fearnhead1">[22]</xref>). During the past two decades, various attempts have been made to perform explicit inference of ARGs using techniques such as importance sampling <xref ref-type="bibr" rid="pgen.1004342-Griffiths1">[19]</xref>, <xref ref-type="bibr" rid="pgen.1004342-Fearnhead1">[22]</xref> (see also <xref ref-type="bibr" rid="pgen.1004342-Stephens1">[23]</xref>) and Markov chain Monte Carlo sampling <xref ref-type="bibr" rid="pgen.1004342-Kuhner1">[24]</xref>–<xref ref-type="bibr" rid="pgen.1004342-OFallon1">[27]</xref>. There is also a considerable literature on heuristic or approximate methods for ARG reconstruction in a parsimony framework <xref ref-type="bibr" rid="pgen.1004342-Hein2">[28]</xref>–<xref ref-type="bibr" rid="pgen.1004342-Wu1">[35]</xref>. Several of these approaches have shown promise, but they are generally highly computationally intensive and/or limited in accuracy, and they are not suitable for application to large-scale data sets. As a result, explicit ARG inference is rarely used in applied population genomics.</p>
<p>The coalescent-with-recombination is conventionally described as a stochastic process in time <xref ref-type="bibr" rid="pgen.1004342-Hudson2">[21]</xref>, but Wiuf and Hein <xref ref-type="bibr" rid="pgen.1004342-Wiuf1">[36]</xref> showed that it could be reformulated as a mathematically equivalent process along the genome sequence. Unlike the process in time, this “sequential” process is not Markovian because long-range dependencies are induced by so-called “trapped” sequences (genetic material nonancestral to the sample flanked by ancestral segments). As a result, the full sequential process is complex and computationally expensive to manipulate. Interestingly, however, simulation processes that simply disregard the non-Markovian features of the sequential process produce collections of sequences that are remarkably consistent in most respects with those generated by the full coalescent-with-recombination <xref ref-type="bibr" rid="pgen.1004342-McVean1">[37]</xref>, <xref ref-type="bibr" rid="pgen.1004342-Marjoram1">[38]</xref>. In other words, the coalescent-with-recombination is almost Markovian, in the sense that the long-range correlations induced by trapped material are fairly weak and have a minimal impact on the data. The original Markovian approximation to the full process <xref ref-type="bibr" rid="pgen.1004342-McVean1">[37]</xref> is known as the <italic>sequentially Markov coalescent</italic> (SMC), and an extension that allows for an additional class of recombinations <xref ref-type="bibr" rid="pgen.1004342-Marjoram1">[38]</xref> is known as the SMC'.</p>
<p>In recent years, the SMC has become favorite starting point for approximate methods for ARG inference <xref ref-type="bibr" rid="pgen.1004342-Hobolth1">[39]</xref>–<xref ref-type="bibr" rid="pgen.1004342-Li1">[42]</xref>. The key insight behind these methods is that, if the continuous state space for the Markov chain (consisting of all possible genealogies) is approximated by a moderately sized finite set—typically by enumerating tree topologies and/or discretizing time—then inference can be performed efficiently using well-known algorithms for hidden Markov models (HMMs). Perhaps the simplest and most elegant example of this approach is the pairwise sequentially Markov coalescent (PSMC) <xref ref-type="bibr" rid="pgen.1004342-Li1">[42]</xref>, which applies to pairs of homologous chromosomes (typically the two chromosomes in a diploid individual) and is used to reconstruct a profile of effective population sizes over time. In this case, there is only one possible tree topology and one coalescence event to consider at each genomic position, so it is sufficient to discretize time and allow for coalescence within any of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e019" xlink:type="simple"/></inline-formula> possible time slices. Using the resulting <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e020" xlink:type="simple"/></inline-formula>-state HMM, it is possible to perform inference integrating over all possible ARGs. A similar HMM-based approach has been used to estimate ancestral effective population sizes and divergence times from individual representatives of a few closely related species <xref ref-type="bibr" rid="pgen.1004342-Hobolth1">[39]</xref>–<xref ref-type="bibr" rid="pgen.1004342-Mailund2">[41]</xref>. Because of their dependency on a complete characterization of the SMC state space, however, these methods can only be applied to small numbers of samples. This limits their utility with newly emerging population genomic datasets and leads to reduced power for certain features of interest, such as recent effective population sizes, recombination rates, or local signatures of natural selection.</p>
<p>An alternative modeling approach, with better scaling properties, is the product of approximate conditionals (PAC) or “copying” model of Li and Stephens <xref ref-type="bibr" rid="pgen.1004342-Li2">[43]</xref>. The PAC model is motivated primarily by computational tractability and is not based on an explicit evolutionary model. The model generates the <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e021" xlink:type="simple"/></inline-formula>th sequence in a collection by concatenating (noisy) copies of fragments of the previous <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e022" xlink:type="simple"/></inline-formula> sequences. The source of each copied fragment represents the “closest” (most recently diverged) genome for that segment, and the noise process allows for mutations since the source and destination copies diverged. The PAC framework has been widely used in many applications in statistical genetics, including recombination rate estimation, local ancestry inference, haplotype phasing, and genotype imputation (e.g., <xref ref-type="bibr" rid="pgen.1004342-Stephens2">[44]</xref>–<xref ref-type="bibr" rid="pgen.1004342-Li3">[48]</xref>), and it generally offers good performance at minimal computational cost. Recently, Song and colleagues have generalized this framework to make use of conditional sampling distributions (CSDs) based on models closely related to, and in some cases equivalent to, the SMC <xref ref-type="bibr" rid="pgen.1004342-Paul1">[49]</xref>–<xref ref-type="bibr" rid="pgen.1004342-Steinrucken1">[52]</xref>. They have demonstrated improved accuracy in conditional likelihood calculations <xref ref-type="bibr" rid="pgen.1004342-Paul1">[49]</xref>, <xref ref-type="bibr" rid="pgen.1004342-Paul2">[50]</xref> and have shown that their methods can be effective in demographic inference <xref ref-type="bibr" rid="pgen.1004342-Sheehan1">[51]</xref>, <xref ref-type="bibr" rid="pgen.1004342-Steinrucken1">[52]</xref>. However, their approach avoids explicit ARG inference and therefore can only be used to characterize properties of the ARG that are directly determined by model parameters (see <xref ref-type="sec" rid="s3">Discussion</xref>).</p>
<p>In this paper, we introduce a new algorithm for ARG inference that combines many of the benefits of the small-sample SMC-based approaches and the large-sample CSD-based methods. Like the PSMC, our algorithm requires no approximations beyond those of the SMC and a discretization of time, but it improves on the PSMC by allowing multiple genome sequences to be considered simultaneously. The key idea of our approach is to sample an ARG of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e023" xlink:type="simple"/></inline-formula> sequences conditional on an ARG of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e024" xlink:type="simple"/></inline-formula> sequences, an operation we call “threading.” Using HMM-based methods, we can efficiently sample new threadings from the exact conditional distribution of interest. By repeatedly removing and re-threading individual sequences, we obtain an efficient Gibbs sampler for ARGs. This basic Gibbs sampler can be improved by including operations that rethread entire subtrees rather than individual sequences. Our implementation of these methods, called <italic>ARGweaver</italic>, is efficient enough to sample full ARGs on a genome-wide scale for dozens of diploid individuals. Simulation experiments indicate that <italic>ARGweaver</italic> converges rapidly and is able to recover many properties of the true ARG with good accuracy. In addition, our explicit characterization of the ARG enables us to examine many features not directly described by model parameters, such as local times to most recent common ancestry, allele ages, and gene tree topologies. These quantities, in turn, shed light on both demographic processes and the influence of natural selection across the genome. For example, we demonstrate, by applying <italic>ARGweaver</italic> to 54 individual human sequences from Complete Genomics, that it provides insight into the sources of reduced nucleotide diversity near functional elements, the contribution of balancing selection to regions containing very old polymorphisms, and the relative influences of direct and indirect selection on allele age. Our <italic>ARGweaver</italic> software (<ext-link ext-link-type="uri" xlink:href="https://github.com/mdrasmus/argweaver" xlink:type="simple">https://github.com/mdrasmus/argweaver</ext-link>), our sampled ARGs (<ext-link ext-link-type="uri" xlink:href="http://compgen.bscb.cornell.edu/ARGweaver/CG_results" xlink:type="simple">http://compgen.bscb.cornell.edu/ARGweaver/CG_results</ext-link>), and genome-browser tracks summarizing these ARGs (<ext-link ext-link-type="uri" xlink:href="http://genome-mirror.bscb.cornell.edu" xlink:type="simple">http://genome-mirror.bscb.cornell.edu</ext-link>; assembly hg19) are all freely available.</p>
</sec><sec id="s2">
<title>Results</title>
<sec id="s2a">
<title>The Sequentially Markov Coalescent</title>
<p>The starting point for our model is the Sequentially Markov Coalescent (SMC) introduced by McVean and Cardin <xref ref-type="bibr" rid="pgen.1004342-McVean1">[37]</xref>. We begin by briefly reviewing the SMC and introducing notation that will be useful below in describing a general discretized version of this model.</p>
<p>The SMC is a stochastic process for generating a sequence of local trees, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e025" xlink:type="simple"/></inline-formula> and corresponding genomic breakpoints <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e026" xlink:type="simple"/></inline-formula>, such that each <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e027" xlink:type="simple"/></inline-formula> describes the ancestry of a collection of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e028" xlink:type="simple"/></inline-formula> sequences in a nonrecombining genomic interval <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e029" xlink:type="simple"/></inline-formula>, and each breakpoint <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e030" xlink:type="simple"/></inline-formula> between intervals <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e031" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e032" xlink:type="simple"/></inline-formula> corresponds to a recombination event (<xref ref-type="fig" rid="pgen-1004342-g001">Figure 1B</xref>). The model is continuous in both space and time, with each node <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e033" xlink:type="simple"/></inline-formula> in each <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e034" xlink:type="simple"/></inline-formula> having a real-valued age <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e035" xlink:type="simple"/></inline-formula> in generations ago, and each breakpoint <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e036" xlink:type="simple"/></inline-formula> falling in the continuous interval <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e037" xlink:type="simple"/></inline-formula>, where <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e038" xlink:type="simple"/></inline-formula> is the total length of the genomic segment of interest in nucleotide sites. The intervals are exhaustive and nonoverlapping, with <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e039" xlink:type="simple"/></inline-formula>, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e040" xlink:type="simple"/></inline-formula>, and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e041" xlink:type="simple"/></inline-formula> for all <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e042" xlink:type="simple"/></inline-formula>. Each <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e043" xlink:type="simple"/></inline-formula> is a binary tree with <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e044" xlink:type="simple"/></inline-formula> for all leaf nodes <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e045" xlink:type="simple"/></inline-formula>. We will use the convention of indexing branches in the trees by their descendant nodes; that is, branch <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e046" xlink:type="simple"/></inline-formula> is the branch between node <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e047" xlink:type="simple"/></inline-formula> and its parent.</p>
<p>As shown by Wiuf and Hein <xref ref-type="bibr" rid="pgen.1004342-Wiuf1">[36]</xref>, the correlation structure of the local trees and recombinations under the full coalescent-with-recombination is complex. The SMC approximates this distribution by assuming that <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e048" xlink:type="simple"/></inline-formula> is conditionally independent of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e049" xlink:type="simple"/></inline-formula> given <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e050" xlink:type="simple"/></inline-formula>, and, similarly, that <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e051" xlink:type="simple"/></inline-formula> depends only on <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e052" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e053" xlink:type="simple"/></inline-formula>, so that,<disp-formula id="pgen.1004342.e054"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pgen.1004342.e054" xlink:type="simple"/><label>(1)</label></disp-formula>where <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e055" xlink:type="simple"/></inline-formula> is the effective population size, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e056" xlink:type="simple"/></inline-formula> is the recombination rate, and it is understood that <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e057" xlink:type="simple"/></inline-formula>. Thus, the SMC can be viewed as generating a sequence of local trees and corresponding breakpoints by a first-order Markov process. The key to the model is to define the conditional distributions <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e058" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e059" xlink:type="simple"/></inline-formula> such that this Markov process closely approximates the coalescent-with-recombination. Briefly, this is accomplished by first sampling the initial tree <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e060" xlink:type="simple"/></inline-formula> from the standard coalescent and setting <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e061" xlink:type="simple"/></inline-formula>, and then iteratively (i) determining the next breakpoint, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e062" xlink:type="simple"/></inline-formula>, by incrementing <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e063" xlink:type="simple"/></inline-formula> by an exponential random variate with rate <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e064" xlink:type="simple"/></inline-formula>, where <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e065" xlink:type="simple"/></inline-formula> denotes the total branch length of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e066" xlink:type="simple"/></inline-formula>; (ii) sampling a recombination point <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e067" xlink:type="simple"/></inline-formula> uniformly along the branches beneath the root of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e068" xlink:type="simple"/></inline-formula>, where <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e069" xlink:type="simple"/></inline-formula> is a branch and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e070" xlink:type="simple"/></inline-formula> is a time along that branch; (iii) dissolving the branch <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e071" xlink:type="simple"/></inline-formula> above point <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e072" xlink:type="simple"/></inline-formula>; and (iv) allowing <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e073" xlink:type="simple"/></inline-formula> to rejoin the remainder of tree <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e074" xlink:type="simple"/></inline-formula> above time <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e075" xlink:type="simple"/></inline-formula> by the standard coalescent process, creating a new tree <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e076" xlink:type="simple"/></inline-formula> (<xref ref-type="fig" rid="pgen-1004342-g001">Figure 1B</xref>). As a generative process for an arbitrary number of genomic segments, the SMC can be implemented by simply repeating the iterative process until <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e077" xlink:type="simple"/></inline-formula> then setting <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e078" xlink:type="simple"/></inline-formula> equal to <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e079" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e080" xlink:type="simple"/></inline-formula> equal to <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e081" xlink:type="simple"/></inline-formula>.</p>
<p>Notice that, if the sampled recombination points <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e082" xlink:type="simple"/></inline-formula> are retained, this process generates not only a sequence of local trees but a complete ARG. In addition, a sampled sequence of local trees, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e083" xlink:type="simple"/></inline-formula>, is sufficient for generation of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e084" xlink:type="simple"/></inline-formula> aligned DNA sequences corresponding to the leaves of the trees (<xref ref-type="fig" rid="pgen-1004342-g001">Figure 1C</xref>). Augmented in this way, the SMC can be considered a full generative model for ARGs and sequence data.</p>
</sec><sec id="s2b">
<title>The Discretized Sequentially Markov Coalescent</title>
<p>We now define an approximation of the SMC that is discrete in both space and time, which we call the Discretized Sequentially Markov Coalescent (DSMC). The DSMC can be viewed as a generalization to multiple genomes of the discretized pairwise sequentially Markov coalescent (PSMC) used by Li and Durbin <xref ref-type="bibr" rid="pgen.1004342-Li1">[42]</xref>. It is also closely related to several other recently described discretized Markovian coalescent models <xref ref-type="bibr" rid="pgen.1004342-Hobolth1">[39]</xref>, <xref ref-type="bibr" rid="pgen.1004342-Mailund1">[40]</xref>, <xref ref-type="bibr" rid="pgen.1004342-Paul2">[50]</xref>.</p>
<p>The DSMC assumes that time is partitioned into <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e085" xlink:type="simple"/></inline-formula> intervals, whose boundaries are given by a sequence of time points <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e086" xlink:type="simple"/></inline-formula>, with <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e087" xlink:type="simple"/></inline-formula>, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e088" xlink:type="simple"/></inline-formula> for all <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e089" xlink:type="simple"/></inline-formula> (<inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e090" xlink:type="simple"/></inline-formula>), and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e091" xlink:type="simple"/></inline-formula> equal to a user-specified maximum value. (See <xref ref-type="table" rid="pgen-1004342-t001">Table 1</xref> for a key to the notation used in this paper.) Every coalescence or recombination event is assumed to occur precisely at one of these <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e092" xlink:type="simple"/></inline-formula> time points. Various strategies can be used to determine these time points (see, e.g., <xref ref-type="bibr" rid="pgen.1004342-Paul2">[50]</xref>). In this paper, we simply distribute them uniformly on a logarithmic scale, so that the resolution of the discretization scheme is finest near the leaves of the ARG, where the density of events is expected to be greatest (see <xref ref-type="sec" rid="s4">Methods</xref>). Each local block is assumed to have an integral length measured in base pairs, with all recombinations occurring between adjacent nucleotides. The DSMC approaches the SMC as the number of intervals <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e093" xlink:type="simple"/></inline-formula> and the sequence length <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e094" xlink:type="simple"/></inline-formula> grow large, for fixed <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e095" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e096" xlink:type="simple"/></inline-formula>.</p>
<table-wrap id="pgen-1004342-t001" position="float"><object-id pub-id-type="doi">10.1371/journal.pgen.1004342.t001</object-id><label>Table 1</label><caption>
<title>Key to notation.</title>
</caption><alternatives><graphic id="pgen-1004342-t001-1" position="float" mimetype="image" xlink:href="info:doi/10.1371/journal.pgen.1004342.t001" xlink:type="simple"/>
<table><colgroup span="1"><col align="left" span="1"/><col align="center" span="1"/></colgroup>
<tbody>
<tr>
<td colspan="2" align="left" rowspan="1"><bold>Population Genetic Parameters</bold></td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1"><inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e097" xlink:type="simple"/></inline-formula></td>
<td align="left" rowspan="1" colspan="1">Mutation rate, in events per site per generation</td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1"><inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e098" xlink:type="simple"/></inline-formula></td>
<td align="left" rowspan="1" colspan="1">Recombination rate, in events per site per generation</td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1"><inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e099" xlink:type="simple"/></inline-formula></td>
<td align="left" rowspan="1" colspan="1">Effective population size, in number of individuals<xref ref-type="table-fn" rid="nt101">a</xref></td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1"><inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e100" xlink:type="simple"/></inline-formula></td>
<td align="left" rowspan="1" colspan="1">Full parameter set, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e101" xlink:type="simple"/></inline-formula></td>
</tr>
<tr>
<td colspan="2" align="left" rowspan="1"><bold>Time Discretization</bold></td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1"><inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e102" xlink:type="simple"/></inline-formula></td>
<td align="left" rowspan="1" colspan="1">Total number of time intervals (user-defined)</td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1"><inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e103" xlink:type="simple"/></inline-formula></td>
<td align="left" rowspan="1" colspan="1">Time point <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e104" xlink:type="simple"/></inline-formula> (<inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e105" xlink:type="simple"/></inline-formula>), defining a boundary between time intervals (generations before present)</td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1"><inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e106" xlink:type="simple"/></inline-formula></td>
<td align="left" rowspan="1" colspan="1">Length of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e107" xlink:type="simple"/></inline-formula>th time interval, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e108" xlink:type="simple"/></inline-formula></td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1"><inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e109" xlink:type="simple"/></inline-formula></td>
<td align="left" rowspan="1" colspan="1">Midpoint of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e110" xlink:type="simple"/></inline-formula>th time interval</td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1"><inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e111" xlink:type="simple"/></inline-formula></td>
<td align="left" rowspan="1" colspan="1">Set of branches in a tree <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e112" xlink:type="simple"/></inline-formula> associated with time interval <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e113" xlink:type="simple"/></inline-formula></td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1"><inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e114" xlink:type="simple"/></inline-formula></td>
<td align="left" rowspan="1" colspan="1">Number of branches associated with time interval <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e115" xlink:type="simple"/></inline-formula>, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e116" xlink:type="simple"/></inline-formula> (with <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e117" xlink:type="simple"/></inline-formula> determined by context)</td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1"><inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e118" xlink:type="simple"/></inline-formula></td>
<td align="left" rowspan="1" colspan="1">Set of “active” branches at time point <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e119" xlink:type="simple"/></inline-formula></td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1"><inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e120" xlink:type="simple"/></inline-formula></td>
<td align="left" rowspan="1" colspan="1">Number of “active” branches at time point <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e121" xlink:type="simple"/></inline-formula>, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e122" xlink:type="simple"/></inline-formula> (with <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e123" xlink:type="simple"/></inline-formula> determined by context)</td>
</tr>
<tr>
<td colspan="2" align="left" rowspan="1"><bold>Ancestral Recombination Graph</bold></td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1"><inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e124" xlink:type="simple"/></inline-formula></td>
<td align="left" rowspan="1" colspan="1">Length of analyzed sequence alignment in nucleotides</td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1"><inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e125" xlink:type="simple"/></inline-formula></td>
<td align="left" rowspan="1" colspan="1">Number of sequences in alignment</td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1"><inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e126" xlink:type="simple"/></inline-formula></td>
<td align="left" rowspan="1" colspan="1">Alignment column at <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e127" xlink:type="simple"/></inline-formula>th position; cumulatively, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e128" xlink:type="simple"/></inline-formula></td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1"><inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e129" xlink:type="simple"/></inline-formula></td>
<td align="left" rowspan="1" colspan="1">Local tree for <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e130" xlink:type="simple"/></inline-formula>th position; cumulatively, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e131" xlink:type="simple"/></inline-formula></td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1"><inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e132" xlink:type="simple"/></inline-formula></td>
<td align="left" rowspan="1" colspan="1">Recombination point between <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e133" xlink:type="simple"/></inline-formula>st and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e134" xlink:type="simple"/></inline-formula>th position; cumulatively, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e135" xlink:type="simple"/></inline-formula></td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1"><inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e136" xlink:type="simple"/></inline-formula></td>
<td align="left" rowspan="1" colspan="1">Full ARG for <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e137" xlink:type="simple"/></inline-formula> sequences, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e138" xlink:type="simple"/></inline-formula></td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1"><inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e139" xlink:type="simple"/></inline-formula></td>
<td align="left" rowspan="1" colspan="1">Coalescence point for threaded sequence at <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e140" xlink:type="simple"/></inline-formula>th position, defined by a branch <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e141" xlink:type="simple"/></inline-formula> and a time point <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e142" xlink:type="simple"/></inline-formula>; cumulatively, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e143" xlink:type="simple"/></inline-formula></td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1"><inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e144" xlink:type="simple"/></inline-formula></td>
<td align="left" rowspan="1" colspan="1">Recombination point for threaded sequence between positions <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e145" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e146" xlink:type="simple"/></inline-formula>, defined by a branch <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e147" xlink:type="simple"/></inline-formula> and a time point <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e148" xlink:type="simple"/></inline-formula>; cumulatively, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e149" xlink:type="simple"/></inline-formula></td>
</tr>
<tr>
<td colspan="2" align="left" rowspan="1"><bold>Hidden Markov Model</bold></td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1"><inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e150" xlink:type="simple"/></inline-formula></td>
<td align="left" rowspan="1" colspan="1">Transition probability from state <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e151" xlink:type="simple"/></inline-formula> to state <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e152" xlink:type="simple"/></inline-formula> between position <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e153" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e154" xlink:type="simple"/></inline-formula></td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1"><inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e155" xlink:type="simple"/></inline-formula></td>
<td align="left" rowspan="1" colspan="1">Initial state probability for state <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e156" xlink:type="simple"/></inline-formula></td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1"><inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e157" xlink:type="simple"/></inline-formula></td>
<td align="left" rowspan="1" colspan="1">Emission probability for alignment column <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e158" xlink:type="simple"/></inline-formula> in state <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e159" xlink:type="simple"/></inline-formula> at position <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e160" xlink:type="simple"/></inline-formula></td>
</tr>
</tbody>
</table>
</alternatives><table-wrap-foot><fn id="nt101"><label>a</label><p>Model allows for a separate <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e161" xlink:type="simple"/></inline-formula> for each time interval l but all analyses in this paper assume a constant <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e162" xlink:type="simple"/></inline-formula> across time intervals.</p></fn></table-wrap-foot></table-wrap>
<p>Like the SMC, the DSMC generates an ARG <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e163" xlink:type="simple"/></inline-formula> for <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e164" xlink:type="simple"/></inline-formula> (haploid) sequences, each containing <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e165" xlink:type="simple"/></inline-formula> nucleotides (<xref ref-type="fig" rid="pgen-1004342-g001">Figure 1B</xref>). In the discrete setting, it is convenient to define local trees and recombination events at the level of individual nucleotide positions. Assuming that <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e166" xlink:type="simple"/></inline-formula> denotes a recombination between <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e167" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e168" xlink:type="simple"/></inline-formula>, we write <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e169" xlink:type="simple"/></inline-formula>, with <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e170" xlink:type="simple"/></inline-formula> for positions <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e171" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e172" xlink:type="simple"/></inline-formula>. Notice that it is possible in this setting that <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e173" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e174" xlink:type="simple"/></inline-formula>. Where a recombination occurs (<inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e175" xlink:type="simple"/></inline-formula>), we write <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e176" xlink:type="simple"/></inline-formula> where <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e177" xlink:type="simple"/></inline-formula> is the branch in <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e178" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e179" xlink:type="simple"/></inline-formula> is the time point of the recombination. For simplicity and computational efficiency, we assume that at most one recombination occurs between each pair of adjacent sites. Given the sparsity of variant sites in most data sets, this simplification is likely to have, at most, a minor effect during inference (see <xref ref-type="sec" rid="s3">Discussion</xref>).</p>
<p>Like the SMC, the DSMC can additionally be used to generate an alignment of DNA sequences (<xref ref-type="fig" rid="pgen-1004342-g001">Figure 1C</xref>). We denote such an alignment by <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e180" xlink:type="simple"/></inline-formula>, where each <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e181" xlink:type="simple"/></inline-formula> represents an alignment column of height <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e182" xlink:type="simple"/></inline-formula>. Each <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e183" xlink:type="simple"/></inline-formula> can be generated, in the ordinary way, by sampling an ancestral allele from an appropriate background distribution, and then allowing this allele to mutate stochastically along the branches of the corresponding local tree, in a branch-length-dependent manner. We denote the induced conditional probability distribution over alignment columns by <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e184" xlink:type="simple"/></inline-formula>, where <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e185" xlink:type="simple"/></inline-formula> is the mutation rate. In this work, we assume a Jukes-Cantor model <xref ref-type="bibr" rid="pgen.1004342-Jukes1">[53]</xref> for nucleotide mutations along the branches of the tree, but another mutation model can easily be used instead. Notice that, while the recombinations <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e186" xlink:type="simple"/></inline-formula> are required to define the ARG completely, the probability of the sequence data given the ARG depends only on the local trees <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e187" xlink:type="simple"/></inline-formula>.</p>
</sec><sec id="s2c">
<title>The Threading Problem</title>
<p>In the case of an observed alignment, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e188" xlink:type="simple"/></inline-formula>, and an unobserved ARG, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e189" xlink:type="simple"/></inline-formula>, the DSMC can be viewed as a hidden Markov model (HMM) with a state space given by all possible local trees, transition probabilities given by expressions of the form <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e190" xlink:type="simple"/></inline-formula> <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e191" xlink:type="simple"/></inline-formula>, and emission probabilities given by the conditional distributions for alignment columns, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e192" xlink:type="simple"/></inline-formula>. The complete data likelihood function of this model—that is, the joint probability of an ARG <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e193" xlink:type="simple"/></inline-formula> and a sequence alignment <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e194" xlink:type="simple"/></inline-formula> given model parameters <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e195" xlink:type="simple"/></inline-formula>—can be expressed as a product of these terms over alignment positions (see <xref ref-type="sec" rid="s4">Methods</xref> for further details):<disp-formula id="pgen.1004342.e196"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pgen.1004342.e196" xlink:type="simple"/><label>(2)</label></disp-formula>This HMM formulation is impractical as a framework for direct inference, however, because the set of possible local trees—and hence the state space—grows super-exponentially with <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e197" xlink:type="simple"/></inline-formula>. Even with additional assumptions, similar approaches have only been able to accommodate small numbers of sequences <xref ref-type="bibr" rid="pgen.1004342-Song1">[32]</xref>, <xref ref-type="bibr" rid="pgen.1004342-Wu1">[35]</xref>, <xref ref-type="bibr" rid="pgen.1004342-Husmeier1">[54]</xref>.</p>
<p>Instead, we use an alternative strategy with better scaling properties. The key idea of our approach is to sample the ancestry of only one sequence at a time, while conditioning on the ancestry of the other <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e198" xlink:type="simple"/></inline-formula> sequences. Repeated applications of this “threading” operation form the basis of a Markov chain Monte Carlo sampler that explores the posterior distribution of ARGs. In essence, the threading operation adds one branch to each local tree in a manner that is consistent with the assumed recombination process and the observed data (<xref ref-type="fig" rid="pgen-1004342-g002">Figure 2</xref>). While conditioning on a given set of local trees introduces a number of technical challenges, the Markovian properties of the DSMC are retained in the threading problem, and it can be solved using standard dynamic programming algorithms for HMMs.</p>
<fig id="pgen-1004342-g002" position="float"><object-id pub-id-type="doi">10.1371/journal.pgen.1004342.g002</object-id><label>Figure 2</label><caption>
<title>The “threading” operation.</title>
<p>The threading operation adds an <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e199" xlink:type="simple"/></inline-formula>th sequence to an ARG of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e200" xlink:type="simple"/></inline-formula> sequences under a discretized version of the SMC (the DSMC) that requires all coalescence and recombination events to occur precisely at pre-defined time points, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e201" xlink:type="simple"/></inline-formula> (horizontal dashed lines). In this example, the fourth sequence has been removed from ARG <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e202" xlink:type="simple"/></inline-formula> from <xref ref-type="fig" rid="pgen-1004342-g001">Figure 1</xref>, leaving a tree with <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e203" xlink:type="simple"/></inline-formula> leaves at each position <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e204" xlink:type="simple"/></inline-formula> (<inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e205" xlink:type="simple"/></inline-formula>; shown in black). The fourth sequence (shown in red) is re-threaded through the remaining portion of the ARG by a two-step process that first samples a coalescence point <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e206" xlink:type="simple"/></inline-formula> for this sequence at each <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e207" xlink:type="simple"/></inline-formula> (dark blue points), thereby defining a new tree <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e208" xlink:type="simple"/></inline-formula>, and second, samples a recombination point <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e209" xlink:type="simple"/></inline-formula> to reconcile each adjacent pair of trees, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e210" xlink:type="simple"/></inline-formula> (light blue points). For simplicity, only the distinct local trees for the four nonrecombining segments (after threading) are shown. The gray box highlights the pair of trees immediately flanking the breakpoint <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e211" xlink:type="simple"/></inline-formula>. Notice that the first recombination from <xref ref-type="fig" rid="pgen-1004342-g001">Figure 1</xref> is retained (dark gray nodes and dashed line in left-most tree). In general, new recombinations are prohibited at the locations of “given” recombinations <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e212" xlink:type="simple"/></inline-formula> (see text). Note that it is possible for the attachment point of the <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e213" xlink:type="simple"/></inline-formula>th sequence in the local trees to move due to old recombinations as well as new ones (not shown in this example).</p>
</caption><graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pgen.1004342.g002" position="float" xlink:type="simple"/></fig>
<p>The threading problem can be precisely described as follows. Assume we are given an ARG for <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e214" xlink:type="simple"/></inline-formula> sequences, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e215" xlink:type="simple"/></inline-formula>, a corresponding data set <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e216" xlink:type="simple"/></inline-formula>, and a set of model parameters <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e217" xlink:type="simple"/></inline-formula> Assume further that <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e218" xlink:type="simple"/></inline-formula> is consistent with the assumptions of the DSMC (for example, all of its recombination and coalescent events occur at time points in <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e219" xlink:type="simple"/></inline-formula> and it contains at most one recombination per position). Finally, assume that we are given an <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e220" xlink:type="simple"/></inline-formula>th sequence <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e221" xlink:type="simple"/></inline-formula>, of the same length of the others, and let <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e222" xlink:type="simple"/></inline-formula> The threading problem is to sample a new ARG <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e223" xlink:type="simple"/></inline-formula> from the conditional distribution <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e224" xlink:type="simple"/></inline-formula> under the DSMC.</p>
<p>The problem is simplified by recognizing that <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e225" xlink:type="simple"/></inline-formula> can be defined by augmenting <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e226" xlink:type="simple"/></inline-formula> with the additional recombination and coalescence events required for the <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e227" xlink:type="simple"/></inline-formula>th sequence. First, let <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e228" xlink:type="simple"/></inline-formula> be represented in terms of its local trees and recombination points: <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e229" xlink:type="simple"/></inline-formula>. Now, observe that specifying the new coalescence events in <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e230" xlink:type="simple"/></inline-formula> is equivalent to adding one branch to each local tree, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e231" xlink:type="simple"/></inline-formula> for <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e232" xlink:type="simple"/></inline-formula>, to obtain a new tree <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e233" xlink:type="simple"/></inline-formula> (<xref ref-type="fig" rid="pgen-1004342-g002">Figure 2</xref>). Let us denote the point at which each of these new branches attaches to the smaller subtree at each genomic position <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e234" xlink:type="simple"/></inline-formula> by <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e235" xlink:type="simple"/></inline-formula>, where <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e236" xlink:type="simple"/></inline-formula> indicates a branch in <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e237" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e238" xlink:type="simple"/></inline-formula> indicates the coalescence time along that branch. Thus, the <italic>coalescence threading</italic> of the <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e239" xlink:type="simple"/></inline-formula>th sequence is given by the sequence <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e240" xlink:type="simple"/></inline-formula>.</p>
<p>To complete the definition of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e241" xlink:type="simple"/></inline-formula>, we must also specify the precise locations of the additional recombinations associated with the threading—that is, the specific time point at which each branch in a local tree <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e242" xlink:type="simple"/></inline-formula> was broken before the branch was allowed to re-coalesce in a new location in tree <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e243" xlink:type="simple"/></inline-formula>. Here it is useful to partition the recombinations into those that are given by <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e244" xlink:type="simple"/></inline-formula>, denoted <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e245" xlink:type="simple"/></inline-formula>, and those new to <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e246" xlink:type="simple"/></inline-formula>, which we denote <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e247" xlink:type="simple"/></inline-formula> (<xref ref-type="fig" rid="pgen-1004342-g003">Figure 3A&amp;B</xref>). Each <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e248" xlink:type="simple"/></inline-formula> is either null (<inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e249" xlink:type="simple"/></inline-formula>), meaning that there is no new recombination between <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e250" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e251" xlink:type="simple"/></inline-formula>, or defined by <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e252" xlink:type="simple"/></inline-formula>, where <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e253" xlink:type="simple"/></inline-formula> is a branch in <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e254" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e255" xlink:type="simple"/></inline-formula> is the time along that branch at which the recombination occurred. We call <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e256" xlink:type="simple"/></inline-formula> the <italic>recombination threading</italic> of the <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e257" xlink:type="simple"/></inline-formula>th sequence. For reasons of efficiency, we take a two-step approach to threading: first, we sample the coalescence threading <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e258" xlink:type="simple"/></inline-formula>, and second, we sample the recombination threading <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e259" xlink:type="simple"/></inline-formula> conditional on <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e260" xlink:type="simple"/></inline-formula>. This separation into two steps allows for a substantially reduced state space during the coalescence threading operation, leading to significant savings in computation. When sampling the coalescence threading (step one), we integrate over the locations of the new recombinations <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e261" xlink:type="simple"/></inline-formula>, as in previous work <xref ref-type="bibr" rid="pgen.1004342-Li1">[42]</xref>, <xref ref-type="bibr" rid="pgen.1004342-Paul2">[50]</xref>. Sampling the recombination threading (step two) can be accomplished in a straightforward manner independently for each recombination event, by taking advantage of the conditional independence structure of the DSMC model (see <xref ref-type="sec" rid="s4">Methods</xref> for details).</p>
<fig id="pgen-1004342-g003" position="float"><object-id pub-id-type="doi">10.1371/journal.pgen.1004342.g003</object-id><label>Figure 3</label><caption>
<title>Graphical models for Discretized Sequentially Markov Coalescent (DSMC) models.</title>
<p>(A) Full DSMC model for <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e262" xlink:type="simple"/></inline-formula> samples with local trees, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e263" xlink:type="simple"/></inline-formula>, recombinations, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e264" xlink:type="simple"/></inline-formula>, and alignment columns, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e265" xlink:type="simple"/></inline-formula>. Together, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e266" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e267" xlink:type="simple"/></inline-formula> define an ancestral recombination graph, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e268" xlink:type="simple"/></inline-formula>. Solid circles indicate observed variables and empty circles indicate latent variables. Arrows indicate direct dependencies between variables and correspond to conditional probability distributions described in the text. Notice that the <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e269" xlink:type="simple"/></inline-formula> variables can be integrated out of this model, leading to the conventional graph topology for a hidden Markov model. (B) The same model as in (A), but now partitioning the latent variables into components that describe the history of the first <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e270" xlink:type="simple"/></inline-formula> sequences (<inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e271" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e272" xlink:type="simple"/></inline-formula>) and components specific to the <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e273" xlink:type="simple"/></inline-formula>th sequence (<inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e274" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e275" xlink:type="simple"/></inline-formula>). The <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e276" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e277" xlink:type="simple"/></inline-formula> variables are represented by solid circles because they are now “clamped” at specific values. A sample of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e278" xlink:type="simple"/></inline-formula> represents a threading of the <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e279" xlink:type="simple"/></inline-formula>th sequence through the ARG. (C) Reduced model after elimination of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e280" xlink:type="simple"/></inline-formula> by integration, enabling efficient sampling of coalescent threadings <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e281" xlink:type="simple"/></inline-formula>. This is the model used by the first step in our two-step sampling approach. In the second step, the <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e282" xlink:type="simple"/></inline-formula> variables are sampled conditional on <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e283" xlink:type="simple"/></inline-formula>, separately for each <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e284" xlink:type="simple"/></inline-formula>. In this model, the grouped nodes have complex joint dependencies, leading to a heterogeneous state space and normalization structure, but the linear conditional independence structure of an HMM is retained.</p>
</caption><graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pgen.1004342.g003" position="float" xlink:type="simple"/></fig>
<p>The core problem, then, is to accomplish step one by sampling the coalescence threading <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e285" xlink:type="simple"/></inline-formula> from the distribution,<disp-formula id="pgen.1004342.e286"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pgen.1004342.e286" xlink:type="simple"/><label>(3)</label></disp-formula>where the notation <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e287" xlink:type="simple"/></inline-formula> indicates that random variable <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e288" xlink:type="simple"/></inline-formula> is held fixed (“clamped”) at a particular value throughout the procedure. This equation defines a hidden Markov model with a state space given by the possible values of each <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e289" xlink:type="simple"/></inline-formula>, transition probabilities given by <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e290" xlink:type="simple"/></inline-formula> and emission probabilities given by <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e291" xlink:type="simple"/></inline-formula> (<xref ref-type="fig" rid="pgen-1004342-g003">Figure 3C</xref>). Notice that the location of each new recombination, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e292" xlink:type="simple"/></inline-formula>, is implicitly integrated out in the definition of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e293" xlink:type="simple"/></inline-formula>. Despite some unusual features of this model—for example, it has a heterogeneous state space and normalization structure along the sequence—its Markovian dependency structure is retained, and the problem of drawing a coalescent threading <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e294" xlink:type="simple"/></inline-formula> from the desired conditional distribution can be solved exactly by dynamic programming using the stochastic traceback algorithm for HMMs. Additional optimizations allow this step to be completed in time linear in both the number of sequences <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e295" xlink:type="simple"/></inline-formula> and the alignment length <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e296" xlink:type="simple"/></inline-formula> and quadratic only in the number of time intervals <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e297" xlink:type="simple"/></inline-formula> (see <xref ref-type="sec" rid="s4">Methods</xref> for details).</p>
</sec><sec id="s2d">
<title>Markov Chain Monte Carlo Sampling</title>
<p>The main value of the threading operation is in its usefulness as a building block for Markov chain Monte Carlo methods for sampling from an approximate posterior distribution over ARGs given the data. We employ three main types of sampling algorithms based on threading, as described below.</p>
<sec id="s2d1">
<title>Sequential sampling</title>
<p>First, the threading operation can be applied iteratively to a series of orthologous sequences to obtain an ARG of size <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e298" xlink:type="simple"/></inline-formula> from sequence data alone. This method works by randomly choosing one sequence and constructing for it a trivial ARG <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e299" xlink:type="simple"/></inline-formula> (i.e. every local tree is a single branch). Additional sequences are then threaded into the ARG, one at a time, until an ARG <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e300" xlink:type="simple"/></inline-formula> of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e301" xlink:type="simple"/></inline-formula> sequences has been obtained. Notice that an ARG derived in this manner is not a valid sample from the posterior distribution, because each successive <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e302" xlink:type="simple"/></inline-formula> (for <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e303" xlink:type="simple"/></inline-formula>) is sampled conditional on only <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e304" xlink:type="simple"/></inline-formula> (the first <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e305" xlink:type="simple"/></inline-formula> sequences). Nevertheless, the sequential sampling algorithm is an efficient heuristic method for obtaining an initial ARG, which can subsequently be improved by other methods. If desired, this operation can be applied multiple times, possibly with various permutations of the sequences, to obtain multiple initializations of an MCMC sampler. Heuristic methods can also be used to choose a “smart” initial ordering of sequences. For example, one might begin with one representative of each of several populations, to first approximate the overall ARG structure, and subsequently add more representatives of each population.</p>
</sec><sec id="s2d2">
<title>Gibbs sampling for single sequences</title>
<p>Second, the threading operation can serve as the basis of a Gibbs sampler for full ARGs. Starting with an initial ARG of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e306" xlink:type="simple"/></inline-formula> sequences, individual sequences can be removed, randomly or in round-robin fashion, and rethreaded. Since the threading procedure samples from the conditional distribution <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e307" xlink:type="simple"/></inline-formula>, this produces a valid Gibbs sampler for the ARG up to the assumptions of the DSMC. The ergodicity of the Markov chain follows, essentially, from the fact that any tree is reachable from any other by a finite sequence of branch removals and additions (see <xref ref-type="supplementary-material" rid="pgen.1004342.s022">Text S1</xref> for details).</p>
<p>The main limitation of this method is that it leads to poor mixing when the number of sequences grows large. The essential problem is that rethreading a single sequence is equivalent to resampling the placement of external branches in the local trees, so this method is highly inefficient at rearranging the “deep structure” (internal branches) of the ARG. Furthermore, this mixing problem becomes progressively worse as <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e308" xlink:type="simple"/></inline-formula> grows larger. Indeed, as <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e309" xlink:type="simple"/></inline-formula> approaches infinity, the single-sequence threading operation reduces to a procedure that selects a sequences of short genealogy “tips” leading to other sequences in the data set, leaving all other aspects of the ARG unchanged; in effect, it approaches the “copying” model of Li and Stephens <xref ref-type="bibr" rid="pgen.1004342-Li2">[43]</xref>. As a result, an alternative strategy for ARG sampling is needed for large numbers of sequences.</p>
</sec><sec id="s2d3">
<title>Subtree sampling</title>
<p>The third sampling strategy addresses the mixing limitations of the single-sequence Gibbs sampler by generalizing the threading operation to accommodate not only individual sequences but subtrees with arbitrary numbers of leaves. As a result, internal branches in the local trees can be resampled and the full ARG can be perturbed, including the deep branches near the roots of the local trees.</p>
<p>In principle, one could address the subtree threading problem by arbitrarily selecting an internal branch for each nonrecombining segment of the ARG and resampling its attachment point to the remainder of the tree, by essentially the same procedure used for the reattachment of external branches in single-sequence threading. The problem is that, because the local trees change along the sequence, it is impossible in general to select a sequence of internal branches whose subtrees are maintained across the entire ARG (this is possible only for external branches). Furthermore, if a poor sequence of internal branches is selected, the attachment points at <italic>both</italic> ends of each segment will be constrained by the flanking local trees, creating a strong tendency to resample the original attachment points, which would result in poor mixing of the sampler.</p>
<p>To address this problem, we devised a novel method for selecting sequences of subtrees guaranteed to have good continuity properties. Once such a sequence is selected, the subtree threading operation can be accomplished efficiently using the stochastic traceback algorithm, in a similar manner as with single sequences. Our algorithm for selecting sequences of internal branches is fairly technical in nature and a detailed description is left for <xref ref-type="supplementary-material" rid="pgen.1004342.s022">Text S1</xref>. Briefly, to select sequences of subtrees, we use a data structure called a <italic>branch graph</italic>, which traces the shared ancestry among branches across genomic positions. Using dynamic programming, we are able to identify paths through the branch graph that correspond to sequences of internal branches with good continuity properties. After a sequence of internal branches is identified, the selected branch is removed from each local tree, splitting it into a main tree and a subtree. A new branch is then added above the root of every subtree and allowed to re-coalesce with the corresponding main tree in a manner consistent with the DSMC.</p>
<p>One important limitation of the algorithm is worth noting. As in the single-sequence case, the stochastic traceback algorithm samples from the desired conditional distribution over subtree threadings. However, since the number of ways of removing internal branches depends on the current structure of the ARG, the Hastings ratio is not equal to one in this case, and a more general Metropolis-Hastings algorithm (with rejection of some proposed threadings) is required (see <xref ref-type="supplementary-material" rid="pgen.1004342.s022">Text S1</xref> for details). In practice, the acceptance rates for proposed threadings are fairly high (∼40% for typical human data), and despite this limitation, Metropolis-Hastings subtree threading considerably improves the mixing properties of the Gibbs sampler for moderately large values of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e310" xlink:type="simple"/></inline-formula> (see below).</p>
</sec></sec><sec id="s2e">
<title><italic>ARGweaver</italic> Program and Visualization</title>
<p>We implemented these sampling strategies in a computer program called <italic>ARGweaver</italic>, that “weaves” together an ARG by repeated applications of the threading operation. The program has subroutines for threading of both individual sequences and subtrees. Options allow it to be run as a Gibbs sampler with single-sequence threading or a general Metropolis-Hastings sampler with subtree threading. In either case, sequential sampling is used to obtain an initial ARG. Options to the program specify the number of sampling iterations and the frequency with which samples are recorded. The program is written in a combination of C++ and Python and is reasonably well optimized. For example, it requires about 1 second to sample a threading of a single 1 Mb sequence in an ARG of 20 sequences with 20 time steps. Our source code is freely available via GitHub (<ext-link ext-link-type="uri" xlink:href="https://github.com/mdrasmus/argweaver" xlink:type="simple">https://github.com/mdrasmus/argweaver</ext-link>).</p>
<p>To summarize and visualize samples from the posterior distribution over ARGs, we use two main strategies. First, we summarize the sampled ARGs in terms of the time to most recent common ancestor (TMRCA) and total branch length at each position along the genome. We also consider the estimated age of the derived alleles at polymorphic sites, which we obtain by mapping the mutation to a branch in the local tree and calculating the average time for that branch (see <xref ref-type="sec" rid="s4">Methods</xref>). We compute posterior mean and 95% credible intervals for each of these statistics per genomic position, and create genome browser tracks that allow these values to be visualized together with other genomic annotations.</p>
<p>Second, we developed a novel visualization device for ARGs called a “leaf trace.” A leaf trace contains a line for each haploid sequence in an analyzed data set. These lines are ordered according to the local genealogy at each position in the genome, and the spacing between adjacent lines is proportional to their TMRCAs (<xref ref-type="supplementary-material" rid="pgen.1004342.s002">Figure S2</xref>). The lines are parallel in nonrecombining segments of the genome, and change in order or spacing where recombinations occur. As a result, several features of interest are immediately evident from a leaf trace. For example, recombination hot spots show up as regions with dense clusters of vertical lines, whereas recombination cold spots are indicated by long blocks of parallel lines.</p>
</sec><sec id="s2f">
<title>Simulation Study</title>
<sec id="s2f1">
<title>Effects of discretization and convergence of sampler</title>
<p>Before turning to inference, we performed a series of preliminary experiments to verify that our discretization strategy allowed for an adequate fit to the data and that <italic>ARGweaver</italic> converged to a plausible posterior distribution for realistic simulated data sets. Briefly, we found that the DSMC produces similar numbers of recombination counts and segregating sites as the coalescent-with-recombination and SMC, when generating data under various recombination rates and effective population sizes (see <xref ref-type="supplementary-material" rid="pgen.1004342.s022">Text S1</xref> and Supplementary <xref ref-type="supplementary-material" rid="pgen.1004342.s001">Figure S1</xref>). With small numbers of sequences, the Gibbs sampler based on the single-sequence threading operation appeared to converge rapidly, according to both the log likelihood of the sampled ARG and the inferred numbers of recombination events. When the number of sequences grew larger than about 6–8 (depending on the specific details of the simulation), the Gibbs sampling strategy was no longer adequate. However, the subtree threading operation and Metropolis-Hastings sampler appeared to address this problem effectively, allowing the number of sequences to be pushed to 20 or more. With 20 sequences 1 Mb in length, the sampler converges within about 500 sampling iterations, which takes about 20 minutes on a typical desktop computer (Supplementary <xref ref-type="supplementary-material" rid="pgen.1004342.s003">Figure S3</xref>).</p>
</sec><sec id="s2f2">
<title>Recovery of global ARG features</title>
<p>Next, we systematically assessed the ability of <italic>ARGweaver</italic> to recover several features of interest from simulated ARGs over a range of plausible ratios of mutation to recombination rates (see <xref ref-type="sec" rid="s4">Methods</xref> for simulation parameters). In these experiments, we considered three “global” features of the ARG: (i) the log joint probability of the ARG and the data (log of <xref ref-type="disp-formula" rid="pgen.1004342.e196">equation 2</xref>), (ii) the total number of recombinations, and (iii) the total branch length of the ARG. We define the total branch length of the ARG to be the sum of the total branch lengths of the local trees at all sites (in generations), a quantity proportional to the expected number of mutations in the history of the sample. We applied <italic>ARGweaver</italic> to each simulated data set with 500 burn-in iterations, followed by 1000 sampling iterations, with every tenth sample retained (100 samples total).</p>
<p>We found that <italic>ARGweaver</italic> was able to recover the features of interest with fairly high accuracy at all parameter settings (<xref ref-type="fig" rid="pgen-1004342-g004">Figure 4A</xref> and Supplementary <xref ref-type="supplementary-material" rid="pgen.1004342.s004">Figure S4</xref>). In addition, the variance of our estimates is generally fairly low, but does show a clear reduction as <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e311" xlink:type="simple"/></inline-formula> increases from 1 to 6, corresponding to an increase in the phylogenetic information per nonrecombining segment. Most current estimates of average rates would place the true value of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e312" xlink:type="simple"/></inline-formula> for human populations between 1 and 2 <xref ref-type="bibr" rid="pgen.1004342-Kong1">[55]</xref>–<xref ref-type="bibr" rid="pgen.1004342-Sun1">[57]</xref>, but the concentration of recombination events in hot spots implies that the ratio should be considerably more favorable for our methods across most of the genome. Notably, we do observe a slight tendency to under-estimate the number of recombinations, particularly at low values of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e313" xlink:type="simple"/></inline-formula>. This underestimation is paired with an over-estimation of the joint probability (left column), suggesting that it reflects model misspecification of the DSMC. It is possible that this bias could be improved by the use of the SMC' rather than the SMC, or by a finer-grained discretization scheme (see <xref ref-type="sec" rid="s3">Discussion</xref>).</p>
<fig id="pgen-1004342-g004" position="float"><object-id pub-id-type="doi">10.1371/journal.pgen.1004342.g004</object-id><label>Figure 4</label><caption>
<title>Simulation results.</title>
<p>(A) Recovery of global features of simulated ARGs from sequence data. This plot is based on sets of 20 1-Mb sequences generated under our standard simulation parameters (see <xref ref-type="sec" rid="s4">Methods</xref>) with <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e314" xlink:type="simple"/></inline-formula> (see Supplementary Figure 10 for additional results). From left to right are shown true (<inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e315" xlink:type="simple"/></inline-formula>-axis) versus inferred (<inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e316" xlink:type="simple"/></inline-formula>-axis) values of the log joint probability (the logarithm of <xref ref-type="disp-formula" rid="pgen.1004342.e196">equation 2</xref>), the total number of recombinations, and the total branch length of the ARG. Each data point in each plot represents one of 100 simulated data sets. In the vertical dimension, circles represent averages across 100 sampled ARGs based on the corresponding data sets, sampled at intervals of 10 after a burn-in of 200 iterations, and error bars represent the interval between the 2.5 and 97.5 percentiles. In the second and third plots, circles are interpretable as posterior expected values and error bars as 95% Bayesian credible intervals. (B) Posterior mean TMRCA (dark red line, with 95% credible intervals in light red) versus true TMRCA (black line) along a simulated genomic segment of 1 Mb. This plot is based on a single representative data set of 20 1-Mb sequences generated under our standard simulation parameters with <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e317" xlink:type="simple"/></inline-formula> (see Supplementary <xref ref-type="supplementary-material" rid="pgen.1004342.s005">Figure S5</xref> for additional results).</p>
</caption><graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pgen.1004342.g004" position="float" xlink:type="simple"/></fig></sec><sec id="s2f3">
<title>Recovery of local ARG features</title>
<p>An advantage of explicitly sampling full ARGs is that it enables inferences about local features of the ARG that are not directly determined by model parameters. Using the same simulated data and inference procedure as in the previous section, we evaluated the performance of <italic>ARGweaver</italic> in estimating three representative quantities along the genome sequence: (i) time to most recent common ancestry (TMRCA), (ii) recombination rate, and (iii) allele age. We estimated each quantity using an approximate posterior expected value, computed by averaging across sampled ARGs. With 20 sequences, we found that <italic>ARGweaver</italic> was able to recover the TMRCA with fairly high accuracy and resolution (<xref ref-type="fig" rid="pgen-1004342-g004">Figure 4B</xref>). The quality of the estimates degrades somewhat at lower values of the ratio <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e318" xlink:type="simple"/></inline-formula> but remains quite good even with <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e319" xlink:type="simple"/></inline-formula> (Supplementary <xref ref-type="supplementary-material" rid="pgen.1004342.s005">Figure S5</xref>). We found that our power for recombination rates was weak with only 20 sequences, but with 100 sequences the reconstructed ARGs clearly displayed elevated rates of recombination in simulated hotspots compared with the flanking regions (Supplementary <xref ref-type="supplementary-material" rid="pgen.1004342.s006">Figure S6</xref>). Estimates of allele ages appeared to be unbiased, with good concordance between true and estimated values, although the variance in the estimates was fairly high (Supplementary <xref ref-type="supplementary-material" rid="pgen.1004342.s007">Figure S7</xref>, left column). Notably, the ARG-based estimates of allele age appear to be considerably better than estimates based on allele frequency alone (Supplementary <xref ref-type="supplementary-material" rid="pgen.1004342.s007">Figure S7</xref>, right column). Together, these results suggest that, even with modest numbers of sequences, the distributions of ARGs inferred by our methods may be informative about loci under natural selection, local recombination rates, and other local features of evolutionary history.</p>
</sec><sec id="s2f4">
<title>Accuracy of local tree topologies</title>
<p>In our next experiment, we evaluated the accuracy of <italic>ARGweaver</italic> in inferring the topology of the local trees, again using the same simulated data. The local trees are a more complex feature of the ARG but are of particular interest for applications such as genotype imputation and association mapping. For comparison, we also inferred local trees using the heuristic <italic>Margarita</italic> program <xref ref-type="bibr" rid="pgen.1004342-Minichiello1">[34]</xref>, which is, to our knowledge, the only other published ARG-inference method that can be applied at this scale. In addition, we applied an unpublished method, called <italic>treesim</italic> (<ext-link ext-link-type="uri" xlink:href="http://niallcardin.com/treesim/index.html" xlink:type="simple">http://niallcardin.com/treesim/index.html</ext-link>), that samples genealogies using heuristic extensions of the Monte Carlo methods of Fearnhead and Donnelly <xref ref-type="bibr" rid="pgen.1004342-Fearnhead1">[22]</xref>. To compare these programs, we identified 100 evenly spaced locations in our simulated data sets, and extracted the local trees reconstructed by all three methods at these positions. We found that <italic>ARGweaver</italic> produced more accurate local tree topologies than both <italic>Margarita</italic> and <italic>treesim</italic> across most values of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e320" xlink:type="simple"/></inline-formula>, except for the case of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e321" xlink:type="simple"/></inline-formula>, where <italic>treesim</italic> performed slightly better (Supplementary <xref ref-type="supplementary-material" rid="pgen.1004342.s008">Figure S8</xref>). The improvements were most pronounced at high <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e322" xlink:type="simple"/></inline-formula> values, where topological information is greatest. In addition, the absolute accuracy of the trees inferred by <italic>ARGweaver</italic> was fairly high, given the sparseness of informative sites in these data sets. For example, at <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e323" xlink:type="simple"/></inline-formula>, more than 80% of predicted branches were correct and Maximum Agreement Subtree (MAST) percentages approached 75%, and even in the challenging case of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e324" xlink:type="simple"/></inline-formula>, over 60% of branches were correct and MAST percentages exceeded 50%. These results indicate that the sampler is effectively pooling information from many sites across the multiple alignment in making inferences about local tree topologies.</p>
<p>Finally, we evaluated the accuracy of <italic>ARGweaver</italic>'s assessment of the uncertainty about the local trees given the data. We grouped individual branches into bins according to their estimated posterior probabilities (i.e., the fraction of sampled local trees in which each branch is found), and compared these values with the relative frequencies with which the same branches were observed in the true trees. We found that the predicted and actual probabilities of correctness were closely correlated, indicating that <italic>ARGweaver</italic> is accurately measuring the uncertainty associated with the local trees (Supplementary <xref ref-type="supplementary-material" rid="pgen.1004342.s009">Figure S9</xref>). By contrast, the heuristic <italic>Margarita</italic> sampler shows a clear tendency to overestimate the confidence associated with branches in the local trees, often by 10–20%. This comparison is not entirely fair, because the authors of <italic>Margarita</italic> do not claim that it samples from the posterior distribution, but it nevertheless highlights an important advantage of the Bayesian approach. Notably, the unpublished <italic>treesim</italic> program performed remarkably well on this test.</p>
</sec></sec><sec id="s2g">
<title>Analysis of Real Data</title>
<p>Having demonstrated that <italic>ARGweaver</italic> was able to recover many features of simulated ARGs with reasonable accuracy, we turned to an analysis of real human genome sequences. For this analysis we chose to focus on sequences for 54 unrelated individuals from the “69 genomes” data set from Complete Genomics (<ext-link ext-link-type="uri" xlink:href="http://www.completegenomics.com/public-data/69-Genomes" xlink:type="simple">http://www.completegenomics.com/public-data/69-Genomes</ext-link>) <xref ref-type="bibr" rid="pgen.1004342-Drmanac1">[58]</xref>. The 54 genome sequences were computationally phased using SHAPEIT v2 <xref ref-type="bibr" rid="pgen.1004342-Delaneau1">[59]</xref> and were filtered in various ways to minimize the influence from alignment and genotype-calling errors. They were partitioned into ∼2-Mb blocks and <italic>ARGweaver</italic> was applied to these blocks in parallel using the Extreme Science and Engineering Discovery Environment (XSEDE). For this analysis, we assumed <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e325" xlink:type="simple"/></inline-formula> <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e326" xlink:type="simple"/></inline-formula> generations, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e327" xlink:type="simple"/></inline-formula>, and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e328" xlink:type="simple"/></inline-formula>, implying <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e329" xlink:type="simple"/></inline-formula>. We allowed for variation across loci in mutation and recombination rates. For each ∼2-Mb block, we collected samples for 2,000 iterations of the sampler and retained every tenth sample, after an appropriate burn-in (see <xref ref-type="sec" rid="s4">Methods</xref> for complete details). The entire procedure took ∼36 hours for each of the 1,376 2-Mb blocks, or 5.7 CPU-years of total compute time. The sampled ARGs were summarized by UCSC Genome Browser tracks describing site-specific times to most recent common ancestry (TMRCA), total branch length, allele ages, leaf traces, and other features across the human genome. These tracks are publicly available from our local mirror of the UCSC Genome Browser (<ext-link ext-link-type="uri" xlink:href="http://genome-mirror.bscb.cornell.edu" xlink:type="simple">http://genome-mirror.bscb.cornell.edu</ext-link>, assembly hg19).</p>
<sec id="s2g1">
<title>Distortions in the ARG due to natural selection</title>
<p>While our prior distribution over ARGs is based on the neutral coalescent, we were interested in exploring whether natural selection produces a sufficiently strong signal in the data to create detectable distortions in the ARG near functional elements. We began by examining the estimated posterior expected values of the TMRCA around known protein-coding genes, focusing on fourfold degenerate (4d) sites within coding exons and noncoding sites flanking exons. For comparison with our ARG-based measures, we also computed a simple measure of nucleotide diversity, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e330" xlink:type="simple"/></inline-formula>. Both <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e331" xlink:type="simple"/></inline-formula> and the ARG-based TMRCA behave in a qualitatively similar manner near genes, achieving minimal values in coding exons and gradually increasing with distance from exon boundaries (<xref ref-type="fig" rid="pgen-1004342-g005">Figure 5A</xref>). These observations are consistent with several recent studies indicating reduced neutral diversity near both coding and noncoding functional elements, which has been attributed to indirect effects from selection at linked sites <xref ref-type="bibr" rid="pgen.1004342-McVicker1">[60]</xref>–<xref ref-type="bibr" rid="pgen.1004342-Lohmueller1">[64]</xref>. However, it has been difficult to distinguish between two alternative modes of selection both predicted to have similar influences on patterns of neutral diversity: “background selection” (BGS) associated with negative or purifying selection at linked sites <xref ref-type="bibr" rid="pgen.1004342-Charlesworth1">[65]</xref>–<xref ref-type="bibr" rid="pgen.1004342-Charlesworth2">[68]</xref>, and “hitchhiking” (HH) (selective sweeps) associated with linked mutations under positive selection <xref ref-type="bibr" rid="pgen.1004342-MaynardSmith1">[69]</xref>. In principle, explicit ARG inference could help to resolve this controversy, because BGS and HH lead to different predictions for the structure of genealogies (e.g., <xref ref-type="bibr" rid="pgen.1004342-Barton1">[70]</xref>, <xref ref-type="bibr" rid="pgen.1004342-Walczak1">[71]</xref>).</p>
<fig id="pgen-1004342-g005" position="float"><object-id pub-id-type="doi">10.1371/journal.pgen.1004342.g005</object-id><label>Figure 5</label><caption>
<title>Measures of genetic variation near protein-coding genes and partial selective sweeps.</title>
<p>Shown (from top to bottom) are nucleotide diversity (<inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e332" xlink:type="simple"/></inline-formula>), time to most recent common ancestry (TMRCA), and relative TMRCA halflife (RTH) for the 13 individuals (26 haploid genomes) of European descent (CEU and TSI populations) in the Complete Genomics data set (similar plots for African population are shown in Supplementary <xref ref-type="supplementary-material" rid="pgen.1004342.s011">Figure S11</xref>). Nucleotide diversity <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e333" xlink:type="simple"/></inline-formula> was computed as the average rate of nucleotide differences per site across all pairs of chromosomes, whereas sitewise values of the TMRCA and RTH were computed by averaging over local trees sampled by <italic>ARGweaver</italic>. (A) Estimates for 17,845 protein-coding genes from the Consensus Coding Sequence (CCDS) track in the UCSC Genome Browser (hg19). Estimates for noncoding regions were computed by averaging in a sliding window of size 300 bp then averaging across genes. Estimates for coding exons were computed by first averaging over fourfold degenerate (4d) sites of each exonic type (first, middle, last), then averaging across genes (see <xref ref-type="sec" rid="s4">Methods</xref>). Only 4d sites were considered to focus on the influence of selection from linked sites rather than direct selection. Nevertheless, the decreased values for the exons suggest some influence from direct selection. The differences between exons and flanking sites may also be influenced by windowing in the noncoding regions. “First exon” is taken to begin at the annotated start codon and “last exon” to end at the stop codon, so that both exclude untranslated regions. The TMRCA is measured in thousands of generations. RTH is ratio of the time required for the first 50% of lineages to find a most recent common ancestor to the full TMRCA (see Supplementary <xref ref-type="supplementary-material" rid="pgen.1004342.s010">Figure S10</xref>). Error bars (dashed lines for noncoding regions) indicate 95% confidence intervals as estimated by bootstrapping over regions. (B) Similar plots for 255 100-kb regions predicted to have undergone partial selective sweeps in the CEU population based on the iHS statistic <xref ref-type="bibr" rid="pgen.1004342-Voight2">[72]</xref>. In this case, all measures are computed in a sliding window of 10,000 bases. Notice that both protein-coding genes and putative selective sweeps display substantial reductions in nucleotide diversity, but the genes show a much more prominent reduction in TMRCA, whereas the sweeps show a much more prominent reduction in RTH. These signatures are consistent with a dominant influence from background selection rather than hitchhiking in protein-coding genes (see text).</p>
</caption><graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pgen.1004342.g005" position="float" xlink:type="simple"/></fig>
<p>To examine these questions further, we computed the same statistics for 255 putative partial selective sweeps identified in CEU populations and 271 partial sweeps identified in YRI populations based on the integrated extended haplotype homozygosity statistic (iHS) <xref ref-type="bibr" rid="pgen.1004342-Voight2">[72]</xref>. As expected, the sweep regions were broadly similar to the protein-coding genes in terms of nucleotide diversity <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e334" xlink:type="simple"/></inline-formula> (<xref ref-type="fig" rid="pgen-1004342-g005">Figure 5B</xref>). However, unlike the protein-coding genes, the sweep regions displayed no clear depression in TMRCA. One possible way of understanding this observation is that, while sweeps tend to be enriched overall for recent coalescence events (as indicated by the reductions in <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e335" xlink:type="simple"/></inline-formula>), the oldest coalescence events are relatively unaffected by selective sweeps, perhaps because some lineages tend to “escape” each sweep, leading to near-neutral patterns of coalescence near the roots of genealogies (where the contribution to the TMRCA is greatest). This may be particularly true for the partial sweeps identified by the iHS method, but a similar phenomenon should occur in flanking regions of the causal mutations for complete sweeps. BGS, by contrast, is expected to affect both the total branch length and TMRCA approximately equally, by effectively reducing the time scale of the coalescence process, but to have a minimal influence on the relative intervals between coalescence events.</p>
<p>In an attempt to distinguish further between BGS and HH, we introduced a statistic called the <italic>relative TMRCA halflife</italic> (RTH), defined as the ratio between the time to most recent common ancestry for the first 50% of chromosomes and the full TMRCA. The RTH captures the degree to which coalescence events are skewed toward the recent past, in a manner that does not depend on the overall rate of coalescence. Thus, the RTH should be relatively insensitive to BGS, but sensitive to HH if, as proposed above, sweeps tend to affect many but not all lineages (see Supplementary <xref ref-type="supplementary-material" rid="pgen.1004342.s010">Figure S10</xref>). In the European populations, the statistic showed a pronounced valley near selective sweeps (<xref ref-type="fig" rid="pgen-1004342-g005">Figure 5B</xref>), as expected, but it was much more constant across genic regions (<xref ref-type="fig" rid="pgen-1004342-g005">Figure 5A</xref>). Its behavior was similar in the African populations, except that it showed somewhat more variability near genes, yet in an opposite pattern from the sweeps (Supplementary <xref ref-type="supplementary-material" rid="pgen.1004342.s011">Figure S11</xref>). Overall, these results suggest that, while the total rate of coalescence differs substantially across genic regions, the relative depths of middle and extreme coalescence events do not, on average, consistent with the predictions of a model in which BGS dominates in genes <xref ref-type="bibr" rid="pgen.1004342-McVicker1">[60]</xref>, <xref ref-type="bibr" rid="pgen.1004342-Hernandez1">[62]</xref>, <xref ref-type="bibr" rid="pgen.1004342-Lohmueller1">[64]</xref>. The sharply contrasting patterns for the iHS-identified sweeps suggest that partial sweeps of this kind make at most a minor contribution to the reduced diversity near protein-coding exons. Nevertheless, these observations do not rule out the possibility that alternative modes of hitchhiking for which iHS has low power—such as recurrent hard or soft sweeps—might make a non-negligible contribution to patterns of variation near human protein-coding genes (see <xref ref-type="sec" rid="s3">Discussion</xref>).</p>
</sec><sec id="s2g2">
<title>Genomic regions with extremely ancient most recent common ancestry</title>
<p>The previous section showed that genomic regions with reduced TMRCAs are often associated with purifying selection. To see whether the opposite signal was also of interest, we computed the posterior expected TMRCA in 10-kb blocks across the human genome and examined the regions displaying the oldest shared ancestry. Not surprisingly, four of the top twenty 10-kb blocks by TMRCA fall in the human leukocyte antigen (HLA) region on chromosome 6 (see <xref ref-type="table" rid="pgen-1004342-t002">Table 2</xref>). It has been known for decades that the HLA region exhibits extraordinary levels of genetic diversity, which is believed to be maintained by some type of balancing selection (overdominance or frequency-dependent selection) associated with the immunity-related functions of the HLA system <xref ref-type="bibr" rid="pgen.1004342-Hughes1">[73]</xref>–<xref ref-type="bibr" rid="pgen.1004342-Hughes2">[75]</xref>. The four HLA-related high-TMRCA blocks include three regions near <italic>HLA-F</italic> and one region between <italic>HLA-A</italic> and <italic>HLA-J</italic> (Supplementary <xref ref-type="supplementary-material" rid="pgen.1004342.s012">Figure S12</xref>). All four high-TMRCA regions exhibit more than 12 polymorphisms per kilobase of unfiltered sequence, 8–10 times the expected neutral rate after normalizing for local mutation rates (as detailed in <xref ref-type="table" rid="pgen-1004342-t002">Table 2</xref>; see also Supplementary <xref ref-type="supplementary-material" rid="pgen.1004342.s013">Figure S13</xref>). The estimated TMRCAs for these regions range from ∼340,000–380,000 generations, or ∼8.5–9.5 My (assuming 25-year generations).</p>
<table-wrap id="pgen-1004342-t002" position="float"><object-id pub-id-type="doi">10.1371/journal.pgen.1004342.t002</object-id><label>Table 2</label><caption>
<title>Top twenty 10 kb regions in the human genome by estimated TMRCA.</title>
</caption><alternatives><graphic id="pgen-1004342-t002-2" position="float" mimetype="image" xlink:href="info:doi/10.1371/journal.pgen.1004342.t002" xlink:type="simple"/>
<table><colgroup span="1"><col align="left" span="1"/><col align="center" span="1"/><col align="center" span="1"/><col align="center" span="1"/><col align="center" span="1"/><col align="center" span="1"/><col align="center" span="1"/><col align="center" span="1"/><col align="center" span="1"/></colgroup>
<thead>
<tr>
<td align="left" rowspan="1" colspan="1">#</td>
<td align="left" rowspan="1" colspan="1">Chr<xref ref-type="table-fn" rid="nt102">a</xref></td>
<td align="left" rowspan="1" colspan="1">Start</td>
<td align="left" rowspan="1" colspan="1">End</td>
<td align="left" rowspan="1" colspan="1">TMRCA<xref ref-type="table-fn" rid="nt103">b</xref></td>
<td align="left" rowspan="1" colspan="1">Poly/kb<xref ref-type="table-fn" rid="nt104">c</xref></td>
<td align="left" rowspan="1" colspan="1">Npoly<xref ref-type="table-fn" rid="nt105">d</xref></td>
<td align="left" rowspan="1" colspan="1">CNV<xref ref-type="table-fn" rid="nt106">e</xref></td>
<td align="left" rowspan="1" colspan="1">Comments</td>
</tr>
</thead>
<tbody>
<tr>
<td align="left" rowspan="1" colspan="1">1</td>
<td align="left" rowspan="1" colspan="1">chr4</td>
<td align="left" rowspan="1" colspan="1">190590001</td>
<td align="left" rowspan="1" colspan="1">190600000</td>
<td align="left" rowspan="1" colspan="1">615775</td>
<td align="left" rowspan="1" colspan="1">16.6</td>
<td align="left" rowspan="1" colspan="1">32.8</td>
<td align="left" rowspan="1" colspan="1"><monospace>√</monospace></td>
<td align="left" rowspan="1" colspan="1">Part of large intergenic region near telomere of long arm of chr 4 (see <xref ref-type="bibr" rid="pgen.1004342-Hodgkinson1">[76]</xref>)</td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1">2</td>
<td align="left" rowspan="1" colspan="1">chr5</td>
<td align="left" rowspan="1" colspan="1">21560001</td>
<td align="left" rowspan="1" colspan="1">21570000</td>
<td align="left" rowspan="1" colspan="1">503311</td>
<td align="left" rowspan="1" colspan="1">16.2</td>
<td align="left" rowspan="1" colspan="1">5.1</td>
<td align="left" rowspan="1" colspan="1"><monospace>√</monospace></td>
<td align="left" rowspan="1" colspan="1">Intron of <italic>GUSBP1</italic></td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1">3</td>
<td align="left" rowspan="1" colspan="1">chr3</td>
<td align="left" rowspan="1" colspan="1">97930001</td>
<td align="left" rowspan="1" colspan="1">97940000</td>
<td align="left" rowspan="1" colspan="1">479803</td>
<td align="left" rowspan="1" colspan="1">16.4</td>
<td align="left" rowspan="1" colspan="1">5.3</td>
<td align="left" rowspan="1" colspan="1"/>
<td align="left" rowspan="1" colspan="1">Intergenic region in cluster of olfactory receptor genes</td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1">4</td>
<td align="left" rowspan="1" colspan="1">chr6</td>
<td align="left" rowspan="1" colspan="1">57270001</td>
<td align="left" rowspan="1" colspan="1">57280000</td>
<td align="left" rowspan="1" colspan="1">479504</td>
<td align="left" rowspan="1" colspan="1">13.7</td>
<td align="left" rowspan="1" colspan="1">28.0</td>
<td align="left" rowspan="1" colspan="1"><monospace>√</monospace></td>
<td align="left" rowspan="1" colspan="1">Intron of <italic>PRIM2</italic></td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1">5</td>
<td align="left" rowspan="1" colspan="1">chr2</td>
<td align="left" rowspan="1" colspan="1">223940001</td>
<td align="left" rowspan="1" colspan="1">223950000</td>
<td align="left" rowspan="1" colspan="1">449728</td>
<td align="left" rowspan="1" colspan="1">19.8</td>
<td align="left" rowspan="1" colspan="1">4.3</td>
<td align="left" rowspan="1" colspan="1"/>
<td align="left" rowspan="1" colspan="1">Intergenic region downstream of <italic>KCNE4</italic></td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1">6</td>
<td align="left" rowspan="1" colspan="1">chr5</td>
<td align="left" rowspan="1" colspan="1">21550001</td>
<td align="left" rowspan="1" colspan="1">21560000</td>
<td align="left" rowspan="1" colspan="1">412679</td>
<td align="left" rowspan="1" colspan="1">14.2</td>
<td align="left" rowspan="1" colspan="1">4.4</td>
<td align="left" rowspan="1" colspan="1"><monospace>√</monospace></td>
<td align="left" rowspan="1" colspan="1">Intron of <italic>GUSBP1</italic></td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1">7</td>
<td align="left" rowspan="1" colspan="1">chr6</td>
<td align="left" rowspan="1" colspan="1">57220001</td>
<td align="left" rowspan="1" colspan="1">57230000</td>
<td align="left" rowspan="1" colspan="1">399887</td>
<td align="left" rowspan="1" colspan="1">16.2</td>
<td align="left" rowspan="1" colspan="1">12.8</td>
<td align="left" rowspan="1" colspan="1"><monospace>√</monospace></td>
<td align="left" rowspan="1" colspan="1">Intron of <italic>PRIM2</italic></td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1">8</td>
<td align="left" rowspan="1" colspan="1">chr6</td>
<td align="left" rowspan="1" colspan="1">29680001</td>
<td align="left" rowspan="1" colspan="1">29690000</td>
<td align="left" rowspan="1" colspan="1">380228</td>
<td align="left" rowspan="1" colspan="1">15.3</td>
<td align="left" rowspan="1" colspan="1">10.0</td>
<td align="left" rowspan="1" colspan="1"/>
<td align="left" rowspan="1" colspan="1">Intergenic region upstream of <italic>HLA-F</italic></td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1">9</td>
<td align="left" rowspan="1" colspan="1">chr1</td>
<td align="left" rowspan="1" colspan="1">94220001</td>
<td align="left" rowspan="1" colspan="1">94230000</td>
<td align="left" rowspan="1" colspan="1">377017</td>
<td align="left" rowspan="1" colspan="1">8.0</td>
<td align="left" rowspan="1" colspan="1">4.2</td>
<td align="left" rowspan="1" colspan="1"/>
<td align="left" rowspan="1" colspan="1">Intron of <italic>BCAR3</italic></td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1">10</td>
<td align="left" rowspan="1" colspan="1">chr8</td>
<td align="left" rowspan="1" colspan="1">123070001</td>
<td align="left" rowspan="1" colspan="1">123080000</td>
<td align="left" rowspan="1" colspan="1">375128</td>
<td align="left" rowspan="1" colspan="1">15.3</td>
<td align="left" rowspan="1" colspan="1">4.2</td>
<td align="left" rowspan="1" colspan="1"/>
<td align="left" rowspan="1" colspan="1">Intron of <italic>BC052578</italic></td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1">11</td>
<td align="left" rowspan="1" colspan="1">chr11</td>
<td align="left" rowspan="1" colspan="1">55670001</td>
<td align="left" rowspan="1" colspan="1">55680000</td>
<td align="left" rowspan="1" colspan="1">374537</td>
<td align="left" rowspan="1" colspan="1">12.0</td>
<td align="left" rowspan="1" colspan="1">4.3</td>
<td align="left" rowspan="1" colspan="1"/>
<td align="left" rowspan="1" colspan="1">Intergenic region between <italic>TRIM51</italic> and <italic>OR5W2</italic></td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1">12</td>
<td align="left" rowspan="1" colspan="1">chr6</td>
<td align="left" rowspan="1" colspan="1">29950001</td>
<td align="left" rowspan="1" colspan="1">29960000</td>
<td align="left" rowspan="1" colspan="1">371110</td>
<td align="left" rowspan="1" colspan="1">17.6</td>
<td align="left" rowspan="1" colspan="1">7.6</td>
<td align="left" rowspan="1" colspan="1"/>
<td align="left" rowspan="1" colspan="1">Intergenic region between <italic>HLA-A</italic> and <italic>HLA-J</italic></td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1">13</td>
<td align="left" rowspan="1" colspan="1">chr17</td>
<td align="left" rowspan="1" colspan="1">64010001</td>
<td align="left" rowspan="1" colspan="1">64020000</td>
<td align="left" rowspan="1" colspan="1">367842</td>
<td align="left" rowspan="1" colspan="1">8.6</td>
<td align="left" rowspan="1" colspan="1">5.5</td>
<td align="left" rowspan="1" colspan="1"/>
<td align="left" rowspan="1" colspan="1">Intron of <italic>CEP112</italic></td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1">14</td>
<td align="left" rowspan="1" colspan="1">chr6</td>
<td align="left" rowspan="1" colspan="1">29670001</td>
<td align="left" rowspan="1" colspan="1">29680000</td>
<td align="left" rowspan="1" colspan="1">365313</td>
<td align="left" rowspan="1" colspan="1">15.8</td>
<td align="left" rowspan="1" colspan="1">10.1</td>
<td align="left" rowspan="1" colspan="1"/>
<td align="left" rowspan="1" colspan="1">Intergenic region upstream of <italic>HLA-F</italic></td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1">15</td>
<td align="left" rowspan="1" colspan="1">chr11</td>
<td align="left" rowspan="1" colspan="1">55690001</td>
<td align="left" rowspan="1" colspan="1">55700000</td>
<td align="left" rowspan="1" colspan="1">361088</td>
<td align="left" rowspan="1" colspan="1">11.5</td>
<td align="left" rowspan="1" colspan="1">4.1</td>
<td align="left" rowspan="1" colspan="1"/>
<td align="left" rowspan="1" colspan="1">Intergenic region between <italic>OR5W2</italic> and <italic>OR5I1</italic></td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1">16</td>
<td align="left" rowspan="1" colspan="1">chr6</td>
<td align="left" rowspan="1" colspan="1">158680001</td>
<td align="left" rowspan="1" colspan="1">158690000</td>
<td align="left" rowspan="1" colspan="1">345382</td>
<td align="left" rowspan="1" colspan="1">10.4</td>
<td align="left" rowspan="1" colspan="1">4.8</td>
<td align="left" rowspan="1" colspan="1"/>
<td align="left" rowspan="1" colspan="1">Intergenic region upstream of <italic>TULP4</italic></td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1">17</td>
<td align="left" rowspan="1" colspan="1">chr6</td>
<td align="left" rowspan="1" colspan="1">29720001</td>
<td align="left" rowspan="1" colspan="1">29730000</td>
<td align="left" rowspan="1" colspan="1">341797</td>
<td align="left" rowspan="1" colspan="1">12.4</td>
<td align="left" rowspan="1" colspan="1">8.0</td>
<td align="left" rowspan="1" colspan="1"/>
<td align="left" rowspan="1" colspan="1">Intergenic region between <italic>HLA-F</italic> and <italic>HLA-G</italic></td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1">18</td>
<td align="left" rowspan="1" colspan="1">chr17</td>
<td align="left" rowspan="1" colspan="1">43790001</td>
<td align="left" rowspan="1" colspan="1">43800000</td>
<td align="left" rowspan="1" colspan="1">335647</td>
<td align="left" rowspan="1" colspan="1">11.2</td>
<td align="left" rowspan="1" colspan="1">5.0</td>
<td align="left" rowspan="1" colspan="1"/>
<td align="left" rowspan="1" colspan="1">Intron of <italic>CRHR1</italic></td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1">19</td>
<td align="left" rowspan="1" colspan="1">chr6</td>
<td align="left" rowspan="1" colspan="1">8470001</td>
<td align="left" rowspan="1" colspan="1">8480000</td>
<td align="left" rowspan="1" colspan="1">325656</td>
<td align="left" rowspan="1" colspan="1">10.1</td>
<td align="left" rowspan="1" colspan="1">4.5</td>
<td align="left" rowspan="1" colspan="1"/>
<td align="left" rowspan="1" colspan="1">Intron of noncoding RNA <italic>LOC100506207</italic></td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1">20</td>
<td align="left" rowspan="1" colspan="1">chr4</td>
<td align="left" rowspan="1" colspan="1">141920001</td>
<td align="left" rowspan="1" colspan="1">141930000</td>
<td align="left" rowspan="1" colspan="1">325570</td>
<td align="left" rowspan="1" colspan="1">12.1</td>
<td align="left" rowspan="1" colspan="1">3.2</td>
<td align="left" rowspan="1" colspan="1"/>
<td align="left" rowspan="1" colspan="1">Intron of <italic>RNF150</italic></td>
</tr>
</tbody>
</table>
</alternatives><table-wrap-foot><fn id="nt102"><label>a</label><p>Genomic coordinates in hg19 assembly. The genome was simply partitioned into nonoverlapping 10 kb intervals in hg19 coordinates.</p></fn><fn id="nt103"><label>b</label><p>Posterior expected TMRCA in generations, averaged across unfiltered genomic positions in region.</p></fn><fn id="nt104"><label>c</label><p>Number of polymorphisms in Complete Genomics dataset in region per kilobase of unfiltered sequence.</p></fn><fn id="nt105"><label>d</label><p>Normalized polymorphism rate: number of polymorphisms per unfiltered kilobase divided first by the local mutation rate (as estimated from divergence to nonhuman primate outgroup genomes) then by the average of the same polymorphism/divergence ratio in designated neutral regions. The resulting value can be interpreted as a fold increase in the mutation-normalized polymorphism rate compared with the expectation under neutrality. The same measure was computed from the much larger 1000 Genomes Project Phase 1 data set, and was significantly elevated in these 20 high-TMRCA regions (Supplementary <xref ref-type="supplementary-material" rid="pgen.1004342.s013">Figure S13</xref>).</p></fn><fn id="nt106"><label>e</label><p>Possible copy number variant (CNV), based on Complete Genomics “hypervariable” or “invariant” labels (see <xref ref-type="sec" rid="s4">Methods</xref>). Polymorphism rates in these regions may be over-estimated.</p></fn></table-wrap-foot></table-wrap>
<p>Among these high-TMRCA blocks were two additional regions that displayed extraordinary levels of mutation-rate-normalized nucleotide diversity. The first of these, in a gene desert near the telomere of the long arm of chromosome 4, exhibits the deepest expected TMRCA in the genome, at &gt;600,000 generations (15 My), and has &gt;30 times the neutral polymorphism rate (<xref ref-type="table" rid="pgen-1004342-t002">Table 2</xref>). The second region is the <italic>PRIM2</italic> gene on chromosome 6, which contributes the 4th and 7th highest TMRCA blocks in the genome, exhibiting polymorphism rates 28.0 and 12.8 times the neutral expectation, respectively. Both of these regions were identified as extreme outliers in a recent study of coincident SNPs in humans and chimpanzees, and it was argued that the <italic>PRIM2</italic> gene was a likely target of balancing selection <xref ref-type="bibr" rid="pgen.1004342-Hodgkinson1">[76]</xref>. On closer inspection, however, we found that both regions were flagged by Complete Genomics as having “hypervariable” or “invariant” read depth across individuals, suggesting that the elevated SNP rates in our data are likely artifacts of copy number variation (CNV) at loci unduplicated in the reference genome. (Leffler et al. recently reached a similar conclusion about <italic>PRIM2</italic> <xref ref-type="bibr" rid="pgen.1004342-Leffler1">[77]</xref>.) Despite that these flags were associated with only ∼5% of genomic positions, they indicated that five of our top six regions were likely CNVs (<xref ref-type="table" rid="pgen-1004342-t002">Table 2</xref>). Thus, for all subsequent analyses reported in this paper and for our publicly available browser tracks, we filtered out all regions labeled as invariant or hypervariable.</p>
<p>Once these extreme outliers were excluded, several loci of interest remained. In addition to the four <italic>HLA</italic> loci, these included (#5 in <xref ref-type="table" rid="pgen-1004342-t002">Table 2</xref>) an apparent <italic>cis</italic>-regulatory region downstream of the <italic>KCNE4</italic> gene, which encodes a potassium voltage-gated channel (Supplementary <xref ref-type="supplementary-material" rid="pgen.1004342.s014">Figure S14</xref>); (#9) an intronic interval in <italic>BCAR3</italic>, a gene involved in the development of anti-estrogen resistance in breast cancer (Supplementary <xref ref-type="supplementary-material" rid="pgen.1004342.s015">Figure S15</xref>); (#16) an apparent regulatory region upstream of <italic>TULP4</italic>, a tubby-like protein that may be involved in ubiquitination and proteasomal degradation with a possible association with cleft lip (Supplementary <xref ref-type="supplementary-material" rid="pgen.1004342.s016">Figure S16</xref>); and (#18) an intronic region in <italic>CRHR1</italic>, which encodes a GPCR that binds corticotropin releasing hormones, has roles in in stress, reproduction, immunity, and obesity, and is associated with alcohol abuse, asthma, and depression. Notably, all of these are predominantly noncoding regions that include multiple ChIP-seq-supported transcription factor binding sites. The estimated TMRCAs of these regions range from 335,000–450,000 generations (8.4–11.3 My), suggesting genetic variation in these loci considerably predates the human/chimpanzee divergence.</p>
</sec><sec id="s2g3">
<title>Segregating haplotypes shared between humans and chimpanzees</title>
<p>To explore the connection between extreme TMRCAs and balancing selection further, we examined 125 loci recently identified as having segregating haplotypes that are shared between humans and chimpanzees <xref ref-type="bibr" rid="pgen.1004342-Leffler1">[77]</xref>. These loci are expected to be enriched for ancient polymorphisms maintained by balancing selection, although some may reflect independent occurrences of the same mutation in both species. We compared these putative balancing selection loci with neutral sequences having the same length distribution (see <xref ref-type="sec" rid="s4">Methods</xref>), and found that their <italic>ARGweaver</italic>-estimated TMRCAs were clearly shifted toward higher values, with a mean value nearly twice as large as that of the neutral sequences (Supplementary <xref ref-type="supplementary-material" rid="pgen.1004342.s017">Figure S17</xref>). In addition, the putative balancing selection loci that do not contain polymorphisms in CpG dinucleotides—which are less likely to have experienced parallel mutations—had slightly higher TMRCAs than the group as a whole.</p>
<p>If these loci are sorted by their estimated TMRCAs, several loci that were highlighted by Leffler et al. <xref ref-type="bibr" rid="pgen.1004342-Leffler1">[77]</xref> for having more than two pairs of shared SNPs in high LD appear near the top of the list (<xref ref-type="table" rid="pgen-1004342-t003">Table 3</xref>). For example, the haplotype between the <italic>FREM3</italic> and <italic>GYPE</italic> genes (#11 in <xref ref-type="table" rid="pgen-1004342-t003">Table 3</xref>; Supplementary <xref ref-type="supplementary-material" rid="pgen.1004342.s018">Figure S18</xref>) contains shared SNPs in almost perfect LD with several expression quantitative trait loci (eQTLs) for <italic>GYPE</italic>, a close paralog of a gene (<italic>GYPA</italic>) that encodes a receptor for <italic>Plasmodium falciparum</italic> and may be under balancing selection. Another haplotype (#3) contains shared SNPs in significant LD with an eQTL for <italic>MTRR</italic>, a gene implicated in the regulation of folate metabolism, including one SNP that is also segregating in gorillas. In a third case (#18), the shared SNPs occur in a likely enhancer in an intron of <italic>IGFBP7</italic>, a gene that plays a role in innate immunity, among other functions. Another example is a locus near the <italic>ST3GAL1</italic> gene (#7) that contains only one pair of shared SNPs but was suggested by a phylogenetic analysis to have an ancient origin <xref ref-type="bibr" rid="pgen.1004342-Leffler1">[77]</xref>. Notably, all of these shared haplotypes fall outside of coding regions and several show signs of regulatory activity based on functional genomic data <xref ref-type="bibr" rid="pgen.1004342-Leffler1">[77]</xref>. Their expected TMRCAs range from roughly 150,000 to 250,000 generations, or 3.8–6.3 My. Thus, the <italic>ARGweaver</italic> estimates of age are reasonably consistent with the hypothesis that these hapolotypes predate the human/chimpanzee divergence (estimated at 3.7–6.6 Mya <xref ref-type="bibr" rid="pgen.1004342-Sun1">[57]</xref>), an observation that is especially notable given that our analysis does not make direct use of data from chimpanzees.</p>
<table-wrap id="pgen-1004342-t003" position="float"><object-id pub-id-type="doi">10.1371/journal.pgen.1004342.t003</object-id><label>Table 3</label><caption>
<title>Top twenty regions of shared human/chimpanzee haplotypes by estimated TMRCA.</title>
</caption><alternatives><graphic id="pgen-1004342-t003-3" position="float" mimetype="image" xlink:href="info:doi/10.1371/journal.pgen.1004342.t003" xlink:type="simple"/>
<table><colgroup span="1"><col align="left" span="1"/><col align="center" span="1"/><col align="center" span="1"/><col align="center" span="1"/><col align="center" span="1"/><col align="center" span="1"/><col align="center" span="1"/><col align="center" span="1"/><col align="center" span="1"/></colgroup>
<thead>
<tr>
<td align="left" rowspan="1" colspan="1">#</td>
<td align="left" rowspan="1" colspan="1">Chr<xref ref-type="table-fn" rid="nt107">a</xref></td>
<td align="left" rowspan="1" colspan="1">Start</td>
<td align="left" rowspan="1" colspan="1">End</td>
<td align="left" rowspan="1" colspan="1">TMRCA<xref ref-type="table-fn" rid="nt108">b</xref></td>
<td align="left" rowspan="1" colspan="1">Poly/kb<xref ref-type="table-fn" rid="nt109">c</xref></td>
<td align="left" rowspan="1" colspan="1">Npoly<xref ref-type="table-fn" rid="nt110">d</xref></td>
<td align="left" rowspan="1" colspan="1">CNV<xref ref-type="table-fn" rid="nt111">e</xref></td>
<td align="left" rowspan="1" colspan="1">Comments</td>
</tr>
</thead>
<tbody>
<tr>
<td align="left" rowspan="1" colspan="1">1</td>
<td align="left" rowspan="1" colspan="1">chr7</td>
<td align="left" rowspan="1" colspan="1">47799979</td>
<td align="left" rowspan="1" colspan="1">47803415</td>
<td align="left" rowspan="1" colspan="1">307590</td>
<td align="left" rowspan="1" colspan="1">10.5</td>
<td align="left" rowspan="1" colspan="1">2.9</td>
<td align="left" rowspan="1" colspan="1"/>
<td align="left" rowspan="1" colspan="1">First exon/intron of <italic>LINC00525</italic></td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1">2</td>
<td align="left" rowspan="1" colspan="1">chr4</td>
<td align="left" rowspan="1" colspan="1">56144164</td>
<td align="left" rowspan="1" colspan="1">56148467</td>
<td align="left" rowspan="1" colspan="1">256051</td>
<td align="left" rowspan="1" colspan="1">14.4</td>
<td align="left" rowspan="1" colspan="1">4.0</td>
<td align="left" rowspan="1" colspan="1"/>
<td align="left" rowspan="1" colspan="1">Upstream of <italic>SRD5A3</italic></td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1">3</td>
<td align="left" rowspan="1" colspan="1">chr5</td>
<td align="left" rowspan="1" colspan="1">8022829</td>
<td align="left" rowspan="1" colspan="1">8024476</td>
<td align="left" rowspan="1" colspan="1">249553</td>
<td align="left" rowspan="1" colspan="1">9.3</td>
<td align="left" rowspan="1" colspan="1">2.0</td>
<td align="left" rowspan="1" colspan="1"/>
<td align="left" rowspan="1" colspan="1">Downstream of <italic>MTRR</italic></td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1">4</td>
<td align="left" rowspan="1" colspan="1">chr3</td>
<td align="left" rowspan="1" colspan="1">143684547</td>
<td align="left" rowspan="1" colspan="1">143688535</td>
<td align="left" rowspan="1" colspan="1">235598</td>
<td align="left" rowspan="1" colspan="1">9.8</td>
<td align="left" rowspan="1" colspan="1">2.9</td>
<td align="left" rowspan="1" colspan="1"/>
<td align="left" rowspan="1" colspan="1">Upstream of <italic>C3orf58</italic></td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1">5</td>
<td align="left" rowspan="1" colspan="1">chr9</td>
<td align="left" rowspan="1" colspan="1">99546087</td>
<td align="left" rowspan="1" colspan="1">99550934</td>
<td align="left" rowspan="1" colspan="1">233492</td>
<td align="left" rowspan="1" colspan="1">8.6</td>
<td align="left" rowspan="1" colspan="1">2.6</td>
<td align="left" rowspan="1" colspan="1"/>
<td align="left" rowspan="1" colspan="1">Upstream of <italic>ZNF510</italic></td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1">6</td>
<td align="left" rowspan="1" colspan="1">chr18</td>
<td align="left" rowspan="1" colspan="1">58437379</td>
<td align="left" rowspan="1" colspan="1">58439410</td>
<td align="left" rowspan="1" colspan="1">228782</td>
<td align="left" rowspan="1" colspan="1">8.5</td>
<td align="left" rowspan="1" colspan="1">1.8</td>
<td align="left" rowspan="1" colspan="1"/>
<td align="left" rowspan="1" colspan="1">Distally upstream of <italic>MC4R</italic></td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1">7</td>
<td align="left" rowspan="1" colspan="1">chr8</td>
<td align="left" rowspan="1" colspan="1">134404327</td>
<td align="left" rowspan="1" colspan="1">134405512</td>
<td align="left" rowspan="1" colspan="1">227555</td>
<td align="left" rowspan="1" colspan="1">16.4</td>
<td align="left" rowspan="1" colspan="1">3.7</td>
<td align="left" rowspan="1" colspan="1"/>
<td align="left" rowspan="1" colspan="1">Downstream of <italic>ST3GAL1</italic></td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1">8</td>
<td align="left" rowspan="1" colspan="1">chr21</td>
<td align="left" rowspan="1" colspan="1">22045484</td>
<td align="left" rowspan="1" colspan="1">22048252</td>
<td align="left" rowspan="1" colspan="1">215718</td>
<td align="left" rowspan="1" colspan="1">12.2</td>
<td align="left" rowspan="1" colspan="1">2.5</td>
<td align="left" rowspan="1" colspan="1"/>
<td align="left" rowspan="1" colspan="1">Downstream of <italic>LINC00320</italic></td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1">9</td>
<td align="left" rowspan="1" colspan="1">chr7</td>
<td align="left" rowspan="1" colspan="1">45252745</td>
<td align="left" rowspan="1" colspan="1">45257527</td>
<td align="left" rowspan="1" colspan="1">201522</td>
<td align="left" rowspan="1" colspan="1">13.5</td>
<td align="left" rowspan="1" colspan="1">4.3</td>
<td align="left" rowspan="1" colspan="1"/>
<td align="left" rowspan="1" colspan="1">Downstream of <italic>RAMP3</italic></td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1">10</td>
<td align="left" rowspan="1" colspan="1">chr2</td>
<td align="left" rowspan="1" colspan="1">241121578</td>
<td align="left" rowspan="1" colspan="1">241124345</td>
<td align="left" rowspan="1" colspan="1">200321</td>
<td align="left" rowspan="1" colspan="1">16.1</td>
<td align="left" rowspan="1" colspan="1">3.0</td>
<td align="left" rowspan="1" colspan="1">√</td>
<td align="left" rowspan="1" colspan="1">Upstream of <italic>OTOS</italic></td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1">11</td>
<td align="left" rowspan="1" colspan="1">chr4</td>
<td align="left" rowspan="1" colspan="1">144654907</td>
<td align="left" rowspan="1" colspan="1">144662554</td>
<td align="left" rowspan="1" colspan="1">182348</td>
<td align="left" rowspan="1" colspan="1">11.9</td>
<td align="left" rowspan="1" colspan="1">2.5</td>
<td align="left" rowspan="1" colspan="1"/>
<td align="left" rowspan="1" colspan="1">Upstream of <italic>FREM3</italic></td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1">12</td>
<td align="left" rowspan="1" colspan="1">chr3</td>
<td align="left" rowspan="1" colspan="1">36203964</td>
<td align="left" rowspan="1" colspan="1">36205036</td>
<td align="left" rowspan="1" colspan="1">173655</td>
<td align="left" rowspan="1" colspan="1">15.5</td>
<td align="left" rowspan="1" colspan="1">2.9</td>
<td align="left" rowspan="1" colspan="1"/>
<td align="left" rowspan="1" colspan="1">Upstream of <italic>STAC</italic></td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1">13</td>
<td align="left" rowspan="1" colspan="1">chr2</td>
<td align="left" rowspan="1" colspan="1">101276944</td>
<td align="left" rowspan="1" colspan="1">101278537</td>
<td align="left" rowspan="1" colspan="1">173448</td>
<td align="left" rowspan="1" colspan="1">14.0</td>
<td align="left" rowspan="1" colspan="1">2.9</td>
<td align="left" rowspan="1" colspan="1"/>
<td align="left" rowspan="1" colspan="1">Downstream of <italic>PDCL3</italic></td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1">14</td>
<td align="left" rowspan="1" colspan="1">chr1</td>
<td align="left" rowspan="1" colspan="1">157716093</td>
<td align="left" rowspan="1" colspan="1">157718074</td>
<td align="left" rowspan="1" colspan="1">170583</td>
<td align="left" rowspan="1" colspan="1">10.1</td>
<td align="left" rowspan="1" colspan="1">2.4</td>
<td align="left" rowspan="1" colspan="1"/>
<td align="left" rowspan="1" colspan="1">Exon and introns of <italic>FCRL2</italic></td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1">15</td>
<td align="left" rowspan="1" colspan="1">chr14</td>
<td align="left" rowspan="1" colspan="1">22320920</td>
<td align="left" rowspan="1" colspan="1">22323473</td>
<td align="left" rowspan="1" colspan="1">159251</td>
<td align="left" rowspan="1" colspan="1">13.8</td>
<td align="left" rowspan="1" colspan="1">2.4</td>
<td align="left" rowspan="1" colspan="1"/>
<td align="left" rowspan="1" colspan="1">Intron of <italic>TCRA</italic></td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1">16</td>
<td align="left" rowspan="1" colspan="1">chr14</td>
<td align="left" rowspan="1" colspan="1">88803535</td>
<td align="left" rowspan="1" colspan="1">88805909</td>
<td align="left" rowspan="1" colspan="1">155431</td>
<td align="left" rowspan="1" colspan="1">8.9</td>
<td align="left" rowspan="1" colspan="1">2.2</td>
<td align="left" rowspan="1" colspan="1"/>
<td align="left" rowspan="1" colspan="1">Upstream of <italic>KCNK10</italic></td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1">17</td>
<td align="left" rowspan="1" colspan="1">chr20</td>
<td align="left" rowspan="1" colspan="1">5337103</td>
<td align="left" rowspan="1" colspan="1">5340864</td>
<td align="left" rowspan="1" colspan="1">149816</td>
<td align="left" rowspan="1" colspan="1">11.1</td>
<td align="left" rowspan="1" colspan="1">2.8</td>
<td align="left" rowspan="1" colspan="1"/>
<td align="left" rowspan="1" colspan="1">Upstream of <italic>PROKR2</italic></td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1">18</td>
<td align="left" rowspan="1" colspan="1">chr4</td>
<td align="left" rowspan="1" colspan="1">57919549</td>
<td align="left" rowspan="1" colspan="1">57920587</td>
<td align="left" rowspan="1" colspan="1">146684</td>
<td align="left" rowspan="1" colspan="1">17.5</td>
<td align="left" rowspan="1" colspan="1">4.9</td>
<td align="left" rowspan="1" colspan="1"/>
<td align="left" rowspan="1" colspan="1">Intron of <italic>IGFBP7</italic></td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1">19</td>
<td align="left" rowspan="1" colspan="1">chr14</td>
<td align="left" rowspan="1" colspan="1">86147042</td>
<td align="left" rowspan="1" colspan="1">86149069</td>
<td align="left" rowspan="1" colspan="1">143608</td>
<td align="left" rowspan="1" colspan="1">10.1</td>
<td align="left" rowspan="1" colspan="1">2.1</td>
<td align="left" rowspan="1" colspan="1"/>
<td align="left" rowspan="1" colspan="1">Downstream of <italic>FLRT2</italic></td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1">20</td>
<td align="left" rowspan="1" colspan="1">chr11</td>
<td align="left" rowspan="1" colspan="1">81489342</td>
<td align="left" rowspan="1" colspan="1">81492793</td>
<td align="left" rowspan="1" colspan="1">143222</td>
<td align="left" rowspan="1" colspan="1">10.2</td>
<td align="left" rowspan="1" colspan="1">1.8</td>
<td align="left" rowspan="1" colspan="1"/>
<td align="left" rowspan="1" colspan="1">Downstream of <italic>BC041900</italic></td>
</tr>
</tbody>
</table>
</alternatives><table-wrap-foot><fn id="nt107"><label>a</label><p>Genomic coordinates in hg19 assembly.</p></fn><fn id="nt108"><label>b</label><p>Posterior expected TMRCA in generations, averaged across unfiltered genomic positions in region.</p></fn><fn id="nt109"><label>c</label><p>Number of polymorphisms in Complete Genomics dataset in region per kilobase of unfiltered sequence.</p></fn><fn id="nt110"><label>d</label><p>Normalized polymorphism rate: number of polymorphisms per unfiltered kilobase divided first by the local mutation rate (as estimated from divergence to nonhuman primate outgroup genomes) then by the average of the same polymorphism/divergence ratio in designated neutral regions (see <xref ref-type="sec" rid="s4">Methods</xref>). The resulting value can be interpreted as a fold increase in the mutation-normalized polymorphism rate compared with the expectation under neutrality.</p></fn><fn id="nt111"><label>e</label><p>Possible copy number variant (CNV), based on Complete Genomics “hypervariable” or “invariant” labels (see <xref ref-type="sec" rid="s4">Methods</xref>). Polymorphism rates in these regions may be inflated. Few of these regions were identified in the Leffler et al. data set, probably because the authors were careful to filter out duplicated regions from their analysis <xref ref-type="bibr" rid="pgen.1004342-Leffler1">[77]</xref>.</p></fn></table-wrap-foot></table-wrap>
<p>By contrast, the loci near the bottom of the list (with the shortest TMRCAs) appear to be much less convincing. For example, the bottom 20 have expected ages of only 25,000–50,000 generations (0.65–1.3 My), suggesting that they actually post-date the human/chimpanzee divergence by millions of years. In addition, many of these regions appear hundreds of kilobases from the nearest gene, and they typically do not overlap regions with strong functional or comparative genomic evidence of regulatory potential. Indeed, if our ARG-based estimates of the TMRCA are interpreted literally, a majority of the 125 segregating haplotypes may post-date the human/chimpanzee divergence, which current estimates would place at ≥150,000 generations ago (see Supplementary <xref ref-type="supplementary-material" rid="pgen.1004342.s017">Figure S17</xref>). This observation is in general agreement with rough calculations by Leffler et al. suggesting that the false discovery rate for ancient balancing selection in this set could be as high as 75% <xref ref-type="bibr" rid="pgen.1004342-Leffler1">[77]</xref>. Thus, it appears that our ARG-based methods may be useful in distinguishing true ancestral polymorphisms from shared haplotypes that occur by chance due to homoplasy.</p>
</sec><sec id="s2g4">
<title>Natural selection and allele age</title>
<p>Next we examined the ARG-based expected ages of derived alleles at polymorphic sites in various annotation classes. Classical theory predicts that both deleterious and advantageous alleles will not only have skewed population frequencies but will also tend to be younger than neutral alleles at the same frequency, because directional selection will tend to accelerate a new mutation's path to fixation or loss <xref ref-type="bibr" rid="pgen.1004342-Maruyama1">[78]</xref>. This idea has recently been used to characterize selection in the human genome based on a haplotype-based summary statistic that serves as a proxy for allele age <xref ref-type="bibr" rid="pgen.1004342-Kiezun1">[79]</xref>. We computed ARG-based estimates of allele age in putatively neutral regions (Neut), fourfold degenerate sites in coding regions (4d), conserved noncoding sequences (CNS), missense coding mutations predicted by PolyPhen-2 to be “benign” (PPh:Benign), “possibly damaging” (PPh:PosDam), or “probably damaging” (PPh:ProbDam), and coding or noncoding mutations classified by the ClinVar database (<ext-link ext-link-type="uri" xlink:href="http://www.ncbi.nlm.nih.gov/clinvar" xlink:type="simple">http://www.ncbi.nlm.nih.gov/clinvar</ext-link>) as “nonpathogenic” (categories 1–3; CV:NonPath) or “pathogenic” (categories 4 &amp; 5; CV:Path) based on direct supporting evidence of phenotypic effects. We found, indeed, that the Neut mutations were significantly older, on average, than all other classes (<xref ref-type="fig" rid="pgen-1004342-g006">Figure 6A</xref>). In addition, among the missense coding mutations, PPh:Benign mutations were the oldest, PPh:PosDam were significantly younger, and PPh:ProbDam mutations were the youngest. Similarly, mutations in the CV:NonPath class were significantly older than those in the CV:Path class. Interestingly, the 4d mutations showed substantially lower average ages (by &gt;30%) than the Neut mutations. We attribute this reduction primarily to the effects of selection from linked sites (see <xref ref-type="bibr" rid="pgen.1004342-McVicker1">[60]</xref>), although direct selection from mRNA secondary structure and exonic regulatory elements may also contribute to it.</p>
<fig id="pgen-1004342-g006" position="float"><object-id pub-id-type="doi">10.1371/journal.pgen.1004342.g006</object-id><label>Figure 6</label><caption>
<title>Mean allele age as a function of annotation class and derived allele frequency.</title>
<p>(A) Estimated age of derived allele in generations, averaged across polymorphic sites of various annotation classes. Estimates were derived from ARGs sampled by <italic>ARGweaver</italic> based on the Complete Genomics data set (see <xref ref-type="sec" rid="s4">Methods</xref>). Error bars represent one standard deviation above and below the mean. Neut = putatively neutral sites; 4d = fourfold degenerate sites in coding regions; CNS = conserved noncoding sequences identified by phastCons; PPh:{Benign,PosDam,ProbDam} = missense mutations identified by PolyPhen-2 as “benign”, “possibly damaging”, or “probably damaging”, respectively; CV:{NonPath,Path} = mutations in “nonpathogenic” (categories 1–3) or “pathogenic” (categories 4 &amp; 5) classes in the ClinVar database, respectively. (B) Similar plot with categories further divided by derived allele frequencies (DAF) in numbers of chromosomes out of 108. Error bars represent 95% confidence intervals, as assessed by bootstrapping. In categories that combine multiple frequencies (e.g., 4–5, 6–8), a subsampling strategy was used to ensure that the relative contributions of the different frequencies matched those of the Neut class. Estimates for DAF&gt;20 were excluded due to sparse data. Notice that ages generally increase with DAF, as expected (see Supplementary <xref ref-type="supplementary-material" rid="pgen.1004342.s007">Figure S7</xref>), but at a considerably reduced rate in categories under strong selection.</p>
</caption><graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pgen.1004342.g006" position="float" xlink:type="simple"/></fig>
<p>In part, these differences in age simply reflect differences in the site frequency spectrum (SFS) across classes of mutations. For example, missense mutations are well known to be enriched for low-frequency derived alleles, which will tend to be younger, on average, than higher-frequency derived alleles. To account for the influence of allele frequency, we further grouped the sites in each annotation class by derived allele frequency and compared the average allele ages within each group (<xref ref-type="fig" rid="pgen-1004342-g006">Figure 6B</xref>). As expected, the estimated ages increase with the derived allele frequency across all annotation classes. In addition, within each class we continue to observe approximately the expected rank-order in allele ages, with Neutral mutations being the oldest, 4d, PPh:Benign, CNS, and CV:NonPath mutations coming next, followed by PPh:PosDam, PPh:ProbDam, and CV:Path mutations. This analysis demonstrates that <italic>ARGweaver</italic> is able to obtain information about natural selection from allele ages beyond what can be obtained from the SFS alone.</p>
<p>Another way of viewing these results is to consider the reduction in allele age relative to the neutral expectation within each frequency group, across annotation classes (Supplementary <xref ref-type="supplementary-material" rid="pgen.1004342.s019">Figure S19</xref>). As expected, these reductions are larger at higher allele frequencies, where sojourn times will tend to be longer. However, from this representation it is also clear that the reductions in age increase with frequency much more rapidly for the mutations under strong, direct selection than for the mutations at which selection from linked sites is expected to dominate. For example, at very low derived allele frequencies (singletons), the reduction in age of 4d mutations is roughly equal to that at PPh:PosDam mutations, whereas at higher derived allele frequencies the damaging mutations exhibit reductions in age 2–3 times larger. The reason for this observation is probably that the reduction in age for the nearly neutral sites is largely a consequence of reductions in the local effective population size due to selection at linked sites, while the reductions at sites under direct selection are driven by the influence of selection on sojourn times (see Supplementary <xref ref-type="supplementary-material" rid="pgen.1004342.s019">Figure S19</xref> for a detailed discussion). Consistent with this interpretation, CNS mutations show less reduction in age than 4d and PPh:Benign mutations at low frequencies, and more reduction at high frequencies, suggesting that CNS mutations are influenced less by selection at linked sites and more by direct selection.</p>
</sec></sec></sec><sec id="s3">
<title>Discussion</title>
<p>Several decades have passed since investigators first worked out the general statistical characteristics of population samples of genetic markers in the presence of recombination <xref ref-type="bibr" rid="pgen.1004342-Hudson2">[21]</xref>, <xref ref-type="bibr" rid="pgen.1004342-Hill1">[80]</xref>–<xref ref-type="bibr" rid="pgen.1004342-Griffiths3">[83]</xref>. Nevertheless, solutions to the problem of explicitly characterizing this structure in the general case of multiple markers and multiple sequences—that is, of making direct inferences about the ancestral recombination graph (ARG) <xref ref-type="bibr" rid="pgen.1004342-Griffiths1">[19]</xref>, <xref ref-type="bibr" rid="pgen.1004342-Griffiths2">[20]</xref>—have been elusive. Recent investigations have led to important progress on this problem based on the Sequentially Markov Coalescent (SMC) <xref ref-type="bibr" rid="pgen.1004342-Harris1">[17]</xref>, <xref ref-type="bibr" rid="pgen.1004342-McVean1">[37]</xref>–<xref ref-type="bibr" rid="pgen.1004342-Li1">[42]</xref>, but existing methods are still either restricted to small numbers of sequences or require severe approximations. In this paper, we introduce a method that is faithful to the SMC yet has much better scaling properties than previous methods. These properties depend on a novel “threading” operation that can be performed in a highly efficient manner using hidden Markov modeling techniques. Inference does require the use of Markov chain Monte Carlo (MCMC) sampling, which has certain costs, but we have shown that the sampler mixes fairly well and converges rapidly, particularly if the threading operation is generalized from single sequences to subtrees. Our methods allow explicit statistical inference of ARGs on the scale of complete mammalian genomes for the first time. Furthermore, the sampling of ARGs from their posterior distribution has the important advantage of allowing estimation of any ARG-derived quantity, such as times to most recent common ancestry, allele ages, or regions of identity by descent.</p>
<p>Despite our different starting point, our methods are similar in several respects to the conditional sampling distribution (CSD)-based methods of Song and colleagues <xref ref-type="bibr" rid="pgen.1004342-Paul1">[49]</xref>–<xref ref-type="bibr" rid="pgen.1004342-Steinrucken1">[52]</xref>. Both approaches consider a conditional distribution for the <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e336" xlink:type="simple"/></inline-formula>th sequence given the previous <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e337" xlink:type="simple"/></inline-formula> sequences, and in both cases a discretized SMC is exploited for efficiency of inference. However, the CSD-based methods consider the marginal distribution of the <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e338" xlink:type="simple"/></inline-formula>th sequence only given the other <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e339" xlink:type="simple"/></inline-formula> sequences and never explicitly reconstruct an ARG, while ours considers the joint distribution of an ARG of size <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e340" xlink:type="simple"/></inline-formula> and the <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e341" xlink:type="simple"/></inline-formula>th sequence, given an ARG of size <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e342" xlink:type="simple"/></inline-formula> and the previous <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e343" xlink:type="simple"/></inline-formula> sequences. In a sense, we have employed a “data augmentation” strategy by explicitly representing full ARGs in our inference procedure. The main cost of this strategy is that it requires Markov chain Monte Carlo methods for inference, rather than allowing direct likelihood calculations and maximum-likelihood parameter estimation. The main benefit is that it provides an approximate posterior distribution over complete ARGs and many derived quantities, including times to most recent common ancestry, allele ages, and distributions of coalescence times. By contrast, the CSD-based methods provide information about only those properties of the ARG that are directly described by the model parameters. We view these two approaches as complementary and expect that they will have somewhat different strengths and weaknesses, depending on the application in question.</p>
<p>Our explicit characterization of genealogies can be exploited to characterize the influence of natural selection across the genome, as shown in our analysis of the Complete Genomics data set. In particular, we see clear evidence of an enrichment for ancient TMRCAs in regions of known and predicted balancing selection, reduced TMRCAs near protein-coding genes and selective sweeps, and reduced allele ages in sites experiencing both direct selection and selection at closely linked sites. Interestingly, the genealogical view appears to have the potential to shed light on the difficult problem of distinguishing between background selection and hitchhiking. Our initial attempt at addressing this problem relies on a genealogy-based summary statistics, the relative TMRCA halflife (RTH), that does appear to distinguish effectively between protein-coding genes and partial selective sweeps identified by iHS. However, more work will be needed to determine how well this approach generalizes to other types of hitchhiking (e.g., complete sweeps, soft sweeps, recurrent sweeps) and whether additional genealogical information can be used to characterize the mode of selection more precisely. Additional work is also needed to determine whether our ARG-based allele-age estimator—which is highly informative in bulk statistical comparisons but has high variance at individual sites—can be used to improve functional and evolutionary characterizations of particular genomic loci. A related challenge is to see whether our genome-wide ARG samples can be used to improve methods for association/LD mapping (see <xref ref-type="bibr" rid="pgen.1004342-Minichiello1">[34]</xref>, <xref ref-type="bibr" rid="pgen.1004342-Rannala1">[84]</xref>–<xref ref-type="bibr" rid="pgen.1004342-Besenbacher1">[88]</xref>).</p>
<p>In addition to natural selection, our methods for ARG inference have the potential to shed light on historical demographic processes, an area of particular interest in the recent literature <xref ref-type="bibr" rid="pgen.1004342-Ralph1">[16]</xref>, <xref ref-type="bibr" rid="pgen.1004342-Harris1">[17]</xref>, <xref ref-type="bibr" rid="pgen.1004342-Sheehan1">[51]</xref>, <xref ref-type="bibr" rid="pgen.1004342-Steinrucken1">[52]</xref>, <xref ref-type="bibr" rid="pgen.1004342-PradoMartinez1">[89]</xref>. To explore the usefulness of <italic>ARGweaver</italic> in demography inference, we attempted to infer a population phylogeny with admixture edges for the 11 human populations represented in the Complete Genomics data set, based on the genealogies sampled under our naive (panmictic) prior distribution. We extracted 2,304 widely spaced loci from our inferred ARGs, obtained a consensus tree at each locus, and reduced this tree to a subtree with one randomly selected chromosome for each of the 11 populations (see <xref ref-type="supplementary-material" rid="pgen.1004342.s022">Text S1</xref> for details). We then analyzed these 11-leaf trees with the PhyloNet program <xref ref-type="bibr" rid="pgen.1004342-Than1">[90]</xref>, <xref ref-type="bibr" rid="pgen.1004342-Yu1">[91]</xref>, which finds a population tree that minimizes the number of “deep coalescences” required for reconciliation with a given set of local trees, allowing for both incomplete lineage sorting and hybridization (admixture) events between groups. PhyloNet recovered the expected phylogeny for these populations in the absence of hybridization and generally detected complex patterns of gene flow where they are believed to have occurred, but it had difficulty reconstructing the precise relatinonships among source and admixed populations (Supplementary <xref ref-type="supplementary-material" rid="pgen.1004342.s020">Figure S20</xref>). These experiments suggested that the posterior distribution of ARGs does appear to contain useful information about population structure even when a noninformative prior distribution is used, but that additional work will be needed to fully exploit the use of ARG inference in demographic analysis.</p>
<p>An alternative strategy would be to extend our methods to incorporate a full phylogenetic demographic model, such as the one used by G-PhoCS <xref ref-type="bibr" rid="pgen.1004342-Gronau1">[92]</xref>, thereby generalizing this fully Bayesian method to a setting in which recombination is allowed and complete genome sequences are considered. Importantly, the use of the complete ARG would allow information about demographic history from both patterns of mutation and patterns of linkage disequilibrium to be naturally integrated (see <xref ref-type="bibr" rid="pgen.1004342-Gronau1">[92]</xref>). However, as with CSD-based methods <xref ref-type="bibr" rid="pgen.1004342-Sheehan1">[51]</xref>, <xref ref-type="bibr" rid="pgen.1004342-Steinrucken1">[52]</xref>, an extension to a full, parametric multi-population model for application on a genome-wide scale would be technically challenging. In our case, it would require the ability to sample “threadings” consistent with the constraints of a population model (e.g., with no coalescent events between genetically isolated populations) and exploration of a full collection of population parameters, which would likely lead to slow convergence and long running times. Nevertheless, a version of this joint inference strategy may be feasible with appropriate heuristics and approximations. Our methods may also be useful for a wide variety of related applications, including local ancestry inference <xref ref-type="bibr" rid="pgen.1004342-Price1">[47]</xref>, <xref ref-type="bibr" rid="pgen.1004342-Tang1">[93]</xref>, <xref ref-type="bibr" rid="pgen.1004342-Sankararaman1">[94]</xref>, haplotype phasing/genotype imputation <xref ref-type="bibr" rid="pgen.1004342-Howie1">[46]</xref>, <xref ref-type="bibr" rid="pgen.1004342-Li3">[48]</xref>, <xref ref-type="bibr" rid="pgen.1004342-Scheet1">[95]</xref>, <xref ref-type="bibr" rid="pgen.1004342-Browning1">[96]</xref>, and recombination rate estimation <xref ref-type="bibr" rid="pgen.1004342-Fearnhead1">[22]</xref>, <xref ref-type="bibr" rid="pgen.1004342-McVean2">[97]</xref>.</p>
<p>Our initial implementation of <italic>ARGweaver</italic> relies on several simplying assumptions that appear to have minimal impact on performance with (real or simulated) human sequence data, but may produce limitations in other settings. Following Li and Durbin <xref ref-type="bibr" rid="pgen.1004342-Li1">[42]</xref>, we compute probabilities of recombination between discrete genomic positions under the assumptions of the continuous-space SMC <xref ref-type="bibr" rid="pgen.1004342-McVean1">[37]</xref>. When recombination rates are low, the discrete and continuous models are nearly identical, but the differences between them can become significant when recombination rates are higher <xref ref-type="bibr" rid="pgen.1004342-Hobolth2">[98]</xref>. Similarly, our assumption of at most one recombination event per site and our use of the SMC rather than the improved <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e344" xlink:type="simple"/></inline-formula> <xref ref-type="bibr" rid="pgen.1004342-Marjoram1">[38]</xref> may lead to biases in cases of higher recombination rates, larger numbers of sequences, or more divergent sequences. In addition, our heuristic approach of accommodating zero-length branches by randomly sampling among “active” branches for coalescence and recombination events (see <xref ref-type="sec" rid="s4">Methods</xref>) may lead to biases when the discretization scheme is coarse relative to evolutionary events of interest. Finally, we currently assume haploid genome sequences as input, which, in most cases of current interest, requires computational phasing as a pre-processing step. Phasing errors may lead to over-estimation of recombination and mutation rates and associated biases, because the sampler will tend to compensate for them with additional recombination and/or mutation events. In principle, most of these limitations can be addressed within our framework. For example, it should be fairly straightforward to extend <italic>ARGweaver</italic> to use the SMC' and Hobolth and Jensen's finite-loci transition density. In addition, we believe it is possible to enable the program to work directly with unphased data and integrate over all possible phasings (see, e.g., <xref ref-type="bibr" rid="pgen.1004342-Gronau1">[92]</xref>, <xref ref-type="bibr" rid="pgen.1004342-Wu3">[99]</xref>).</p>
<p>The ability to perform explicit ARG inference on the scale of complete genomes opens up a wide range of possible applications, but the long running times required for these analyses and the unwieldy data structures they produce (numerous samples of ARGs) are potential barriers to practical usefulness. In our initial work, we have attempted to address this problem by precomputing ARGs for a highly informative public data set and releasing both our complete ARGs and various summary statistics as browser tracks for use by other groups. We have also developed a simple web interface that allows users to retrieve local trees and several useful summary statistics for specified genomic intervals, populations, and individuals (<ext-link ext-link-type="uri" xlink:href="http://compgen.bscb.cornell.edu/ARGweaver/CG_results" xlink:type="simple">http://compgen.bscb.cornell.edu/ARGweaver/CG_results</ext-link>). In future work, it may be possible to improve data access by providing more sophisticated tools for data retrieval and visualization. For example, sampled ARGs could be stored in a database in a manner that allowed researchers to efficiently extract features such as regions of IBD or recombination maps for designated subsets of samples. A related possibility would be to support on-the-fly threading of user-specified query sequences into precomputed ARGs. This operation would be analogous to local ancestry inference <xref ref-type="bibr" rid="pgen.1004342-Price1">[47]</xref>, <xref ref-type="bibr" rid="pgen.1004342-Tang1">[93]</xref>, <xref ref-type="bibr" rid="pgen.1004342-Sankararaman1">[94]</xref>, but would reveal not only the population sources of query sequence segments, but also additional information about recombination events, coalescence times, approximate mutation ages, and other features. The same operation could be used to allow our sampling methods to scale to thousands of genomes: one could infer ARGs for, say, 100 genomes, then simply thread in hundreds more, without full MCMC sampling. In general, we believe that posterior samples of ARGs will be a rich resource for genetic analysis, but additional work is needed on data storage and query interfaces for these samples to become practically useful to large numbers of genomic researchers.</p>
</sec><sec id="s4" sec-type="methods">
<title>Methods</title>
<sec id="s4a">
<title>Discretized Sequentially Markov Coalescent</title>
<sec id="s4a1">
<title>Discretization scheme and notation</title>
<p>The Discretized Sequentially Markov Coalescent (DSMC) assumes that all coalescence and recombination events occur at <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e345" xlink:type="simple"/></inline-formula> discrete time points, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e346" xlink:type="simple"/></inline-formula>, with <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e347" xlink:type="simple"/></inline-formula> (the present time) and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e348" xlink:type="simple"/></inline-formula> equal to a user-specified maximum value. These time points are defined in units of generations before the present time. We evenly distribute these time points on a logarithmic scale, so that the discretization scheme has finer resolution near the leaves of the ARG, where more events are expected to occur. Specifically, we define <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e349" xlink:type="simple"/></inline-formula> (for <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e350" xlink:type="simple"/></inline-formula>) to be <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e351" xlink:type="simple"/></inline-formula>, where<disp-formula id="pgen.1004342.e352"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pgen.1004342.e352" xlink:type="simple"/><label>(4)</label></disp-formula>Here, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e353" xlink:type="simple"/></inline-formula> is the maximum time and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e354" xlink:type="simple"/></inline-formula> is a tuning parameter that, when increased, causes the time points to become more densely clustered near the leaves of the ARG. Notice that <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e355" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e356" xlink:type="simple"/></inline-formula>. In this work, we have assumed <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e357" xlink:type="simple"/></inline-formula> generations and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e358" xlink:type="simple"/></inline-formula>. We denote the length of time interval <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e359" xlink:type="simple"/></inline-formula> as <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e360" xlink:type="simple"/></inline-formula>. The DSMC process is defined such that it approaches the continuous SMC as a limit as <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e361" xlink:type="simple"/></inline-formula> and each <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e362" xlink:type="simple"/></inline-formula>, with <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e363" xlink:type="simple"/></inline-formula> sufficiently large that the probability of a coalescence event older than <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e364" xlink:type="simple"/></inline-formula> is close to zero.</p>
<p>It is useful to specify “midpoints” between time points (on a log scale), to facilitate rounding of continuous-valued times to the nearest discrete time point. We define the midpoint between times <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e365" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e366" xlink:type="simple"/></inline-formula> (for <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e367" xlink:type="simple"/></inline-formula>) as <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e368" xlink:type="simple"/></inline-formula>. We can alternatively refer to the midpoint between times <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e369" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e370" xlink:type="simple"/></inline-formula> as <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e371" xlink:type="simple"/></inline-formula> (for <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e372" xlink:type="simple"/></inline-formula>), noting that <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e373" xlink:type="simple"/></inline-formula>. Coalescence events that occur between <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e374" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e375" xlink:type="simple"/></inline-formula> are “rounded” to time point <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e376" xlink:type="simple"/></inline-formula>. We found that it was less critical to round recombination events to the nearest time point, so they are simply rounded to the next most recent time point (see below). We denote the lengths of the half intervals between <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e377" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e378" xlink:type="simple"/></inline-formula>, and between <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e379" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e380" xlink:type="simple"/></inline-formula>, as <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e381" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e382" xlink:type="simple"/></inline-formula>, respectively.</p>
<p>Because all coalescence events must occur at the designated time points, the collection of branches is fixed for each interval <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e383" xlink:type="simple"/></inline-formula> between time points <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e384" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e385" xlink:type="simple"/></inline-formula>. Given a local tree <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e386" xlink:type="simple"/></inline-formula> that is consistent with the DSMC, we denote the set of branches in time interval <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e387" xlink:type="simple"/></inline-formula> as <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e388" xlink:type="simple"/></inline-formula>. The size of this set, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e389" xlink:type="simple"/></inline-formula>, is of particular interest, and is abbreviated <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e390" xlink:type="simple"/></inline-formula> (with <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e391" xlink:type="simple"/></inline-formula> clear from context). In addition, it is often of interest to consider the branch sets for a tree <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e392" xlink:type="simple"/></inline-formula> from which a branch <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e393" xlink:type="simple"/></inline-formula> has been removed. We denote such a tree by <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e394" xlink:type="simple"/></inline-formula> and abbreviate the number of branches in interval <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e395" xlink:type="simple"/></inline-formula> as <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e396" xlink:type="simple"/></inline-formula> (again, with <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e397" xlink:type="simple"/></inline-formula> clear from context).</p>
<p>One consequence of discretizing time is that the DSMC will tend to generate ARGs that contain many branches of length zero (corresponding to polytomies in the local trees), which will have zero probability of recombination, coalesce, or mutation events. In effect, the rounding procedure will tend to shrink short branches to zero, which may lead to distortions in data generation and inference. We address this problem heuristically, by defining the DSMC to first sample the times of recombination and coalescence events, and then randomly select a branch from all of those “active” at the sampled time point. We define the set of active branches at a time point <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e398" xlink:type="simple"/></inline-formula>, for a local tree <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e399" xlink:type="simple"/></inline-formula>, to be those branches in <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e400" xlink:type="simple"/></inline-formula> that start, end, or pass through <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e401" xlink:type="simple"/></inline-formula>. This set is denoted <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e402" xlink:type="simple"/></inline-formula> and its size is abbreviated as <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e403" xlink:type="simple"/></inline-formula>. As above, we use <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e404" xlink:type="simple"/></inline-formula> to indicate the active branches at <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e405" xlink:type="simple"/></inline-formula> excluding branch <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e406" xlink:type="simple"/></inline-formula>. Simulations indicate that this heuristic solution to the problem of zero-length branches works fairly well in practice (see <xref ref-type="supplementary-material" rid="pgen.1004342.s001">Figure S1</xref>).</p>
</sec><sec id="s4a2">
<title>Recombination process</title>
<p>As in the standard SMC, recombinations are assumed to occur according to a Poisson process with rate <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e407" xlink:type="simple"/></inline-formula>, where <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e408" xlink:type="simple"/></inline-formula> is the total branch length of local tree <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e409" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e410" xlink:type="simple"/></inline-formula> is the average number of recombinations/generation/site. Once a recombination occurs, the ordinary SMC process places the recombination uniformly along the branches of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e411" xlink:type="simple"/></inline-formula>. The analogous operation of sampling a recombination branch and time point, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e412" xlink:type="simple"/></inline-formula>, in the DSMC is accomplished by first sampling a time point <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e413" xlink:type="simple"/></inline-formula> in proportion to the total branch length present during time interval <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e414" xlink:type="simple"/></inline-formula>, then randomly selecting one of the <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e415" xlink:type="simple"/></inline-formula> branches active at that time point. Consistent with the assumptions of the SMC, the recombination point cannot occur above the time point associated with the root <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e416" xlink:type="simple"/></inline-formula> of tree <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e417" xlink:type="simple"/></inline-formula>, which we denote <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e418" xlink:type="simple"/></inline-formula>. Thus, the sampling distribution for a recombination point <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e419" xlink:type="simple"/></inline-formula> on a local tree <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e420" xlink:type="simple"/></inline-formula> is given by,<disp-formula id="pgen.1004342.e421"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pgen.1004342.e421" xlink:type="simple"/><label>(5)</label></disp-formula>where <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e422" xlink:type="simple"/></inline-formula> is a constant that explicitly normalizes the distribution over time points <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e423" xlink:type="simple"/></inline-formula>. The special case for the time point at the root of the tree, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e424" xlink:type="simple"/></inline-formula>, is required because the SMC does not allow recombinations to occur beyond this point, so the effective number of active branches is only two at this time point, despite that <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e425" xlink:type="simple"/></inline-formula> will have a value of three. The number of branches in the interval above the root, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e426" xlink:type="simple"/></inline-formula>, is necessarily one, so this term can be omitted in this case.</p>
<p>This sampling distribution effectively rounds the times of recombination events downward to the next most recent time point. However, a strict policy of downward rounding, together with a prohibition again recombination events above the root node, would make it impossible to sample recombination events at time point <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e427" xlink:type="simple"/></inline-formula>, which turns out to have undesirable effects in inference (it makes some trees unreachable by the threading operation). Therefore, when sampling time points, we use the heuristic approach of imagining that recombinations can also occur in the time interval immediately above the root and assigning these events to the time point <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e428" xlink:type="simple"/></inline-formula>. This has the effect of redistributing some of the probability mass from later time points to the root, without altering the overall rate at which recombinations occur (<inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e429" xlink:type="simple"/></inline-formula>). For this reason, the normalizing constant <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e430" xlink:type="simple"/></inline-formula> differs slightly from the total branch length <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e431" xlink:type="simple"/></inline-formula>; in particular, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e432" xlink:type="simple"/></inline-formula>. It would be slightly more elegant to allow upward as well as downward rounding of times for recombinations, as we do with coalescence events (see below), but as long as the time discretization is not too coarse these differences are of minor importance, and the approach we have used seems to be adequate.</p>
</sec><sec id="s4a3">
<title>Re-coalescence process</title>
<p>Once a recombination point <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e433" xlink:type="simple"/></inline-formula> is sampled, the selected branch <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e434" xlink:type="simple"/></inline-formula> is removed from time points <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e435" xlink:type="simple"/></inline-formula> and older, and allowed to re-coalesce to the remainder of the tree, in a manner analogous to the SMC. Because we explicitly prohibit multiple recombinations between adjacent positions, the local tree <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e436" xlink:type="simple"/></inline-formula> must be reachable from <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e437" xlink:type="simple"/></inline-formula> by a single “subtree pruning and regrafting” (SPR) operation corresponding to the recombination, i.e., an operation that cuts a branch of the tree at the recombination point and re-attaches it (and any descendant nodes) to the remainder of the tree. Thus, we can write,<disp-formula id="pgen.1004342.e438"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pgen.1004342.e438" xlink:type="simple"/><label>(6)</label></disp-formula>where <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e439" xlink:type="simple"/></inline-formula> is a function that returns the new tree produced by an SPR operation on <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e440" xlink:type="simple"/></inline-formula> that cuts branch <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e441" xlink:type="simple"/></inline-formula> at time <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e442" xlink:type="simple"/></inline-formula> and re-attaches it to branch <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e443" xlink:type="simple"/></inline-formula> at time <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e444" xlink:type="simple"/></inline-formula>, and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e445" xlink:type="simple"/></inline-formula> is a joint conditional distribution over re-coalescence branches and time points.</p>
<p>The main challenge is therefore to define the discrete re-coalescence distribution, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e446" xlink:type="simple"/></inline-formula>, for <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e447" xlink:type="simple"/></inline-formula> (as required by the SMC). There are two distinct cases to consider: <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e448" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e449" xlink:type="simple"/></inline-formula>. When <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e450" xlink:type="simple"/></inline-formula>, the unattached branch <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e451" xlink:type="simple"/></inline-formula> must first fail to re-coalesce during the interval between <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e452" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e453" xlink:type="simple"/></inline-formula>, and then must re-coalesce between <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e454" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e455" xlink:type="simple"/></inline-formula> (because all such re-coalescence events will be rounded to <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e456" xlink:type="simple"/></inline-formula>). By contrast, when <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e457" xlink:type="simple"/></inline-formula>, the branch <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e458" xlink:type="simple"/></inline-formula> must simply re-coalesce between <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e459" xlink:type="simple"/></inline-formula> (<inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e460" xlink:type="simple"/></inline-formula>) and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e461" xlink:type="simple"/></inline-formula> (because the re-coalescence time is strictly bounded by the recombination time).</p>
<p>In all cases, the instantaneous rate of re-coalescence in each interval <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e462" xlink:type="simple"/></inline-formula> (<inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e463" xlink:type="simple"/></inline-formula>) is given by <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e464" xlink:type="simple"/></inline-formula>, in the standard manner for the coalescent. (Note that we use <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e465" xlink:type="simple"/></inline-formula> rather than <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e466" xlink:type="simple"/></inline-formula>, because we are concerned with the coalescence rate to the remainder of the tree, excluding branch <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e467" xlink:type="simple"/></inline-formula>. We also assume a diploid species throughout, so the total number of chromosomes per locus is <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e468" xlink:type="simple"/></inline-formula>.) The probability that a lineage starting at a time <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e469" xlink:type="simple"/></inline-formula> coalesces before <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e470" xlink:type="simple"/></inline-formula> is given by the cumulative distribution function for exponentially distributed waiting times,<disp-formula id="pgen.1004342.e471"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pgen.1004342.e471" xlink:type="simple"/><label>(7)</label></disp-formula>and the probability of coalescence during a sequences of intervals, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e472" xlink:type="simple"/></inline-formula> is given by,<disp-formula id="pgen.1004342.e473"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pgen.1004342.e473" xlink:type="simple"/><label>(8)</label></disp-formula>Similarly, the probabilities of coalescence during the half intervals before and after time point <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e474" xlink:type="simple"/></inline-formula> are given, respectively, by,<disp-formula id="pgen.1004342.e475"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pgen.1004342.e475" xlink:type="simple"/><label>(9)</label></disp-formula>Thus, the distribution of re-coalescence times for the case of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e476" xlink:type="simple"/></inline-formula> is given by,<disp-formula id="pgen.1004342.e477"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pgen.1004342.e477" xlink:type="simple"/><label>(10)</label></disp-formula>The probability of re-coalescence for the case of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e478" xlink:type="simple"/></inline-formula> is simply,<disp-formula id="pgen.1004342.e479"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pgen.1004342.e479" xlink:type="simple"/><label>(11)</label></disp-formula>Finally, the requirement for re-coalescence by the maximum time, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e480" xlink:type="simple"/></inline-formula>, is enforced by explicitly normalizing the distribution:<disp-formula id="pgen.1004342.e481"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pgen.1004342.e481" xlink:type="simple"/><label>(12)</label></disp-formula></p>
<p>Once the coalescence time point <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e482" xlink:type="simple"/></inline-formula> is chosen, a lineage <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e483" xlink:type="simple"/></inline-formula> is uniformly chosen from the <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e484" xlink:type="simple"/></inline-formula> active lineages in <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e485" xlink:type="simple"/></inline-formula> at that time point, similar to the process for recombination events. Thus, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e486" xlink:type="simple"/></inline-formula>, and <xref ref-type="disp-formula" rid="pgen.1004342.e438">equation 6</xref> can be rewritten as,<disp-formula id="pgen.1004342.e487"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pgen.1004342.e487" xlink:type="simple"/><label>(13)</label></disp-formula>where <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e488" xlink:type="simple"/></inline-formula> is given by <xref ref-type="disp-formula" rid="pgen.1004342.e477">equations 10</xref>–<xref ref-type="disp-formula" rid="pgen.1004342.e481">12</xref>.</p>
</sec><sec id="s4a4">
<title>Initial local tree</title>
<p>The DSMC begins by generating an initial local tree, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e489" xlink:type="simple"/></inline-formula>, using a discretized version of the coalescent process. This process can be decomposed into two steps: (1) the generation of a sequence of branch counts, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e490" xlink:type="simple"/></inline-formula> for time points <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e491" xlink:type="simple"/></inline-formula>, and (2) sampling of a topology <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e492" xlink:type="simple"/></inline-formula> consistent with these branch counts. The probability of an observed initial tree <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e493" xlink:type="simple"/></inline-formula> can therefore be calculated as,<disp-formula id="pgen.1004342.e494"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pgen.1004342.e494" xlink:type="simple"/><label>(14)</label></disp-formula>where <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e495" xlink:type="simple"/></inline-formula> is a vector of effective population sizes, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e496" xlink:type="simple"/></inline-formula>. The branch count for time 0 is constrained to be equal to the number of samples, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e497" xlink:type="simple"/></inline-formula>, and the branch count for time <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e498" xlink:type="simple"/></inline-formula> is required to be one, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e499" xlink:type="simple"/></inline-formula> (see below).</p>
<p>Since the coalescent process is Markovian in time, the distribution for the vector of branch counts can be factored by time intervals,<disp-formula id="pgen.1004342.e500"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pgen.1004342.e500" xlink:type="simple"/><label>(15)</label></disp-formula>with degenerate first and last terms, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e501" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e502" xlink:type="simple"/></inline-formula>.</p>
<p>The conditional distributions of the form <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e503" xlink:type="simple"/></inline-formula>, for <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e504" xlink:type="simple"/></inline-formula>, have been derived previously as <xref ref-type="bibr" rid="pgen.1004342-Tavare1">[100]</xref>,<disp-formula id="pgen.1004342.e505"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pgen.1004342.e505" xlink:type="simple"/><label>(16)</label></disp-formula></p>
</sec></sec><sec id="s4b">
<title>Hidden Markov Model</title>
<sec id="s4b1">
<title>Hidden Markov model for full threading problem</title>
<p>As noted in the <xref ref-type="sec" rid="s2">Results</xref> section, the complete data likelihood function under the DSMC is given by <xref ref-type="disp-formula" rid="pgen.1004342.e196">equation 2</xref>. If the full ARG <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e506" xlink:type="simple"/></inline-formula> is regarded as a latent variable, this equation defines a hidden Markov model with a state space given by all possible pairs <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e507" xlink:type="simple"/></inline-formula>, transition probabilities given by expressions of the form <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e508" xlink:type="simple"/></inline-formula> <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e509" xlink:type="simple"/></inline-formula> and emission probabilities given by <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e510" xlink:type="simple"/></inline-formula> (see <xref ref-type="fig" rid="pgen-1004342-g003">Figure 3A</xref>). The transition probabilities can be computed using <xref ref-type="disp-formula" rid="pgen.1004342.e421">equations 5</xref> and <xref ref-type="disp-formula" rid="pgen.1004342.e487">13</xref>, and the emission probabilities can be computed using Felsenstein's pruning algorithm. This model can be viewed as an instance of the “phylo-HMMs” that have been widely used in comparative genomics <xref ref-type="bibr" rid="pgen.1004342-Siepel1">[101]</xref>. As discussed in the <xref ref-type="sec" rid="s2">Results</xref> section, however, unless the number of sequences <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e511" xlink:type="simple"/></inline-formula> is very small, the state space of this HMM will be too large to allow it to be used directly for inference.</p>
<p>Instead, we constrain the inference problem by fixing the ARG for the first <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e512" xlink:type="simple"/></inline-formula> sequences, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e513" xlink:type="simple"/></inline-formula>, and sampling from the conditional distribution <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e514" xlink:type="simple"/></inline-formula>. Using the notation <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e515" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e516" xlink:type="simple"/></inline-formula>, we define <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e517" xlink:type="simple"/></inline-formula>, where <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e518" xlink:type="simple"/></inline-formula> is a vector of coalescence points such that <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e519" xlink:type="simple"/></inline-formula> indicates a coalescence of the <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e520" xlink:type="simple"/></inline-formula>th sequence to branch <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e521" xlink:type="simple"/></inline-formula> and time point <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e522" xlink:type="simple"/></inline-formula> of local tree <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e523" xlink:type="simple"/></inline-formula>, and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e524" xlink:type="simple"/></inline-formula>, where <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e525" xlink:type="simple"/></inline-formula> is a vector of recombination points such that <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e526" xlink:type="simple"/></inline-formula> indicates a recombination at branch <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e527" xlink:type="simple"/></inline-formula> and time point <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e528" xlink:type="simple"/></inline-formula> of local tree <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e529" xlink:type="simple"/></inline-formula> between positions <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e530" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e531" xlink:type="simple"/></inline-formula>. (Note that <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e532" xlink:type="simple"/></inline-formula> is undefined.) Thus, we can sample from the desired conditional distribution <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e533" xlink:type="simple"/></inline-formula> by sampling from <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e534" xlink:type="simple"/></inline-formula>. We refer to a sample <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e535" xlink:type="simple"/></inline-formula> from this distribution as a <italic>threading</italic> of the <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e536" xlink:type="simple"/></inline-formula>th sequence through the ARG (see <xref ref-type="fig" rid="pgen-1004342-g003">Figure 3B</xref>). For now, we will consider a complete threading <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e537" xlink:type="simple"/></inline-formula>, but in later sections we will describe our two-step process for sampling, first, the coalescent threading <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e538" xlink:type="simple"/></inline-formula>, and second, the recombination threading <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e539" xlink:type="simple"/></inline-formula> given <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e540" xlink:type="simple"/></inline-formula>.</p>
<p>Note that the restriction to one recombination event per position implies that <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e541" xlink:type="simple"/></inline-formula> wherever <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e542" xlink:type="simple"/></inline-formula>, and that <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e543" xlink:type="simple"/></inline-formula> wherever <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e544" xlink:type="simple"/></inline-formula>. This restriction is not strictly required but it simplifies the description of new recombination events <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e545" xlink:type="simple"/></inline-formula>, and in the setting of interest here it comes with little cost (see <xref ref-type="sec" rid="s3">Discussion</xref>).</p>
<p>It turns out to be more convenient to work with the joint distribution <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e546" xlink:type="simple"/></inline-formula> (the complete data likelihood) than with the conditional distribution <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e547" xlink:type="simple"/></inline-formula>. However, to emphasize that the variables <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e548" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e549" xlink:type="simple"/></inline-formula> are held fixed (“clamped”) at pre-specified values throughout the threading operation, we denote them as <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e550" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e551" xlink:type="simple"/></inline-formula>, and refer to the distribution of interest as <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e552" xlink:type="simple"/></inline-formula>. (Notice that the data <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e553" xlink:type="simple"/></inline-formula> are also clamped, as usual for HMMs.) When <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e554" xlink:type="simple"/></inline-formula>, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e555" xlink:type="simple"/></inline-formula>, and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e556" xlink:type="simple"/></inline-formula> are clamped,<disp-formula id="pgen.1004342.e557"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pgen.1004342.e557" xlink:type="simple"/><label>(17)</label></disp-formula>Thus, samples of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e558" xlink:type="simple"/></inline-formula> drawn in proportion to the unnormalized density <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e559" xlink:type="simple"/></inline-formula> will be valid samples from the desired conditional distribution. In general, any clamped joint density function, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e560" xlink:type="simple"/></inline-formula>, can be viewed as an unnormalized version of a corresponding conditional density function, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e561" xlink:type="simple"/></inline-formula>, but sometimes the joint density is more convenient to manipulate.</p>
<p>We can now write the density function for the (unnormalized) sampling distribution for a threading <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e562" xlink:type="simple"/></inline-formula> as,<disp-formula id="pgen.1004342.e563"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pgen.1004342.e563" xlink:type="simple"/><label>(18)</label></disp-formula>where all terms are computable using previously described expressions, as for <xref ref-type="disp-formula" rid="pgen.1004342.e196">equation 2</xref>.</p>
<p>Notice that this threading HMM has the same conditional independence structure as the HMM for the full DSMC (<xref ref-type="disp-formula" rid="pgen.1004342.e196">equation 2</xref>, <xref ref-type="fig" rid="pgen-1004342-g003">Figure 3</xref>), but its state space is now defined by sets of possible <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e564" xlink:type="simple"/></inline-formula> pairs rather than the set of possible <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e565" xlink:type="simple"/></inline-formula> pairs, making it far more tractable for inference.</p>
</sec><sec id="s4b2">
<title>Reduced model for coalescent threading</title>
<p>The state space can be reduced further by proceeding in two steps. First, we sample a <italic>coalescent threading</italic> <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e566" xlink:type="simple"/></inline-formula> from the marginal distribution <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e567" xlink:type="simple"/></inline-formula>. Then we sample a <italic>recombination threading</italic>, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e568" xlink:type="simple"/></inline-formula>, from the conditional distribution <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e569" xlink:type="simple"/></inline-formula>. Notice that the data need not be considered when sampling the recombination threading, because <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e570" xlink:type="simple"/></inline-formula> is conditionally independent of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e571" xlink:type="simple"/></inline-formula> given <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e572" xlink:type="simple"/></inline-formula>, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e573" xlink:type="simple"/></inline-formula>, and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e574" xlink:type="simple"/></inline-formula>.</p>
<p>The marginal distribution <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e575" xlink:type="simple"/></inline-formula> can be computed efficiently by changing the order of products and sums in the usual way for HMMs:<disp-formula id="pgen.1004342.e576"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pgen.1004342.e576" xlink:type="simple"/><label>(19)</label></disp-formula>This equation defines an HMM with a state space given by the possible values of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e577" xlink:type="simple"/></inline-formula> only, the size of which is bounded by <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e578" xlink:type="simple"/></inline-formula>, where <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e579" xlink:type="simple"/></inline-formula> is the number of sequences and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e580" xlink:type="simple"/></inline-formula> is the number of time intervals (see <xref ref-type="fig" rid="pgen-1004342-g003">Figure 3C</xref>).</p>
<p>While this model has the conditional independence structure of a standard HMM, the state space is heterogeneous along the sequence, because the set of possible coalescent points at each position <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e581" xlink:type="simple"/></inline-formula> depends on the local tree, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e582" xlink:type="simple"/></inline-formula>. (The full threading HMM described above also has this property.) If we denote the state space at position <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e583" xlink:type="simple"/></inline-formula> as <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e584" xlink:type="simple"/></inline-formula>, the transition probabilities between states in position <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e585" xlink:type="simple"/></inline-formula> and states in position <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e586" xlink:type="simple"/></inline-formula> are defined by a <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e587" xlink:type="simple"/></inline-formula> transition matrix <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e588" xlink:type="simple"/></inline-formula> where <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e589" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e590" xlink:type="simple"/></inline-formula> index the states of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e591" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e592" xlink:type="simple"/></inline-formula>, respectively, and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e593" xlink:type="simple"/></inline-formula> can be computed as,<disp-formula id="pgen.1004342.e594"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pgen.1004342.e594" xlink:type="simple"/><label>(20)</label></disp-formula>using <xref ref-type="disp-formula" rid="pgen.1004342.e421">equations 5</xref> and <xref ref-type="disp-formula" rid="pgen.1004342.e487">13</xref>. The emission probability for alignment column <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e595" xlink:type="simple"/></inline-formula> in state <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e596" xlink:type="simple"/></inline-formula> in <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e597" xlink:type="simple"/></inline-formula> is denoted <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e598" xlink:type="simple"/></inline-formula> and can be computed using Felsenstein's pruning algorithm, as in all cases above. The initial state probabilities for the HMM are given by <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e599" xlink:type="simple"/></inline-formula> for <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e600" xlink:type="simple"/></inline-formula> and can be computed using <xref ref-type="disp-formula" rid="pgen.1004342.e494">equations 14</xref>–<xref ref-type="disp-formula" rid="pgen.1004342.e505">16</xref>.</p>
<p>Notice that, unlike with a standard, locally normalized HMM, it is not true in this model that <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e601" xlink:type="simple"/></inline-formula>. Furthermore, for two positions <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e602" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e603" xlink:type="simple"/></inline-formula>, it is not true in general that <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e604" xlink:type="simple"/></inline-formula>, because of differences across positions in the local trees <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e605" xlink:type="simple"/></inline-formula> and recombination points <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e606" xlink:type="simple"/></inline-formula>. Similarly, it is not true that <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e607" xlink:type="simple"/></inline-formula>. Thus, this model is not only globally unnormalized, but it also has a heterogeneous local normalization structure across positions. Importantly, this heterogeneity stems directly from differences in the <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e608" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e609" xlink:type="simple"/></inline-formula> and is inherent in the threading problem—that is, it is not possible to express the desired conditional distribution, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e610" xlink:type="simple"/></inline-formula>, directly in terms of a locally normalized hidden Markov model (one in which all transition probabilities and all emission probabilities sum to one at each position in the sequence). For this reason, we find it most convenient to work with the unnormalized clamped joint distribution.</p>
</sec><sec id="s4b3">
<title>Stochastic traceback</title>
<p>Despite the unusual features of the HMM described in the previous section, it still permits the use of standard dynamic programming algorithms to integrate over all coalescent threadings <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e611" xlink:type="simple"/></inline-formula> (the forward or backward algorithms), obtain a most likely threading <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e612" xlink:type="simple"/></inline-formula> (the Viterbi algorithm), compute marginal posterior distributions for each <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e613" xlink:type="simple"/></inline-formula> (forward-backward algorithm), and sample threadings in proportion to their conditional probability <xref ref-type="bibr" rid="pgen.1004342-Rabiner1">[102]</xref>, <xref ref-type="bibr" rid="pgen.1004342-Durbin1">[103]</xref>. These algorithms depend only on the linear conditional independence structure of the model (and, equivalently, on its factorization into local transition and emission probabilities) and on the use of nonnegative potential functions, both properties that are maintained in this model.</p>
<p>We are primarily interested in a dynamic programming algorithm for sampling from the posterior distribution over HMM paths that is sometimes referred to as the <italic>stochastic traceback</italic> algorithm <xref ref-type="bibr" rid="pgen.1004342-Durbin1">[103]</xref>–<xref ref-type="bibr" rid="pgen.1004342-Zhu1">[105]</xref>. In our case, each application of this algorithm is guaranteed to sample a coalescent threading <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e614" xlink:type="simple"/></inline-formula> in proportion to the density <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e615" xlink:type="simple"/></inline-formula>, and equivalently, in proportion to the desired conditional distribution.</p>
<p>The stochastic traceback algorithm consists of a deterministic forward pass and a stochastic backward pass. The forward pass is identical to the forward algorithm. In our notation, the algorithm recursively fills out a matrix <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e616" xlink:type="simple"/></inline-formula>, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e617" xlink:type="simple"/></inline-formula>, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e618" xlink:type="simple"/></inline-formula>. Each <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e619" xlink:type="simple"/></inline-formula> represents the probability of a prefix of the data joint with a constraint on the state path at position <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e620" xlink:type="simple"/></inline-formula>. Here, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e621" xlink:type="simple"/></inline-formula>, where the notation <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e622" xlink:type="simple"/></inline-formula> indicates the subsequence <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e623" xlink:type="simple"/></inline-formula>. After an initialization of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e624" xlink:type="simple"/></inline-formula>, for <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e625" xlink:type="simple"/></inline-formula>, the algorithm proceeds iteratively for <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e626" xlink:type="simple"/></inline-formula> from 2 to <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e627" xlink:type="simple"/></inline-formula> and sets each value <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e628" xlink:type="simple"/></inline-formula> (for <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e629" xlink:type="simple"/></inline-formula>) equal to,<disp-formula id="pgen.1004342.e630"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pgen.1004342.e630" xlink:type="simple"/><label>(21)</label></disp-formula>Note that the heterogeneity of the state space along the sequence implies that portions of the matrix are left undefined.</p>
<p>In the backward pass, the algorithm samples a sequence <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e631" xlink:type="simple"/></inline-formula> one element at a time, starting with <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e632" xlink:type="simple"/></inline-formula> and working backward to <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e633" xlink:type="simple"/></inline-formula>. First, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e634" xlink:type="simple"/></inline-formula> is simply sampled in proportion to <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e635" xlink:type="simple"/></inline-formula>. Then, for <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e636" xlink:type="simple"/></inline-formula> from <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e637" xlink:type="simple"/></inline-formula> down to 1, each <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e638" xlink:type="simple"/></inline-formula> is sampled conditional on <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e639" xlink:type="simple"/></inline-formula> in proportion to,<disp-formula id="pgen.1004342.e640"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pgen.1004342.e640" xlink:type="simple"/><label>(22)</label></disp-formula>The limiting step of the algorithm is the forward pass, which in general requires <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e641" xlink:type="simple"/></inline-formula> time, where <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e642" xlink:type="simple"/></inline-formula> is the size of the state space, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e643" xlink:type="simple"/></inline-formula>. However, in our case the structure of the <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e644" xlink:type="simple"/></inline-formula> matrices can be exploited to reduce the running time to <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e645" xlink:type="simple"/></inline-formula> (see <xref ref-type="supplementary-material" rid="pgen.1004342.s022">Text S1</xref>).</p>
<p>It can be shown by induction on suffixes of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e646" xlink:type="simple"/></inline-formula> that this procedure will correctly sample from the target distribution, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e647" xlink:type="simple"/></inline-formula>. Briefly, in the base case, the suffix <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e648" xlink:type="simple"/></inline-formula> is by construction sampled from the density <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e649" xlink:type="simple"/></inline-formula>, which is proportional to the desired conditional distribution, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e650" xlink:type="simple"/></inline-formula>. For the inductive case, assume <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e651" xlink:type="simple"/></inline-formula> has been sampled from <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e652" xlink:type="simple"/></inline-formula>. The procedure of sampling <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e653" xlink:type="simple"/></inline-formula> from <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e654" xlink:type="simple"/></inline-formula> given <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e655" xlink:type="simple"/></inline-formula> is equivalent to sampling from,<disp-formula id="pgen.1004342.e656"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pgen.1004342.e656" xlink:type="simple"/><label>(23)</label></disp-formula>where the last step is possible because <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e657" xlink:type="simple"/></inline-formula> is conditionally independent of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e658" xlink:type="simple"/></inline-formula>, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e659" xlink:type="simple"/></inline-formula>, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e660" xlink:type="simple"/></inline-formula>, and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e661" xlink:type="simple"/></inline-formula> given <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e662" xlink:type="simple"/></inline-formula>. Thus, the algorithm will correctly sample from <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e663" xlink:type="simple"/></inline-formula> for all <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e664" xlink:type="simple"/></inline-formula> such that <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e665" xlink:type="simple"/></inline-formula>.</p>
</sec><sec id="s4b4">
<title>Sampling a recombination threading</title>
<p>The final step in the threading operation is to sample a recombination threading <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e666" xlink:type="simple"/></inline-formula> conditional on a coalescent threading <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e667" xlink:type="simple"/></inline-formula> and the clamped parameters. This step is greatly simplified by the fact that the individual <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e668" xlink:type="simple"/></inline-formula> values are conditionally independent of one another given the <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e669" xlink:type="simple"/></inline-formula> variables and the clamped <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e670" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e671" xlink:type="simple"/></inline-formula> variables (see <xref ref-type="fig" rid="pgen-1004342-g003">Figure 3B</xref>). Consequently, each <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e672" xlink:type="simple"/></inline-formula> can be sampled separately from the distribution,<disp-formula id="pgen.1004342.e673"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pgen.1004342.e673" xlink:type="simple"/><label>(24)</label></disp-formula>where the <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e674" xlink:type="simple"/></inline-formula> variables are now clamped along with the <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e675" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e676" xlink:type="simple"/></inline-formula> variables. Notice that the distribution on the RHS is the same one considered in <xref ref-type="disp-formula" rid="pgen.1004342.e576">equations 19</xref> &amp; <xref ref-type="disp-formula" rid="pgen.1004342.e594">20</xref>. The normalizing constant for this distribution, for clamped values <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e677" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e678" xlink:type="simple"/></inline-formula>, is given by the transition probability <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e679" xlink:type="simple"/></inline-formula>.</p>
<p>Notice that this distribution is implicitly degenerate in the case in which <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e680" xlink:type="simple"/></inline-formula>, owing to the limitation of at most one recombination event per position. In particular, if <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e681" xlink:type="simple"/></inline-formula>, then <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e682" xlink:type="simple"/></inline-formula>, hence <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e683" xlink:type="simple"/></inline-formula>. At the same time, notice that, if <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e684" xlink:type="simple"/></inline-formula>, a new recombination is still possible (<inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e685" xlink:type="simple"/></inline-formula>) even if <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e686" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e687" xlink:type="simple"/></inline-formula>, because a branch could be broken by a recombination event but then re-coalesce at precisely its original position in the local tree.</p>
<p>When <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e688" xlink:type="simple"/></inline-formula>, the efficiency of sampling from this distribution can be improved by noting that most possible <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e689" xlink:type="simple"/></inline-formula> values still have zero probability. Let <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e690" xlink:type="simple"/></inline-formula> represent the set of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e691" xlink:type="simple"/></inline-formula> values having nonzero probability for given values of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e692" xlink:type="simple"/></inline-formula>, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e693" xlink:type="simple"/></inline-formula>, and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e694" xlink:type="simple"/></inline-formula>, where <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e695" xlink:type="simple"/></inline-formula> denotes the branch being threaded. There are two cases to consider, a main case and a special case. We will denote the corresponding subsets of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e696" xlink:type="simple"/></inline-formula> values <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e697" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e698" xlink:type="simple"/></inline-formula>, with <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e699" xlink:type="simple"/></inline-formula>. Recall that <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e700" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e701" xlink:type="simple"/></inline-formula>, where <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e702" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e703" xlink:type="simple"/></inline-formula> are branches in <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e704" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e705" xlink:type="simple"/></inline-formula>, respectively, and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e706" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e707" xlink:type="simple"/></inline-formula> are time points from the set <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e708" xlink:type="simple"/></inline-formula>. In the main case, the recombination occurs on the new branch <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e709" xlink:type="simple"/></inline-formula>. Here, the recombination time <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e710" xlink:type="simple"/></inline-formula> must be at least as recent as both the old and new re-coalescence times, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e711" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e712" xlink:type="simple"/></inline-formula>. Thus, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e713" xlink:type="simple"/></inline-formula>. Notice that <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e714" xlink:type="simple"/></inline-formula>.</p>
<p>The special case occurs when the recombination occurs not on the new branch, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e715" xlink:type="simple"/></inline-formula>, but instead on <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e716" xlink:type="simple"/></inline-formula>, the branch to which <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e717" xlink:type="simple"/></inline-formula> re-coalesces at position <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e718" xlink:type="simple"/></inline-formula>. A recombination on branch <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e719" xlink:type="simple"/></inline-formula>, below the point at which <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e720" xlink:type="simple"/></inline-formula> joins it, followed by a re-coalescence of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e721" xlink:type="simple"/></inline-formula> to <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e722" xlink:type="simple"/></inline-formula> (meaning that <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e723" xlink:type="simple"/></inline-formula>) will produce a signature exactly like the symmetric case of a recombination on <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e724" xlink:type="simple"/></inline-formula> followed by a re-coalescence to <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e725" xlink:type="simple"/></inline-formula> (Supplementary <xref ref-type="supplementary-material" rid="pgen.1004342.s021">Figure S21</xref>), so this scenario must also be considered. This case can only occur when <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e726" xlink:type="simple"/></inline-formula> and in the interval of time between the start of branch <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e727" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e728" xlink:type="simple"/></inline-formula>. Recombinations on other branches need not be considered, because the existence of such a recombination would imply that <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e729" xlink:type="simple"/></inline-formula>, contrary to our assumption. Hence,<disp-formula id="pgen.1004342.e730"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pgen.1004342.e730" xlink:type="simple"/><label>(25)</label></disp-formula>where <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e731" xlink:type="simple"/></inline-formula> is the time point of the child node of branch <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e732" xlink:type="simple"/></inline-formula>. As with <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e733" xlink:type="simple"/></inline-formula>, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e734" xlink:type="simple"/></inline-formula>.</p>
<p>By enumerating the elements of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e735" xlink:type="simple"/></inline-formula>, it is possible to sample each <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e736" xlink:type="simple"/></inline-formula> in <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e737" xlink:type="simple"/></inline-formula> time. The same approach can be used to enable calculation of the <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e738" xlink:type="simple"/></inline-formula> values (<xref ref-type="disp-formula" rid="pgen.1004342.e594">equation 20</xref>) in <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e739" xlink:type="simple"/></inline-formula> time.</p>
</sec></sec><sec id="s4c">
<title>Data Preparation</title>
<sec id="s4c1">
<title>Simulated data</title>
<p>Except where noted otherwise, simulations were performed under the full coalescent-with-recombination model <xref ref-type="bibr" rid="pgen.1004342-Hudson2">[21]</xref>. After generation of local trees, sequence alignments were generated using a finite-sites Jukes-Cantor model <xref ref-type="bibr" rid="pgen.1004342-Jukes1">[53]</xref>. All simulations were performed using custom computer programs. Our standard simulation scheme involved the generation of of twenty 1-Mb sequences, assuming an effective population size of <italic>N</italic> = 10,000, a mutation rate of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e740" xlink:type="simple"/></inline-formula> mutations/site/generation, and mutation-to-recombination rate ratios of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e741" xlink:type="simple"/></inline-formula> (i.e., recombination rates of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e742" xlink:type="simple"/></inline-formula> events/site/generation). One hundred replicate data sets were generated for each choice of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e743" xlink:type="simple"/></inline-formula>. Alternative parameter values were used in certain cases, as noted in the text and figure captions.</p>
</sec><sec id="s4c2">
<title>Real data</title>
<p>Information about human polymorphisms came from the “69 Genomes” data set from Complete Genomics (CG) (<ext-link ext-link-type="uri" xlink:href="http://www.completegenomics.com/public-data/69-Genomes" xlink:type="simple">http://www.completegenomics.com/public-data/69-Genomes</ext-link>). For each individual considered, we recorded the diploid genotype call reported for each position in the hg19 (Genome Reference Consortium Human Build 37) reference genome using CG's ‘masterVar’ files. We considered both “SNPs” and “length-preserving substitutions” in the masterVar file, and also noted positions where CG could not confidently assign a genotype. All other positions were assumed to be homozygous for the allele reported in the reference genome.</p>
<p>Borrowing from our previous work on demography inference <xref ref-type="bibr" rid="pgen.1004342-Gronau1">[92]</xref>, we applied several filters to these data to reduce the impact of technical errors from alignment, sequencing, genotype inference, and genome assembly. These filters include simple repeats, recent segmental duplications, and transposable elements. We phased the data using SHAPEIT v2 <xref ref-type="bibr" rid="pgen.1004342-Delaneau1">[59]</xref>, guided by the pedigree information describing the relationships among the 69 individuals. After phasing, we removed the child in each trio, as well as all but the four grandparents in the 17-member CEU pedigree, leaving 54 unrelated individuals in our data set. From this set, we further filtered all CpG sites, sites with more than two observed alleles, and sites at which CG did not call a genotype in any of the 54 individuals. All genomic positions excluded by our filters were treated as missing data by <italic>ARGweaver</italic>, meaning that the program integrated over all possible nucleotides at these positions (as in <xref ref-type="bibr" rid="pgen.1004342-Gronau1">[92]</xref>).</p>
<p>In order to account for region-specific variation in recombination and mutation rates, we used the HapMap phase II recombination map <xref ref-type="bibr" rid="pgen.1004342-International1">[106]</xref> and a mutation rate map estimated from alignments of several primate genomes, including chimpanzee (panTro2), orangutan (ponAbe2), and rhesus Macaque (rheMac2) <xref ref-type="bibr" rid="pgen.1004342-Gronau2">[107]</xref>. Mutation rates were scaled to have an average of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e744" xlink:type="simple"/></inline-formula> mutations/generation/site and were averaged over 100 kb non-overlapping windows. This value was obtained by assuming a genome-wide average of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e745" xlink:type="simple"/></inline-formula> mutations/generation/site, and observing a <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e746" xlink:type="simple"/></inline-formula> reduction in nucleotide diversity when the CpG filter was applied.</p>
<p>Calls of hypervariable and invariant regions were obtained from the CG FTP site (<ext-link ext-link-type="uri" xlink:href="ftp://ftp2.completegenomics.com" xlink:type="simple">ftp://ftp2.completegenomics.com</ext-link>). Copy number variant calls for each individual were obtained from a file named cnvDetailsDiploidBeta, which was extracted from an ASM-VAR-files tar archive.</p>
</sec></sec><sec id="s4d">
<title>Data Analysis</title>
<p>To sample ARGs genome-wide, we split each sequence alignment into non-overlapping segments of 2 Mb, flanked on each side by 100 kb of overlapping sequence. We chose a core set of 12 individuals (24 haplotypes) randomly such that each major population group was represented. We then used <italic>ARGweaver</italic> to sample ARGs for these genomes, assuming a population size of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e747" xlink:type="simple"/></inline-formula> <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e748" xlink:type="simple"/></inline-formula> time steps, and a maximum time of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e749" xlink:type="simple"/></inline-formula> generations. Our prior estimate of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e750" xlink:type="simple"/></inline-formula> was based on an empirical estimate of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e751" xlink:type="simple"/></inline-formula> from the CG sequence data, and an assumption of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e752" xlink:type="simple"/></inline-formula> mutations per site per generation for non-CpG sites (see previous section). This initial step involved 500 sampling iterations, consisting of 100 initial iterations under an infinite sites assumption, and 400 iterations with the full finite sites model. The final sample from this initial step was used as a starting point for threading in the remaining genomes. Once these were threaded, we applied <italic>ARGweaver</italic> with infinite sites for 100 iterations, followed by 2400 iterations with the finite sites model. Samples were recorded every 10 iterations for the final 2000 iterations, for a total of 200 samples. For our genome-wide analyses, we integrated the separate 2.2 Mb analyses by setting a switchpoint at the middle of each overlapping 100 kb segment, in order to minimize boundary effects at the analyzed sites.</p>
<p>To compute the neutral CDFs in <xref ref-type="supplementary-material" rid="pgen.1004342.s017">Figure S17</xref>, we used a set of putatively neutral regions obtained by removing all GENCODE (v15) genes plus 1000 bp flank on either side of each exon, as well as all mammalian phastCons elements plus 100 bp of flanking sequence. From the remaining portion of the genome, we sampled 1000 sets of 69 regions with the same distribution of lengths as the non-CpG regions identified by <xref ref-type="bibr" rid="pgen.1004342-Leffler1">[77]</xref>.</p>
<p>To estimate the allele age at each polymorphic site, we considered all local genealogies sampled at that position, discarding any sampled genealogies that required more than one mutation to explain the observed data. In addition, we required that all of the retained genealogies implied the same derived allele, excluding positions that violated this condition from our analysis. For the remaining cases, we estimated the allele age for each sample as the average age of the branch on which the mutation leading to the derived allele was assumed to occur by parsimony, and averaged this value across samples.</p>
</sec></sec><sec id="s5">
<title>Supporting Information</title>
<supplementary-material id="pgen.1004342.s001" mimetype="application/pdf" xlink:href="info:doi/10.1371/journal.pgen.1004342.s001" position="float" xlink:type="simple"><label>Figure S1</label><caption>
<p>ARGs simulated under Discretized Sequentially Markov Coalescent model are similar to those simulated under continueous models. ARGs were simulated using the coalescent-with-recombination (red), Sequentially Markov Coalescent (green), and Discretized Sequentially Markov Coalescent (blue). Three versions of the DSMC were considered: ones with with <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e753" xlink:type="simple"/></inline-formula> (dark blue), <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e754" xlink:type="simple"/></inline-formula> (medium blue), and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e755" xlink:type="simple"/></inline-formula> (light blue) time intervals. In all cases, we assumed <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e756" xlink:type="simple"/></inline-formula> generations. Our standard simulation parameters were used (see <xref ref-type="sec" rid="s4">Methods</xref>) except that sequences were of length 100 kb (rather than 1 Mb) to save in computation. (A) Numbers of recombinations at four different recombination rates corresponding to <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e757" xlink:type="simple"/></inline-formula> (in reverse order). To make the comparison fair, recombinations between nonancestral sequences (which are disallowed by the SMC/DSMC) are excluded in the case of the coalescent-with-recombination. However, “diamond” or “bubble” recombinations (ones that are immediately reversed by coalescence events, going backwards in time) were included, so any distortion from excluding these events in the SMC/DSMC is reflected in the figure. (B) Numbers of segregating sites at three different effective population sizes with <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e758" xlink:type="simple"/></inline-formula>.</p>
<p>(PDF)</p>
</caption></supplementary-material><supplementary-material id="pgen.1004342.s002" mimetype="application/pdf" xlink:href="info:doi/10.1371/journal.pgen.1004342.s002" position="float" xlink:type="simple"><label>Figure S2</label><caption>
<p>Illustration of “leaf trace.” An example leaf trace (highlighted in gray) is shown for a hypothetical 10-kb genomic segment and six haploid sequences. The ARG for these sequences contains two local trees (shown to left and right) separated by a single recombination event (red circle and arrow). In the leaf trace, each sequence is represented by a line, and these lines are ordered and spaced according to the local tree at each position. Spacing between adjacent lines is proportional to time to most recent common ancestry of associated sequences. (Notice, however, that it is not possible to impose a similar interpretation on non-adjacent lines in the diagram.) Nonrecombining genomic intervals are reflected by blocks of parallel lines. Recombinations lead to changes in spacing and/or order and produce vertical lines in the plot. Notice that aspects of the leaf ordering are arbitrary, because the two children between each ancestral node can be exchanged without altering the meaning of the diagram. In addition, this visualization device applies to a single ARG and does not easily generalize to distributions of possible ARGs. For our genome browser tracks, we use the single most likely ARG sampled by <italic>ARGweaver</italic> as the basis for the plots. Finally, note that the lines in the plot can be colored in various ways. In our current tracks, they are colored according to the population origin of each haploid sequence.</p>
<p>(PDF)</p>
</caption></supplementary-material><supplementary-material id="pgen.1004342.s003" mimetype="application/pdf" xlink:href="info:doi/10.1371/journal.pgen.1004342.s003" position="float" xlink:type="simple"><label>Figure S3</label><caption>
<p>Convergence of <italic>ARGweaver</italic> with simulated data. When the number of sequences exceeds 6–8, the Metropolis-Hastings algorithm and subtree threading operation are needed for <italic>ARGweaver</italic> to have acceptable convergence properties. This plot shows results for 20 1-Mb sequences, generated under our standard simulation parameters with <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e759" xlink:type="simple"/></inline-formula> (<xref ref-type="sec" rid="s4">Methods</xref>). Here the measure of convergence is the difference between the number of inferred recombination events and the number of true recombination events. Other measures show similar patterns.</p>
<p>(PDF)</p>
</caption></supplementary-material><supplementary-material id="pgen.1004342.s004" mimetype="application/pdf" xlink:href="info:doi/10.1371/journal.pgen.1004342.s004" position="float" xlink:type="simple"><label>Figure S4</label><caption>
<p>Recovery of global features of simulated data for various values of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e760" xlink:type="simple"/></inline-formula>. This figure is the same as <xref ref-type="fig" rid="pgen-1004342-g004">Figure 4A</xref>, except that it shows results for four different values of the mutation-to-recombination rate ratio, ranging from <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e761" xlink:type="simple"/></inline-formula> (bottom row) to <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e762" xlink:type="simple"/></inline-formula> (top row). The second row from the bottom (with <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e763" xlink:type="simple"/></inline-formula>) is identical to <xref ref-type="fig" rid="pgen-1004342-g004">Figure 4A</xref>. Notice that high values of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e764" xlink:type="simple"/></inline-formula> lead to reduced variance in all estimates, owing to larger numbers of mutations per local genealogy, but that the estimates remain reasonably accurate in all cases. However, there does appear to be a slight tendency to under-estimate the number of recombinations, particularly at low values of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e765" xlink:type="simple"/></inline-formula>, probably due to approximations inherent in the DSMC (see text). Note that these are generated by the full coalescent with recombination, not the DSMC.</p>
<p>(PDF)</p>
</caption></supplementary-material><supplementary-material id="pgen.1004342.s005" mimetype="image/png" xlink:href="info:doi/10.1371/journal.pgen.1004342.s005" position="float" xlink:type="simple"><label>Figure S5</label><caption>
<p>Recovery of TMRCA along simulated sequences for various values of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e766" xlink:type="simple"/></inline-formula>. This figure is the same as <xref ref-type="fig" rid="pgen-1004342-g004">Figure 4B</xref> except that it shows results for four diffrent values of the mutation-to-recombination rate ratio, ranging from <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e767" xlink:type="simple"/></inline-formula> (bottom panel) to <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e768" xlink:type="simple"/></inline-formula> (top panel). Each panel represents one randomly selected simulated data set. Pearson's correlation coefficients (<inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e769" xlink:type="simple"/></inline-formula>) for true vs. estimated TMRCAs across all local trees are shown in the top right corner of each panel. As expected, the quality of the estimates generally improves with <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e770" xlink:type="simple"/></inline-formula>, but this example suggests there is limited improvement above <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e771" xlink:type="simple"/></inline-formula>.</p>
<p>(PNG)</p>
</caption></supplementary-material><supplementary-material id="pgen.1004342.s006" mimetype="application/pdf" xlink:href="info:doi/10.1371/journal.pgen.1004342.s006" position="float" xlink:type="simple"><label>Figure S6</label><caption>
<p>Recovery of recombination rates from simulated data. We simulated an alignment of 100 sequences with <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e772" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e773" xlink:type="simple"/></inline-formula>, allowing for variable recombination rates based on estimates along the human genome. Despite the assumption in the prior of a constant recombination rate of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e774" xlink:type="simple"/></inline-formula>, the posterior mean estimate of the average number of recombinations in a 1 kb sliding window (red line) correlates well with the true recombination rates used during simulation (black line). Notice that recombination hotspots are clearly identifiable by peaks in the inferred rates but the magnitudes of these peaks are dampened by the use of a uniform prior. Only recombinations that produced changes in tree topology (the class that is detectable by our methods) were considered for the plot of the true recombination rate.</p>
<p>(PDF)</p>
</caption></supplementary-material><supplementary-material id="pgen.1004342.s007" mimetype="application/pdf" xlink:href="info:doi/10.1371/journal.pgen.1004342.s007" position="float" xlink:type="simple"><label>Figure S7</label><caption>
<p>Estimating ages of derived alleles in simulated data. (A,C,E,G) Inferred allele age correlates well with true allele age according to both Pearson's (<inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e775" xlink:type="simple"/></inline-formula>) and Spearman's rank (<inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e776" xlink:type="simple"/></inline-formula>) correlation coefficients. Correlation is strongest for high mutation/recombination rate ratios. Ages were estimated by calculating the midpoint of the branch on which the mutation was inferred to occur, under an infinite sites model, and averaging across sample from the posterior distribution. Points are colored on a spectrum from blue to green in proportion to derived allele frequencies. (B,D,F,H) Allele frequency has significantly lower correlation with true allele age, implying that the ARG will enable much better estimates of allele age than allele frequencies alone. Ages are measured in generations before the present. Our standard simulated data sets were used (<xref ref-type="sec" rid="s4">Methods</xref>).</p>
<p>(PDF)</p>
</caption></supplementary-material><supplementary-material id="pgen.1004342.s008" mimetype="application/pdf" xlink:href="info:doi/10.1371/journal.pgen.1004342.s008" position="float" xlink:type="simple"><label>Figure S8</label><caption>
<p>Recovery of local tree topologies. Sequences were simulated under the coalescent-with-recombination using our standard parameters (<xref ref-type="sec" rid="s4">Methods</xref>), ARGs were inferred using <italic>ARGweaver</italic>, then 100 equally spaced local trees were extracted from the sampled ARGs. The topologies of these trees were compared with the true trees generated during simulation at corresponding positions in the alignment. We compared <italic>ARGweaver</italic> with the heuristic programs <italic>Margarita</italic> <xref ref-type="bibr" rid="pgen.1004342-Minichiello1">[34]</xref> and <italic>treesim</italic> using two measures: (A) branch correctness (one minus the normalized Robinson-Foulds (RF) distance <xref ref-type="bibr" rid="pgen.1004342-Robinson1">[108]</xref>) and (B) Maximum Agreement Subtree (MAST) percentages (the size of the largest leaf-set such that induced subtrees are topologically equivalent, expressed as a percentage of the total number of leaves), across a range of mutation to recombination rate ratios (<inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e777" xlink:type="simple"/></inline-formula>). In both (A) and (B), error bars reflect one standard error assuming independence of 100 local trees ×10 simulation replicates.</p>
<p>(PDF)</p>
</caption></supplementary-material><supplementary-material id="pgen.1004342.s009" mimetype="application/pdf" xlink:href="info:doi/10.1371/journal.pgen.1004342.s009" position="float" xlink:type="simple"><label>Figure S9</label><caption>
<p>Local tree branch posterior probabilities inferred by <italic>ARGweaver</italic> accurately reflect their probability of correctness. The branch posterior probabilities found by <italic>ARGweaver</italic> (red) and <italic>treesim</italic> (green) more accurately reflect the probability of the branch being correct than the frequency at which <italic>Margarita</italic> (blue) infers a branch. For each method, branches were binned by their posterior probability (windows of 5%) and compared against their frequency of branch correctness. Shaded regions represent the 95% binomial confidence interval. This plot is based on our standard simulated data set with <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e778" xlink:type="simple"/></inline-formula>. Posterior probabilities for <italic>ARGweaver</italic> are based on 1000 samples from the Markov chain, and the probabilities for <italic>Margarita</italic> and <italic>treesim</italic> reflect 100 independent samples.</p>
<p>(PDF)</p>
</caption></supplementary-material><supplementary-material id="pgen.1004342.s010" mimetype="application/pdf" xlink:href="info:doi/10.1371/journal.pgen.1004342.s010" position="float" xlink:type="simple"><label>Figure S10</label><caption>
<p>Illustration of relative TMRCA halflife (RTH). Expected genealogies under (A) neutral drift, (B) background selection, and (C) a partial selective sweep. In each panel, the arrows to the left indicate the complete TMRCA (<inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e779" xlink:type="simple"/></inline-formula>) and the “half TMRCA” (<inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e780" xlink:type="simple"/></inline-formula>), that is, the minimum time required for half of all lineages to find a single most recent common ancestor. The relative TMRCA halflife (RTH) is defined by the ratio <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e781" xlink:type="simple"/></inline-formula>. Because background selection (B) should primarily reduce the overall rate of coalescence, in a manner more or less homogeneous with respect to time, it is expected to have little effect on the RTH. Partial sweeps (C), however, will tend to produce a “burst” of coalescent events following a causal mutation (red circle), leading to reduced values of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e782" xlink:type="simple"/></inline-formula>. Nevertheless, because some lineages escape the sweep, the full TMRCA <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e783" xlink:type="simple"/></inline-formula> is likely to remain similar to its value under neutrality. As a result, the RTH will be reduced.</p>
<p>(PDF)</p>
</caption></supplementary-material><supplementary-material id="pgen.1004342.s011" mimetype="application/pdf" xlink:href="info:doi/10.1371/journal.pgen.1004342.s011" position="float" xlink:type="simple"><label>Figure S11</label><caption>
<p>Measures of genetic variation near protein-coding genes and partial selective sweeps for African populations. This figures is identical to <xref ref-type="fig" rid="pgen-1004342-g005">Figure 5</xref> except that it shows results for 17 African individuals or 34 haploid genomies (from the YRI, MKK, and LWK populations). Panel (A) is based on the same 17,845 protein-coding genes as in <xref ref-type="fig" rid="pgen-1004342-g005">Figure 5A</xref>. Panel (B) is based on 271 100-kb regions predicted to have undergone partial selective sweeps in the YRI population based on the iHS statistic <xref ref-type="bibr" rid="pgen.1004342-Voight2">[72]</xref>.</p>
<p>(PDF)</p>
</caption></supplementary-material><supplementary-material id="pgen.1004342.s012" mimetype="application/pdf" xlink:href="info:doi/10.1371/journal.pgen.1004342.s012" position="float" xlink:type="simple"><label>Figure S12</label><caption>
<p>Time to most recent common ancestry (TMRCA) in the human leukocyte antigen (HLA) region. Genome browser track displaying the sitewise time to most recent common ancestry (TMRCA) estimated by <italic>ARGweaver</italic> based on the Complete Genomics individual human genome sequence data (track is available at <ext-link ext-link-type="uri" xlink:href="http://genome-mirror.bscb.cornell.edu" xlink:type="simple">http://genome-mirror.bscb.cornell.edu</ext-link>, assembly hg19). The human leukocyte antigen (HLA) region on human chromosome 6 contains many genomic intervals with extremely elevated expected TMRCAs, including four of the top 20 10-kb regions in the genome (highlighted here in gold; see descriptions in <xref ref-type="table" rid="pgen-1004342-t002">Table 2</xref>). The red line indicates the posterior mean of the TMRCA (estimated by averaging over the sampled local trees) and the blue lines above and below indicate a Bayesian 95% credible interval.</p>
<p>(PDF)</p>
</caption></supplementary-material><supplementary-material id="pgen.1004342.s013" mimetype="application/pdf" xlink:href="info:doi/10.1371/journal.pgen.1004342.s013" position="float" xlink:type="simple"><label>Figure S13</label><caption>
<p>Mutation-rate normalized polymorphism rates in the 1000 Genomes Phase 1 data are elevated in the top twenty 10 kb regions by TMRCA. Shown are cumulative distribution fuctions for normalized polymorphism rates (computed as for <xref ref-type="table" rid="pgen-1004342-t002">Table 2</xref>) in all 10 kb windows across the human genome (black), the top twenty regions shown in <xref ref-type="table" rid="pgen-1004342-t002">Table 2</xref> (red), and the fifteen regions not identified as possible CNVs in <xref ref-type="table" rid="pgen-1004342-t002">Table 2</xref> (blue).</p>
<p>(PDF)</p>
</caption></supplementary-material><supplementary-material id="pgen.1004342.s014" mimetype="application/pdf" xlink:href="info:doi/10.1371/journal.pgen.1004342.s014" position="float" xlink:type="simple"><label>Figure S14</label><caption>
<p><italic>ARGweaver</italic> tracks near <italic>KCNE4</italic>. Shown is a ∼10-kb peak in the estimated TMRCA about 20 kb downstream of the <italic>KCNE4</italic> gene (shown in blue), which encodes a potassium voltage-gated channel strongly expressed in the embryo and adult uterus. The peak overlaps two ChIP-seq-supported transcription factor binding sites analyzed by Arbiza et al. <xref ref-type="bibr" rid="pgen.1004342-Arbiza1">[109]</xref> (“INSIGHT Regulatory Selection” track). The four tracks below the TMRCA plot show that the region in question displays elevated rates of both low-frequency (&lt;10% derived allele frequency; shown in blue) and high-frequency (≥10%; shown in red) polymorphisms in the Complete Genomics data set, despite that divergence-based estimates of the mutation rate are at or below the genome-wide average (average values are indicated by horizontal black lines). <italic>ARGweaver</italic> explains these observations by inferring one of the deepest average TMRCAs in the human genome (#5 in <xref ref-type="table" rid="pgen-1004342-t002">Table 2</xref>). Additional tracks show no indication of copy number variation or recent duplications in this region. The leaf trace indicates that the signal for a deep TMRCA is driven by individuals from African populations (shown in green; the European and East Asian populations are shown in blue and red, respectively), suggesting that this region may contain ancient haplotypes specific to Africa.</p>
<p>(PDF)</p>
</caption></supplementary-material><supplementary-material id="pgen.1004342.s015" mimetype="application/pdf" xlink:href="info:doi/10.1371/journal.pgen.1004342.s015" position="float" xlink:type="simple"><label>Figure S15</label><caption>
<p><italic>ARGweaver</italic> tracks near <italic>BCAR3</italic>. Shown is a large region of elevated TMRCA in an intron of the <italic>BCAR3</italic> gene, which is involved in the development of anti-estrogen resistance in breast cancer. One 10-kb segment of this region has an average expected TMRCA of 377,017 generations, or approximately 9.4 My (#9 in <xref ref-type="table" rid="pgen-1004342-t002">Table 2</xref>). As in the previous example, this region shows elevated polymorphism rates but average or below-average mutation rates and overlaps ChIP-seq-supported transcription factor binding sites (INSIGHT track) <xref ref-type="bibr" rid="pgen.1004342-Arbiza1">[109]</xref>. Again, the regions of extreme TMRCA do not seem to be explained by copy number variation or recent duplications. In this case, however, the leaf trace demonstrates that the ancient haplotypes are distributed across all three major population groups (African = green, European = blue, East Asian = red).</p>
<p>(PDF)</p>
</caption></supplementary-material><supplementary-material id="pgen.1004342.s016" mimetype="application/pdf" xlink:href="info:doi/10.1371/journal.pgen.1004342.s016" position="float" xlink:type="simple"><label>Figure S16</label><caption>
<p><italic>ARGweaver</italic> tracks near <italic>TULP4</italic>. Another large region of elevated TMRCA upstream of the <italic>TULP4</italic> gene, which is thought to be involved in ubiquitination and proteosomal degradation and has a possible association with cleft lip. One 10-kb segment has an average expected TMRCA of 345,382 generations (8.6 My; #16 in <xref ref-type="table" rid="pgen-1004342-t002">Table 2</xref>). As in the previous two examples, this region has elevated polymorphism rates but not mutation rates, overlaps ChIP-seq-supported transcription factor binding sites (INSIGHT track), and does not seem to be an artifact of copy number variation or recent duplications.</p>
<p>(PDF)</p>
</caption></supplementary-material><supplementary-material id="pgen.1004342.s017" mimetype="application/pdf" xlink:href="info:doi/10.1371/journal.pgen.1004342.s017" position="float" xlink:type="simple"><label>Figure S17</label><caption>
<p>Distribution of TMRCAs in regions predicted to be under balancing selection. Cumulative distribution functions (CDFs) are shown for the 125 regions identified by Leffler et al. <xref ref-type="bibr" rid="pgen.1004342-Leffler1">[77]</xref> based on segregating haplotypes shared between humans and chimpanzees (black circles), the subset of 69 loci containing no shared polymorphisms in CpG dinucleotides (red circles) and a collection of 69 putatively neutral regions having the same length distribution. Neutral regions consisted of noncoding regions from which known genes, binding sites, and conserved elements had been removed (see <xref ref-type="bibr" rid="pgen.1004342-Arbiza1">[109]</xref>). Notice the pronounced shift toward larger TMRCAs in the regions predicted to be under balancing selection, and a slightly more pronounced shift for the subset not containing CpGs (which are less likely to have undergone parallel mutations on both lineages). TMRCAs are measured in generations, as in all other figures and tables.</p>
<p>(PDF)</p>
</caption></supplementary-material><supplementary-material id="pgen.1004342.s018" mimetype="application/pdf" xlink:href="info:doi/10.1371/journal.pgen.1004342.s018" position="float" xlink:type="simple"><label>Figure S18</label><caption>
<p><italic>ARGweaver</italic> tracks near locus containing segregating haplotypes shared in humans and chimpanzees. Elevated TMRCA corresponding to a region identified by Leffler et al. <xref ref-type="bibr" rid="pgen.1004342-Leffler1">[77]</xref> between the <italic>FREM3</italic> and <italic>GYPE</italic> genes (#11 in <xref ref-type="table" rid="pgen-1004342-t003">Table 3</xref>; see black square in track at bottom). The shared polymorphisms in this region are in strong linkage disequilibrium with eQTLs for <italic>GYPE</italic>, a paralog of <italic>GYPA</italic>, which may be under balancing selection. The leaf trace indicates that the ancient haplotypes are shared across major human population groups (African = green, European = blue, East Asian = red).</p>
<p>(PDF)</p>
</caption></supplementary-material><supplementary-material id="pgen.1004342.s019" mimetype="application/pdf" xlink:href="info:doi/10.1371/journal.pgen.1004342.s019" position="float" xlink:type="simple"><label>Figure S19</label><caption>
<p>Reduction in mean allele age as a function of annotation class and derived allele frequency. This figure shows the same information as <xref ref-type="fig" rid="pgen-1004342-g006">Figure 6B</xref>, but instead of plotting absolute values of the estimated allele ages, it plots the estimated <italic>reduction</italic> in allele age relative to neutrality, which is defined as the differences between the estimated age for each annotation type and the estimate for the corresponding neutral class (in generations). This representation shows clearly that the reduction in allele age increases with allele frequency much more rapidly for annotation classes under strong selection than for those under weak selection. The contrast between the nearly neutral classes (4d, PPh:Benign, CV:NonPath) and the strongly selected classes (PPh:ProbDam, CV:Path) is particularly striking. This difference can be understood as follows. Reductions in allele age at nearly neutral sites will primarily be a consequence of selection at linked sites, which, to a first approximation, will decrease the local effective population size. This will have the effect of approximately re-scaling allele ages by a constant factor across all ages, making the reduction in age roughly proportional to the absolute age. Mutations under stronger direct selection, by contrast, will spend disproportionally less time at higher frequencies, making their reductions in age at high frequencies disproportionally larger than those for nearly neutral mutations (see <xref ref-type="bibr" rid="pgen.1004342-Kiezun1">[79]</xref>). This effect will occur even in the absence of dominance (<inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e784" xlink:type="simple"/></inline-formula>), but it could be exascerbated by dominance, which will tend to make low-frequency alleles invisible to direct selection. In any case, this plot shows that selection from linked sites can produce comparable, or even larger, reductions in age than direct selection at low allele frequencies, but at high frequencies, direct selection tends to dominate in age reduction.</p>
<p>(PDF)</p>
</caption></supplementary-material><supplementary-material id="pgen.1004342.s020" mimetype="application/pdf" xlink:href="info:doi/10.1371/journal.pgen.1004342.s020" position="float" xlink:type="simple"><label>Figure S20</label><caption>
<p>Human population phylogenies inferred from sampled ancestral recombination graphs. Phylogenetic networks for the eleven populations represented in the Complete Genomics data set were reconstructed using the PhyloNet program <xref ref-type="bibr" rid="pgen.1004342-Than1">[90]</xref>, <xref ref-type="bibr" rid="pgen.1004342-Yu1">[91]</xref>. As input to PhyloNet, we used 2,304 local trees extracted from the ARG at approximately 1 Mb intervals, with one randomly sampled chromosome per population (see <xref ref-type="supplementary-material" rid="pgen.1004342.s022">Text S1</xref>). (A) Population phylogeny inferred in the absence of hybridization/admixture, showing the expected primary relationships among populations. (B) Population networks inferred when between one and five hybridization nodes are allowed. Populations inferred to be admixed are indicated by gray lines and the inferred hybridization nodes are shown as gray circles. Numbers indicate the order in which these nodes appear. For example, when one hybridization node is allowed, the MKK population is inferred to be admixed, and when two are allowed, the MXL population is also inferred to be admixed. The inferred network is consistent with other recent studies in many respects, but PhyloNet is unable to reconstruct the precise topology of the complex subnetwork consisting of the GIH, MXL, PUR, CEU, and TSI populations (see <xref ref-type="supplementary-material" rid="pgen.1004342.s022">Text S1</xref>). Population names follow the convention used by the HapMap 3 and 1000 Genomes projects: CHB = Han Chinese in Beijing, China; JPT = Japanese in Tokyo, Japan; GIH = Gujarati Indians in Houston, Texas; MXL = Mexican ancestry in Los Angeles, California; PUR = Puerto Ricans in Puerto Rico; CEU = Utah residents with Northern and Western European ancestry from the Centre d'Etude de Polymorphisme Humain (CEPH) collection; TSI = Toscani in Italy; MKK = Maasai in Kinyawa, Kenya; LWK = Luhya in Webuye, Kenya; ASW = African ancestry in Southwest USA; YRI = Yoruba in Ibadan, Nigeria.</p>
<p>(PDF)</p>
</caption></supplementary-material><supplementary-material id="pgen.1004342.s021" mimetype="application/pdf" xlink:href="info:doi/10.1371/journal.pgen.1004342.s021" position="float" xlink:type="simple"><label>Figure S21</label><caption>
<p>Cases for new recombination <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e785" xlink:type="simple"/></inline-formula> given re-coalescence point <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e786" xlink:type="simple"/></inline-formula>. (A) In the main case, the recombination <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e787" xlink:type="simple"/></inline-formula> (blue point) occurs on the branch that is being threaded into the ARG (<inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e788" xlink:type="simple"/></inline-formula>; shown in red). After a recombination on this branch, a re-coalescence can occur at any point <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e789" xlink:type="simple"/></inline-formula> (green points) in the local tree <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e790" xlink:type="simple"/></inline-formula> such that <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e791" xlink:type="simple"/></inline-formula> is at least as old as <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e792" xlink:type="simple"/></inline-formula>. Therefore, when enumerating the possible <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e793" xlink:type="simple"/></inline-formula> consistent with a given <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e794" xlink:type="simple"/></inline-formula>, one must consider all points on branch <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e795" xlink:type="simple"/></inline-formula> at least as recent as <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e796" xlink:type="simple"/></inline-formula>. This set is denoted <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e797" xlink:type="simple"/></inline-formula> in the text. (B) There is an additional special case to consider when branch <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e798" xlink:type="simple"/></inline-formula> coalesces to the same branches of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e799" xlink:type="simple"/></inline-formula> at positions <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e800" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e801" xlink:type="simple"/></inline-formula>, that is, when <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e802" xlink:type="simple"/></inline-formula>. In this case, it is possible that the recombination <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e803" xlink:type="simple"/></inline-formula> (blue point) occurs not on the new branch <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e804" xlink:type="simple"/></inline-formula> but on <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e805" xlink:type="simple"/></inline-formula> (black branch) at a time point no older than the re-coalescence time <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e806" xlink:type="simple"/></inline-formula> (green points). A recombination of this kind will leave an identical signature to the symmetric case of a recombination on <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e807" xlink:type="simple"/></inline-formula> in the same time interval followed by a re-coalescence of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e808" xlink:type="simple"/></inline-formula> to <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e809" xlink:type="simple"/></inline-formula>. Therefore, when enumerating the possible <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e810" xlink:type="simple"/></inline-formula> consistent with a given <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e811" xlink:type="simple"/></inline-formula> such that <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e812" xlink:type="simple"/></inline-formula>, one must also consider the set <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e813" xlink:type="simple"/></inline-formula> consisting of all <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e814" xlink:type="simple"/></inline-formula> on <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e815" xlink:type="simple"/></inline-formula> such that <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e816" xlink:type="simple"/></inline-formula> is at least as recent as <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e817" xlink:type="simple"/></inline-formula>. Notice that, in both (A) and (B), the tree excluding <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e818" xlink:type="simple"/></inline-formula> is unchanged by all recombination and coalescence scenarios <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e819" xlink:type="simple"/></inline-formula> under consideration, i.e., <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pgen.1004342.e820" xlink:type="simple"/></inline-formula> (black branches).</p>
<p>(PDF)</p>
</caption></supplementary-material><supplementary-material id="pgen.1004342.s022" mimetype="application/pdf" xlink:href="info:doi/10.1371/journal.pgen.1004342.s022" position="float" xlink:type="simple"><label>Text S1</label><caption>
<p>Supplementary methods and analyses.</p>
<p>(PDF)</p>
</caption></supplementary-material></sec></body>
<back>
<ack>
<p>Much of the preparation of this manuscript was completed while the senior author (AS) was on sabbatical in Nick Goldman's group at the European Bioinformatics Institute. Our real data analysis was enabled by use of the Extreme Science and Engineering Discovery Environment (XSEDE), which is supported by National Science Foundation grant number OCI-1053575 and hosted by the Texas Advanced Computing Center (TACC) at The University of Texas at Austin. We thank Asger Hobolth, Thomas Mailund, Graham Coop, Richard Durbin, Gerton Lunter, Gil McVean, Bob Griffiths, and many others for helpful discussions.</p>
</ack>
<ref-list>
<title>References</title>
<ref id="pgen.1004342-Hein1"><label>1</label>
<mixed-citation publication-type="book" xlink:type="simple">Hein J, Schierup M, Wiuf C (2005) Gene genealogies, variation and evolution: a primer in coalescent theory. Oxford: Oxford University Press.</mixed-citation>
</ref>
<ref id="pgen.1004342-Wakeley1"><label>2</label>
<mixed-citation publication-type="book" xlink:type="simple">Wakeley J (2009) Coalescent theory: an introduction. Greenwood Village: Roberts &amp; Co. Publishers.</mixed-citation>
</ref>
<ref id="pgen.1004342-Fisher1"><label>3</label>
<mixed-citation publication-type="book" xlink:type="simple">Fisher RA (1930) The Genetical Theory of Natural Selection. Oxford: Oxford University Press.</mixed-citation>
</ref>
<ref id="pgen.1004342-Wright1"><label>4</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Wright</surname><given-names>S</given-names></name> (<year>1931</year>) <article-title>Evolution in Mendelian Populations</article-title>. <source>Genetics</source> <volume>16</volume>: <fpage>97</fpage>–<lpage>159</lpage>.</mixed-citation>
</ref>
<ref id="pgen.1004342-Kimura1"><label>5</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Kimura</surname><given-names>M</given-names></name> (<year>1962</year>) <article-title>On the probability of fixation of mutant genes in a population</article-title>. <source>Genetics</source> <volume>47</volume>: <fpage>713</fpage>–<lpage>719</lpage>.</mixed-citation>
</ref>
<ref id="pgen.1004342-Felsenstein1"><label>6</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Felsenstein</surname><given-names>J</given-names></name> (<year>1973</year>) <article-title>Maximum-likelihood and minimum-step methods for estimating evolutionary trees from data on discrete characters</article-title>. <source>Syst Zool</source> <volume>22</volume>: <fpage>240</fpage>–<lpage>249</lpage>.</mixed-citation>
</ref>
<ref id="pgen.1004342-Felsenstein2"><label>7</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Felsenstein</surname><given-names>J</given-names></name> (<year>1981</year>) <article-title>Evolutionary trees from DNA sequences: a maximum likelihood approach</article-title>. <source>J Mol Evol</source> <volume>17</volume>: <fpage>368</fpage>–<lpage>376</lpage>.</mixed-citation>
</ref>
<ref id="pgen.1004342-Menozzi1"><label>8</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Menozzi</surname><given-names>P</given-names></name>, <name name-style="western"><surname>Piazza</surname><given-names>A</given-names></name>, <name name-style="western"><surname>Cavalli-Sforza</surname><given-names>L</given-names></name> (<year>1978</year>) <article-title>Synthetic maps of human gene frequencies in Europeans</article-title>. <source>Science</source> <volume>201</volume>: <fpage>786</fpage>–<lpage>792</lpage>.</mixed-citation>
</ref>
<ref id="pgen.1004342-Kingman1"><label>9</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Kingman</surname><given-names>J</given-names></name> (<year>1982</year>) <article-title>The coalescent</article-title>. <source>Stoch Process Appl</source> <volume>13</volume>: <fpage>235</fpage>–<lpage>248</lpage>.</mixed-citation>
</ref>
<ref id="pgen.1004342-Sawyer1"><label>10</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Sawyer</surname><given-names>SA</given-names></name>, <name name-style="western"><surname>Hartl</surname><given-names>DL</given-names></name> (<year>1992</year>) <article-title>Population genetics of polymorphism and divergence</article-title>. <source>Genetics</source> <volume>132</volume>: <fpage>1161</fpage>–<lpage>1176</lpage>.</mixed-citation>
</ref>
<ref id="pgen.1004342-Voight1"><label>11</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Voight</surname><given-names>BF</given-names></name>, <name name-style="western"><surname>Adams</surname><given-names>AM</given-names></name>, <name name-style="western"><surname>Frisse</surname><given-names>LA</given-names></name>, <name name-style="western"><surname>Qian</surname><given-names>Y</given-names></name>, <name name-style="western"><surname>Hudson</surname><given-names>RR</given-names></name>, <etal>et al</etal>. (<year>2005</year>) <article-title>Interrogating multiple aspects of variation in a full resequencing data set to infer human population size changes</article-title>. <source>Proc Natl Acad Sci USA</source> <volume>102</volume>: <fpage>18508</fpage>–<lpage>18513</lpage>.</mixed-citation>
</ref>
<ref id="pgen.1004342-Keightley1"><label>12</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Keightley</surname><given-names>PD</given-names></name>, <name name-style="western"><surname>Eyre-Walker</surname><given-names>A</given-names></name> (<year>2007</year>) <article-title>Joint inference of the distribution of fitness effects of deleterious mutations and population demography based on nucleotide polymorphism frequencies</article-title>. <source>Genetics</source> <volume>177</volume>: <fpage>2251</fpage>–<lpage>2261</lpage>.</mixed-citation>
</ref>
<ref id="pgen.1004342-Boyko1"><label>13</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Boyko</surname><given-names>AR</given-names></name>, <name name-style="western"><surname>Williamson</surname><given-names>SH</given-names></name>, <name name-style="western"><surname>Indap</surname><given-names>AR</given-names></name>, <name name-style="western"><surname>Degenhardt</surname><given-names>JD</given-names></name>, <name name-style="western"><surname>Hernandez</surname><given-names>RD</given-names></name>, <etal>et al</etal>. (<year>2008</year>) <article-title>Assessing the evolutionary impact of amino acid mutations in the human genome</article-title>. <source>PLoS Genet</source> <volume>4</volume>: <fpage>e1000083</fpage>.</mixed-citation>
</ref>
<ref id="pgen.1004342-Lawson1"><label>14</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Lawson</surname><given-names>DJ</given-names></name>, <name name-style="western"><surname>Hellenthal</surname><given-names>G</given-names></name>, <name name-style="western"><surname>Myers</surname><given-names>S</given-names></name>, <name name-style="western"><surname>Falush</surname><given-names>D</given-names></name> (<year>2012</year>) <article-title>Inference of population structure using dense haplotype data</article-title>. <source>PLoS Genet</source> <volume>8</volume>: <fpage>e1002453</fpage>.</mixed-citation>
</ref>
<ref id="pgen.1004342-Palamara1"><label>15</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Palamara</surname><given-names>PF</given-names></name>, <name name-style="western"><surname>Lencz</surname><given-names>T</given-names></name>, <name name-style="western"><surname>Darvasi</surname><given-names>A</given-names></name>, <name name-style="western"><surname>Pe'er</surname><given-names>I</given-names></name> (<year>2012</year>) <article-title>Length distributions of identity by descent reveal fine-scale demographic history</article-title>. <source>Am J Hum Genet</source> <volume>91</volume>: <fpage>809</fpage>–<lpage>822</lpage>.</mixed-citation>
</ref>
<ref id="pgen.1004342-Ralph1"><label>16</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Ralph</surname><given-names>P</given-names></name>, <name name-style="western"><surname>Coop</surname><given-names>G</given-names></name> (<year>2013</year>) <article-title>The geography of recent genetic ancestry across Europe</article-title>. <source>PLoS Biol</source> <volume>11</volume>: <fpage>e1001555</fpage>.</mixed-citation>
</ref>
<ref id="pgen.1004342-Harris1"><label>17</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Harris</surname><given-names>K</given-names></name>, <name name-style="western"><surname>Nielsen</surname><given-names>R</given-names></name> (<year>2013</year>) <article-title>Inferring demographic history from a spectrum of shared haplotype lengths</article-title>. <source>PLoS Genet</source> <volume>9</volume>: <fpage>e1003521</fpage>.</mixed-citation>
</ref>
<ref id="pgen.1004342-Hudson1"><label>18</label>
<mixed-citation publication-type="book" xlink:type="simple">Hudson RR (1991) Gene genealogies and the coalescent process. In: Futuyma D, Antonovics J, editors. Oxford Surveys in Evolutionary Biology, volume 7. pp. 1–44.</mixed-citation>
</ref>
<ref id="pgen.1004342-Griffiths1"><label>19</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Griffiths</surname><given-names>RC</given-names></name>, <name name-style="western"><surname>Marjoram</surname><given-names>P</given-names></name> (<year>1996</year>) <article-title>Ancestral inference from samples of DNA sequences with recombination</article-title>. <source>J Comput Biol</source> <volume>3</volume>: <fpage>479</fpage>–<lpage>502</lpage>.</mixed-citation>
</ref>
<ref id="pgen.1004342-Griffiths2"><label>20</label>
<mixed-citation publication-type="book" xlink:type="simple">Griffiths R, Marjoram P (1997) An ancestral recombination graph. In: Donnelly P, Tavaré S, editors, Progress in Population Genetics and Human Evolution. Springer Verlag. pp. 257–270.</mixed-citation>
</ref>
<ref id="pgen.1004342-Hudson2"><label>21</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Hudson</surname><given-names>RR</given-names></name> (<year>1983</year>) <article-title>Properties of a neutral allele model with intragenic recombination</article-title>. <source>Theor Popul Biol</source> <volume>23</volume>: <fpage>183</fpage>–<lpage>201</lpage>.</mixed-citation>
</ref>
<ref id="pgen.1004342-Fearnhead1"><label>22</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Fearnhead</surname><given-names>P</given-names></name>, <name name-style="western"><surname>Donnelly</surname><given-names>P</given-names></name> (<year>2001</year>) <article-title>Estimating recombination rates from population genetic data</article-title>. <source>Genetics</source> <volume>159</volume>: <fpage>1299</fpage>–<lpage>1318</lpage>.</mixed-citation>
</ref>
<ref id="pgen.1004342-Stephens1"><label>23</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Stephens</surname><given-names>M</given-names></name>, <name name-style="western"><surname>Donnelly</surname><given-names>P</given-names></name> (<year>2000</year>) <article-title>Inference in molecular population genetics</article-title>. <source>Journal of the Royal Statistical Society Series B (Statistical Methodology)</source> <volume>62</volume>: <fpage>605</fpage>–<lpage>655</lpage>.</mixed-citation>
</ref>
<ref id="pgen.1004342-Kuhner1"><label>24</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Kuhner</surname><given-names>MK</given-names></name>, <name name-style="western"><surname>Yamato</surname><given-names>J</given-names></name>, <name name-style="western"><surname>Felsenstein</surname><given-names>J</given-names></name> (<year>2000</year>) <article-title>Maximum likelihood estimation of recombination rates from population data</article-title>. <source>Genetics</source> <volume>156</volume>: <fpage>1393</fpage>–<lpage>1401</lpage>.</mixed-citation>
</ref>
<ref id="pgen.1004342-Nielsen1"><label>25</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Nielsen</surname><given-names>R</given-names></name> (<year>2000</year>) <article-title>Estimation of population parameters and recombination rates from single nucleotide polymorphisms</article-title>. <source>Genetics</source> <volume>154</volume>: <fpage>931</fpage>–<lpage>942</lpage>.</mixed-citation>
</ref>
<ref id="pgen.1004342-Kuhner2"><label>26</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Kuhner</surname><given-names>MK</given-names></name> (<year>2006</year>) <article-title>LAMARC 2.0: maximum likelihood and Bayesian estimation of population parameters</article-title>. <source>Bioinformatics</source> <volume>22</volume>: <fpage>768</fpage>–<lpage>770</lpage>.</mixed-citation>
</ref>
<ref id="pgen.1004342-OFallon1"><label>27</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>O'Fallon</surname><given-names>BD</given-names></name> (<year>2013</year>) <article-title>ACG: rapid inference of population history from recombining nucleotide sequences</article-title>. <source>BMC Bioinformatics</source> <volume>14</volume>: <fpage>40</fpage>.</mixed-citation>
</ref>
<ref id="pgen.1004342-Hein2"><label>28</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Hein</surname><given-names>J</given-names></name> (<year>1990</year>) <article-title>Reconstructing evolution of sequences subject to recombination using parsimony</article-title>. <source>Math Biosci</source> <volume>98</volume>: <fpage>185</fpage>–<lpage>200</lpage>.</mixed-citation>
</ref>
<ref id="pgen.1004342-Hein3"><label>29</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Hein</surname><given-names>J</given-names></name> (<year>1993</year>) <article-title>A heuristic method to reconstruct the history of sequences subject to recombination</article-title>. <source>J Mol Evol</source> <volume>36</volume>: <fpage>396</fpage>–<lpage>405</lpage>.</mixed-citation>
</ref>
<ref id="pgen.1004342-Kececioglu1"><label>30</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Kececioglu</surname><given-names>J</given-names></name>, <name name-style="western"><surname>Gusfield</surname><given-names>D</given-names></name> (<year>1998</year>) <article-title>Reconstructing a history of recombinations from a set of sequences</article-title>. <source>Discrete Applied Mathematics</source> <volume>88</volume>: <fpage>239</fpage>–<lpage>260</lpage>.</mixed-citation>
</ref>
<ref id="pgen.1004342-Wang1"><label>31</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Wang</surname><given-names>L</given-names></name>, <name name-style="western"><surname>Zhang</surname><given-names>K</given-names></name>, <name name-style="western"><surname>Zhang</surname><given-names>L</given-names></name> (<year>2001</year>) <article-title>Perfect phylogenetic networks with recombination</article-title>. <source>J Comput Biol</source> <volume>8</volume>: <fpage>69</fpage>–<lpage>78</lpage>.</mixed-citation>
</ref>
<ref id="pgen.1004342-Song1"><label>32</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Song</surname><given-names>YS</given-names></name>, <name name-style="western"><surname>Hein</surname><given-names>J</given-names></name> (<year>2005</year>) <article-title>Constructing minimal ancestral recombination graphs</article-title>. <source>J Comput Biol</source> <volume>12</volume>: <fpage>147</fpage>–<lpage>169</lpage>.</mixed-citation>
</ref>
<ref id="pgen.1004342-Song2"><label>33</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Song</surname><given-names>YS</given-names></name>, <name name-style="western"><surname>Wu</surname><given-names>Y</given-names></name>, <name name-style="western"><surname>Gusfield</surname><given-names>D</given-names></name> (<year>2005</year>) <article-title>Efficient computation of close lower and upper bounds on the minimum number of recombinations in biological sequence evolution</article-title>. <source>Bioinformatics</source> <volume>21 Suppl 1</volume>: <fpage>i413</fpage>–<lpage>422</lpage>.</mixed-citation>
</ref>
<ref id="pgen.1004342-Minichiello1"><label>34</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Minichiello</surname><given-names>MJ</given-names></name>, <name name-style="western"><surname>Durbin</surname><given-names>R</given-names></name> (<year>2006</year>) <article-title>Mapping trait loci by use of inferred ancestral recombination graphs</article-title>. <source>Am J Hum Genet</source> <volume>79</volume>: <fpage>910</fpage>–<lpage>922</lpage>.</mixed-citation>
</ref>
<ref id="pgen.1004342-Wu1"><label>35</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Wu</surname><given-names>Y</given-names></name> (<year>2009</year>) <article-title>New methods for inference of local tree topologies with recombinant SNP sequences in populations</article-title>. <source>IEEE/ACM Trans Comput Biol Bioinform</source> <volume>8</volume>: <fpage>182</fpage>–<lpage>193</lpage>.</mixed-citation>
</ref>
<ref id="pgen.1004342-Wiuf1"><label>36</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Wiuf</surname><given-names>C</given-names></name>, <name name-style="western"><surname>Hein</surname><given-names>J</given-names></name> (<year>1999</year>) <article-title>Recombination as a point process along sequences</article-title>. <source>Theor Popul Biol</source> <volume>55</volume>: <fpage>248</fpage>–<lpage>259</lpage>.</mixed-citation>
</ref>
<ref id="pgen.1004342-McVean1"><label>37</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>McVean</surname><given-names>GAT</given-names></name>, <name name-style="western"><surname>Cardin</surname><given-names>NJ</given-names></name> (<year>2005</year>) <article-title>Approximating the coalescent with recombination</article-title>. <source>Philos Trans R Soc Lond B Biol Sci</source> <volume>360</volume>: <fpage>1387</fpage>–<lpage>1393</lpage>.</mixed-citation>
</ref>
<ref id="pgen.1004342-Marjoram1"><label>38</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Marjoram</surname><given-names>P</given-names></name>, <name name-style="western"><surname>Wall</surname><given-names>JD</given-names></name> (<year>2006</year>) <article-title>Fast “coalescent” simulation</article-title>. <source>BMC Genet</source> <volume>7</volume>: <fpage>16</fpage>.</mixed-citation>
</ref>
<ref id="pgen.1004342-Hobolth1"><label>39</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Hobolth</surname><given-names>A</given-names></name>, <name name-style="western"><surname>Christensen</surname><given-names>OF</given-names></name>, <name name-style="western"><surname>Mailund</surname><given-names>T</given-names></name>, <name name-style="western"><surname>Schierup</surname><given-names>MH</given-names></name> (<year>2007</year>) <article-title>Genomic relationships and speciation times of human, chimpanzee, and gorilla inferred from a coalescent hidden Markov model</article-title>. <source>PLoS Genet</source> <volume>3</volume>: <fpage>e7</fpage>.</mixed-citation>
</ref>
<ref id="pgen.1004342-Mailund1"><label>40</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Mailund</surname><given-names>T</given-names></name>, <name name-style="western"><surname>Dutheil</surname><given-names>JY</given-names></name>, <name name-style="western"><surname>Hobolth</surname><given-names>A</given-names></name>, <name name-style="western"><surname>Lunter</surname><given-names>G</given-names></name>, <name name-style="western"><surname>Schierup</surname><given-names>MH</given-names></name> (<year>2011</year>) <article-title>Estimating divergence time and ancestral effective population size of Bornean and Sumatran orangutan subspecies using a coalescent hidden Markov model</article-title>. <source>PLoS Genet</source> <volume>7</volume>: <fpage>e1001319</fpage>.</mixed-citation>
</ref>
<ref id="pgen.1004342-Mailund2"><label>41</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Mailund</surname><given-names>T</given-names></name>, <name name-style="western"><surname>Halager</surname><given-names>AE</given-names></name>, <name name-style="western"><surname>Westergaard</surname><given-names>M</given-names></name>, <name name-style="western"><surname>Dutheil</surname><given-names>JY</given-names></name>, <name name-style="western"><surname>Munch</surname><given-names>K</given-names></name>, <etal>et al</etal>. (<year>2012</year>) <article-title>A new isolation with migration model along complete genomes infers very different divergence processes among closely related great ape species</article-title>. <source>PLoS Genet</source> <volume>8</volume>: <fpage>e1003125</fpage>.</mixed-citation>
</ref>
<ref id="pgen.1004342-Li1"><label>42</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Li</surname><given-names>H</given-names></name>, <name name-style="western"><surname>Durbin</surname><given-names>R</given-names></name> (<year>2011</year>) <article-title>Inference of human population history from individual whole-genome sequences</article-title>. <source>Nature</source> <volume>475</volume>: <fpage>493</fpage>–<lpage>496</lpage>.</mixed-citation>
</ref>
<ref id="pgen.1004342-Li2"><label>43</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Li</surname><given-names>N</given-names></name>, <name name-style="western"><surname>Stephens</surname><given-names>M</given-names></name> (<year>2003</year>) <article-title>Modeling linkage disequilibrium and identifying recombination hotspots using single-nucleotide polymorphism data</article-title>. <source>Genetics</source> <volume>165</volume>: <fpage>2213</fpage>–<lpage>2233</lpage>.</mixed-citation>
</ref>
<ref id="pgen.1004342-Stephens2"><label>44</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Stephens</surname><given-names>M</given-names></name>, <name name-style="western"><surname>Scheet</surname><given-names>P</given-names></name> (<year>2005</year>) <article-title>Accounting for decay of linkage disequilibrium in haplotype inference and missing-data imputation</article-title>. <source>Am J Hum Genet</source> <volume>76</volume>: <fpage>449</fpage>–<lpage>462</lpage>.</mixed-citation>
</ref>
<ref id="pgen.1004342-Marchini1"><label>45</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Marchini</surname><given-names>J</given-names></name>, <name name-style="western"><surname>Howie</surname><given-names>B</given-names></name>, <name name-style="western"><surname>Myers</surname><given-names>S</given-names></name>, <name name-style="western"><surname>McVean</surname><given-names>G</given-names></name>, <name name-style="western"><surname>Donnelly</surname><given-names>P</given-names></name> (<year>2007</year>) <article-title>A new multipoint method for genome-wide association studies by imputation of genotypes</article-title>. <source>Nat Genet</source> <volume>39</volume>: <fpage>906</fpage>–<lpage>913</lpage>.</mixed-citation>
</ref>
<ref id="pgen.1004342-Howie1"><label>46</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Howie</surname><given-names>BN</given-names></name>, <name name-style="western"><surname>Donnelly</surname><given-names>P</given-names></name>, <name name-style="western"><surname>Marchini</surname><given-names>J</given-names></name> (<year>2009</year>) <article-title>A flexible and accurate genotype imputation method for the next generation of genome-wide association studies</article-title>. <source>PLoS Genet</source> <volume>5</volume>: <fpage>e1000529</fpage>.</mixed-citation>
</ref>
<ref id="pgen.1004342-Price1"><label>47</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Price</surname><given-names>AL</given-names></name>, <name name-style="western"><surname>Tandon</surname><given-names>A</given-names></name>, <name name-style="western"><surname>Patterson</surname><given-names>N</given-names></name>, <name name-style="western"><surname>Barnes</surname><given-names>KC</given-names></name>, <name name-style="western"><surname>Rafaels</surname><given-names>N</given-names></name>, <etal>et al</etal>. (<year>2009</year>) <article-title>Sensitive detection of chromosomal segments of distinct ancestry in admixed populations</article-title>. <source>PLoS Genet</source> <volume>5</volume>: <fpage>e1000519</fpage>.</mixed-citation>
</ref>
<ref id="pgen.1004342-Li3"><label>48</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Li</surname><given-names>Y</given-names></name>, <name name-style="western"><surname>Willer</surname><given-names>CJ</given-names></name>, <name name-style="western"><surname>Ding</surname><given-names>J</given-names></name>, <name name-style="western"><surname>Scheet</surname><given-names>P</given-names></name>, <name name-style="western"><surname>Abecasis</surname><given-names>GR</given-names></name> (<year>2010</year>) <article-title>MaCH: using sequence and genotype data to estimate haplotypes and unobserved genotypes</article-title>. <source>Genet Epidemiol</source> <volume>34</volume>: <fpage>816</fpage>–<lpage>834</lpage>.</mixed-citation>
</ref>
<ref id="pgen.1004342-Paul1"><label>49</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Paul</surname><given-names>JS</given-names></name>, <name name-style="western"><surname>Song</surname><given-names>YS</given-names></name> (<year>2010</year>) <article-title>A principled approach to deriving approximate conditional sampling distributions in population genetics models with recombination</article-title>. <source>Genetics</source> <volume>186</volume>: <fpage>321</fpage>–<lpage>338</lpage>.</mixed-citation>
</ref>
<ref id="pgen.1004342-Paul2"><label>50</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Paul</surname><given-names>JS</given-names></name>, <name name-style="western"><surname>Steinrücken</surname><given-names>M</given-names></name>, <name name-style="western"><surname>Song</surname><given-names>YS</given-names></name> (<year>2011</year>) <article-title>An accurate sequentially Markov conditional sampling distribution for the coalescent with recombination</article-title>. <source>Genetics</source> <volume>187</volume>: <fpage>1115</fpage>–<lpage>1128</lpage>.</mixed-citation>
</ref>
<ref id="pgen.1004342-Sheehan1"><label>51</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Sheehan</surname><given-names>S</given-names></name>, <name name-style="western"><surname>Harris</surname><given-names>K</given-names></name>, <name name-style="western"><surname>Song</surname><given-names>YS</given-names></name> (<year>2013</year>) <article-title>Estimating variable effective population sizes from multiple genomes: a sequentially Markov conditional sampling distribution approach</article-title>. <source>Genetics</source> <volume>194</volume>: <fpage>647</fpage>–<lpage>662</lpage>.</mixed-citation>
</ref>
<ref id="pgen.1004342-Steinrucken1"><label>52</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Steinrucken</surname><given-names>M</given-names></name>, <name name-style="western"><surname>Paul</surname><given-names>JS</given-names></name>, <name name-style="western"><surname>Song</surname><given-names>YS</given-names></name> (<year>2013</year>) <article-title>A sequentially Markov conditional sampling distribution for structured populations with migration and recombination</article-title>. <source>Theor Popul Biol</source> <volume>87</volume>: <fpage>51</fpage>–<lpage>61</lpage>.</mixed-citation>
</ref>
<ref id="pgen.1004342-Jukes1"><label>53</label>
<mixed-citation publication-type="book" xlink:type="simple">Jukes TH, Cantor CR (1969) Evolution of protein molecules. In: Munro H, editor, Mammalian Protein Metabolism, New York: Academic Press. pp. 21–132.</mixed-citation>
</ref>
<ref id="pgen.1004342-Husmeier1"><label>54</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Husmeier</surname><given-names>D</given-names></name>, <name name-style="western"><surname>Wright</surname><given-names>F</given-names></name> (<year>2001</year>) <article-title>Detection of recombination in DNA multiple alignments with hidden Markov models</article-title>. <source>J Comput Biol</source> <volume>8</volume>: <fpage>401</fpage>–<lpage>427</lpage>.</mixed-citation>
</ref>
<ref id="pgen.1004342-Kong1"><label>55</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Kong</surname><given-names>A</given-names></name>, <name name-style="western"><surname>Gudbjartsson</surname><given-names>DF</given-names></name>, <name name-style="western"><surname>Sainz</surname><given-names>J</given-names></name>, <name name-style="western"><surname>Jonsdottir</surname><given-names>GM</given-names></name>, <name name-style="western"><surname>Gudjonsson</surname><given-names>SA</given-names></name>, <etal>et al</etal>. (<year>2002</year>) <article-title>A high-resolution recombination map of the human genome</article-title>. <source>Nat Genet</source> <volume>31</volume>: <fpage>241</fpage>–<lpage>247</lpage>.</mixed-citation>
</ref>
<ref id="pgen.1004342-Kong2"><label>56</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Kong</surname><given-names>A</given-names></name>, <name name-style="western"><surname>Frigge</surname><given-names>ML</given-names></name>, <name name-style="western"><surname>Masson</surname><given-names>G</given-names></name>, <name name-style="western"><surname>Besenbacher</surname><given-names>S</given-names></name>, <name name-style="western"><surname>Sulem</surname><given-names>P</given-names></name>, <etal>et al</etal>. (<year>2012</year>) <article-title>Rate of de novo mutations and the importance of father's age to disease risk</article-title>. <source>Nature</source> <volume>488</volume>: <fpage>471</fpage>–<lpage>475</lpage>.</mixed-citation>
</ref>
<ref id="pgen.1004342-Sun1"><label>57</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Sun</surname><given-names>JX</given-names></name>, <name name-style="western"><surname>Helgason</surname><given-names>A</given-names></name>, <name name-style="western"><surname>Masson</surname><given-names>G</given-names></name>, <name name-style="western"><surname>Ebenesersdottir</surname><given-names>SS</given-names></name>, <name name-style="western"><surname>Li</surname><given-names>H</given-names></name>, <etal>et al</etal>. (<year>2012</year>) <article-title>A direct characterization of human mutation based on microsatellites</article-title>. <source>Nat Genet</source> <volume>44</volume>: <fpage>1161</fpage>–<lpage>1165</lpage>.</mixed-citation>
</ref>
<ref id="pgen.1004342-Drmanac1"><label>58</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Drmanac</surname><given-names>R</given-names></name>, <name name-style="western"><surname>Sparks</surname><given-names>AB</given-names></name>, <name name-style="western"><surname>Callow</surname><given-names>MJ</given-names></name>, <name name-style="western"><surname>Halpern</surname><given-names>AL</given-names></name>, <name name-style="western"><surname>Burns</surname><given-names>NL</given-names></name>, <etal>et al</etal>. (<year>2010</year>) <article-title>Human genome sequencing using unchained base reads on self-assembling dna nanoarrays</article-title>. <source>Science</source> <volume>327</volume>: <fpage>78</fpage>–<lpage>81</lpage>.</mixed-citation>
</ref>
<ref id="pgen.1004342-Delaneau1"><label>59</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Delaneau</surname><given-names>O</given-names></name>, <name name-style="western"><surname>Zagury</surname><given-names>JF</given-names></name>, <name name-style="western"><surname>Marchini</surname><given-names>J</given-names></name> (<year>2013</year>) <article-title>Improved whole-chromosome phasing for disease and population genetic studies</article-title>. <source>Nat Methods</source> <volume>10</volume>: <fpage>5</fpage>–<lpage>6</lpage>.</mixed-citation>
</ref>
<ref id="pgen.1004342-McVicker1"><label>60</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>McVicker</surname><given-names>G</given-names></name>, <name name-style="western"><surname>Gordon</surname><given-names>D</given-names></name>, <name name-style="western"><surname>Davis</surname><given-names>C</given-names></name>, <name name-style="western"><surname>Green</surname><given-names>P</given-names></name> (<year>2009</year>) <article-title>Widespread genomic signatures of natural selection in hominid evolution</article-title>. <source>PLoS Genet</source> <volume>5</volume>: <fpage>e1000471</fpage>.</mixed-citation>
</ref>
<ref id="pgen.1004342-Cai1"><label>61</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Cai</surname><given-names>JJ</given-names></name>, <name name-style="western"><surname>Macpherson</surname><given-names>JM</given-names></name>, <name name-style="western"><surname>Sella</surname><given-names>G</given-names></name>, <name name-style="western"><surname>Petrov</surname><given-names>DA</given-names></name> (<year>2009</year>) <article-title>Pervasive hitchhiking at coding and regulatory sites in humans</article-title>. <source>PLoS Genet</source> <volume>5</volume>: <fpage>e1000336</fpage>.</mixed-citation>
</ref>
<ref id="pgen.1004342-Hernandez1"><label>62</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Hernandez</surname><given-names>RD</given-names></name>, <name name-style="western"><surname>Kelley</surname><given-names>JL</given-names></name>, <name name-style="western"><surname>Elyashiv</surname><given-names>E</given-names></name>, <name name-style="western"><surname>Melton</surname><given-names>SC</given-names></name>, <name name-style="western"><surname>Auton</surname><given-names>A</given-names></name>, <etal>et al</etal>. (<year>2011</year>) <article-title>Classic selective sweeps were rare in recent human evolution</article-title>. <source>Science</source> <volume>331</volume>: <fpage>920</fpage>–<lpage>924</lpage>.</mixed-citation>
</ref>
<ref id="pgen.1004342-Gottipati1"><label>63</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Gottipati</surname><given-names>S</given-names></name>, <name name-style="western"><surname>Arbiza</surname><given-names>L</given-names></name>, <name name-style="western"><surname>Siepel</surname><given-names>A</given-names></name>, <name name-style="western"><surname>Clark</surname><given-names>AG</given-names></name>, <name name-style="western"><surname>Keinan</surname><given-names>A</given-names></name> (<year>2011</year>) <article-title>Analyses of X-linked and autosomal genetic variation in population-scale whole genome sequencing</article-title>. <source>Nat Genet</source> <volume>43</volume>: <fpage>741</fpage>–<lpage>743</lpage>.</mixed-citation>
</ref>
<ref id="pgen.1004342-Lohmueller1"><label>64</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Lohmueller</surname><given-names>KE</given-names></name>, <name name-style="western"><surname>Albrechtsen</surname><given-names>A</given-names></name>, <name name-style="western"><surname>Li</surname><given-names>Y</given-names></name>, <name name-style="western"><surname>Kim</surname><given-names>SY</given-names></name>, <name name-style="western"><surname>Korneliussen</surname><given-names>T</given-names></name>, <etal>et al</etal>. (<year>2011</year>) <article-title>Natural selection affects multiple aspects of genetic variation at putatively neutral sites across the human genome</article-title>. <source>PLoS Genet</source> <volume>7</volume>: <fpage>e1002326</fpage>.</mixed-citation>
</ref>
<ref id="pgen.1004342-Charlesworth1"><label>65</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Charlesworth</surname><given-names>B</given-names></name>, <name name-style="western"><surname>Morgan</surname><given-names>MT</given-names></name>, <name name-style="western"><surname>Charlesworth</surname><given-names>D</given-names></name> (<year>1993</year>) <article-title>The effect of deleterious mutations on neutral molecular variation</article-title>. <source>Genetics</source> <volume>134</volume>: <fpage>1289</fpage>–<lpage>1303</lpage>.</mixed-citation>
</ref>
<ref id="pgen.1004342-Hudson3"><label>66</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Hudson</surname><given-names>RR</given-names></name>, <name name-style="western"><surname>Kaplan</surname><given-names>NL</given-names></name> (<year>1995</year>) <article-title>Deleterious background selection with recombination</article-title>. <source>Genetics</source> <volume>141</volume>: <fpage>1605</fpage>–<lpage>1617</lpage>.</mixed-citation>
</ref>
<ref id="pgen.1004342-Nordborg1"><label>67</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Nordborg</surname><given-names>M</given-names></name>, <name name-style="western"><surname>Charlesworth</surname><given-names>B</given-names></name>, <name name-style="western"><surname>Charlesworth</surname><given-names>D</given-names></name> (<year>1996</year>) <article-title>The effect of recombination on background selection</article-title>. <source>Genet Res</source> <volume>67</volume>: <fpage>159</fpage>–<lpage>174</lpage>.</mixed-citation>
</ref>
<ref id="pgen.1004342-Charlesworth2"><label>68</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Charlesworth</surname><given-names>B</given-names></name> (<year>2012</year>) <article-title>The effects of deleterious mutations on evolution at linked sites</article-title>. <source>Genetics</source> <volume>190</volume>: <fpage>5</fpage>–<lpage>22</lpage>.</mixed-citation>
</ref>
<ref id="pgen.1004342-MaynardSmith1"><label>69</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Maynard Smith</surname><given-names>J</given-names></name>, <name name-style="western"><surname>Haigh</surname><given-names>J</given-names></name> (<year>1974</year>) <article-title>The hitch-hiking effect of a favourable gene</article-title>. <source>Genet Res</source> <volume>23</volume>: <fpage>23</fpage>–<lpage>35</lpage>.</mixed-citation>
</ref>
<ref id="pgen.1004342-Barton1"><label>70</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Barton</surname><given-names>NH</given-names></name> (<year>1998</year>) <article-title>The effect of hitch-hiking on neutral genealogies</article-title>. <source>Genet Res</source> <volume>72</volume>: <fpage>123</fpage>–<lpage>133</lpage>.</mixed-citation>
</ref>
<ref id="pgen.1004342-Walczak1"><label>71</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Walczak</surname><given-names>AM</given-names></name>, <name name-style="western"><surname>Nicolaisen</surname><given-names>LE</given-names></name>, <name name-style="western"><surname>Plotkin</surname><given-names>JB</given-names></name>, <name name-style="western"><surname>Desai</surname><given-names>MM</given-names></name> (<year>2012</year>) <article-title>The structure of genealogies in the presence of purifying selection: a fitness-class coalescent</article-title>. <source>Genetics</source> <volume>190</volume>: <fpage>753</fpage>–<lpage>779</lpage>.</mixed-citation>
</ref>
<ref id="pgen.1004342-Voight2"><label>72</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Voight</surname><given-names>BF</given-names></name>, <name name-style="western"><surname>Kudaravalli</surname><given-names>S</given-names></name>, <name name-style="western"><surname>Wen</surname><given-names>X</given-names></name>, <name name-style="western"><surname>Pritchard</surname><given-names>JK</given-names></name> (<year>2006</year>) <article-title>A map of recent positive selection in the human genome</article-title>. <source>PLoS Biol</source> <volume>4</volume>: <fpage>e72</fpage>.</mixed-citation>
</ref>
<ref id="pgen.1004342-Hughes1"><label>73</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Hughes</surname><given-names>AL</given-names></name>, <name name-style="western"><surname>Nei</surname><given-names>M</given-names></name> (<year>1988</year>) <article-title>Pattern of nucleotide substitution at major histocompatibility complex class I loci reveals overdominant selection</article-title>. <source>Nature</source> <volume>335</volume>: <fpage>167</fpage>–<lpage>170</lpage>.</mixed-citation>
</ref>
<ref id="pgen.1004342-Apanius1"><label>74</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Apanius</surname><given-names>V</given-names></name>, <name name-style="western"><surname>Penn</surname><given-names>D</given-names></name>, <name name-style="western"><surname>Slev</surname><given-names>PR</given-names></name>, <name name-style="western"><surname>Ruff</surname><given-names>LR</given-names></name>, <name name-style="western"><surname>Potts</surname><given-names>WK</given-names></name> (<year>1997</year>) <article-title>The nature of selection on the major histocompatibility complex</article-title>. <source>Crit Rev Immunol</source> <volume>17</volume>: <fpage>179</fpage>–<lpage>224</lpage>.</mixed-citation>
</ref>
<ref id="pgen.1004342-Hughes2"><label>75</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Hughes</surname><given-names>AL</given-names></name>, <name name-style="western"><surname>Yeager</surname><given-names>M</given-names></name> (<year>1998</year>) <article-title>Natural selection at major histocompatibility complex loci of vertebrates</article-title>. <source>Annu Rev Genet</source> <volume>32</volume>: <fpage>415</fpage>–<lpage>435</lpage>.</mixed-citation>
</ref>
<ref id="pgen.1004342-Hodgkinson1"><label>76</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Hodgkinson</surname><given-names>A</given-names></name>, <name name-style="western"><surname>Eyre-Walker</surname><given-names>A</given-names></name> (<year>2010</year>) <article-title>The genomic distribution and local context of coincident SNPs in human and chimpanzee</article-title>. <source>Genome Biol Evol</source> <volume>2</volume>: <fpage>547</fpage>–<lpage>557</lpage>.</mixed-citation>
</ref>
<ref id="pgen.1004342-Leffler1"><label>77</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Leffler</surname><given-names>EM</given-names></name>, <name name-style="western"><surname>Ziyue</surname><given-names>G</given-names></name>, <name name-style="western"><surname>Pfeifer</surname><given-names>S</given-names></name>, <name name-style="western"><surname>Segurel</surname><given-names>L</given-names></name>, <name name-style="western"><surname>Auton</surname><given-names>A</given-names></name>, <etal>et al</etal>. (<year>2013</year>) <article-title>Multiple instances of ancient balancing selection shared between humans and chimpanzees</article-title>. <source>Science</source> <volume>339</volume>: <fpage>1578</fpage>–<lpage>1582</lpage>.</mixed-citation>
</ref>
<ref id="pgen.1004342-Maruyama1"><label>78</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Maruyama</surname><given-names>T</given-names></name> (<year>1974</year>) <article-title>The age of a rare mutant gene in a large population</article-title>. <source>Am J Hum Genet</source> <volume>26</volume>: <fpage>669</fpage>–<lpage>673</lpage>.</mixed-citation>
</ref>
<ref id="pgen.1004342-Kiezun1"><label>79</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Kiezun</surname><given-names>A</given-names></name>, <name name-style="western"><surname>Pulit</surname><given-names>SL</given-names></name>, <name name-style="western"><surname>Francioli</surname><given-names>LC</given-names></name>, <name name-style="western"><surname>van Dijk</surname><given-names>F</given-names></name>, <name name-style="western"><surname>Swertz</surname><given-names>M</given-names></name>, <etal>et al</etal>. (<year>2013</year>) <article-title>Deleterious alleles in the human genome are on average younger than neutral alleles of the same frequency</article-title>. <source>PLoS Genet</source> <volume>9</volume>: <fpage>e1003301</fpage>.</mixed-citation>
</ref>
<ref id="pgen.1004342-Hill1"><label>80</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Hill</surname><given-names>WG</given-names></name>, <name name-style="western"><surname>Robertson</surname><given-names>A</given-names></name> (<year>1966</year>) <article-title>The effect of linkage on limits to artificial selection</article-title>. <source>Genet Res</source> <volume>8</volume>: <fpage>269</fpage>–<lpage>294</lpage>.</mixed-citation>
</ref>
<ref id="pgen.1004342-Karlin1"><label>81</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Karlin</surname><given-names>S</given-names></name>, <name name-style="western"><surname>McGregor</surname><given-names>J</given-names></name> (<year>1968</year>) <article-title>Rates and probabilities of fixation for two locus random mating finite populations without selection</article-title>. <source>Genetics</source> <volume>58</volume>: <fpage>141</fpage>–<lpage>159</lpage>.</mixed-citation>
</ref>
<ref id="pgen.1004342-Strobeck1"><label>82</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Strobeck</surname><given-names>C</given-names></name>, <name name-style="western"><surname>Morgan</surname><given-names>K</given-names></name> (<year>1978</year>) <article-title>The effect of intragenic recombination on the number of alleles in a finite population</article-title>. <source>Genetics</source> <volume>88</volume>: <fpage>829</fpage>–<lpage>844</lpage>.</mixed-citation>
</ref>
<ref id="pgen.1004342-Griffiths3"><label>83</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Griffiths</surname><given-names>RC</given-names></name> (<year>1981</year>) <article-title>Neutral two-locus multiple allele models with recombination</article-title>. <source>Theor Popul Biol</source> <volume>19</volume>: <fpage>169</fpage>–<lpage>186</lpage>.</mixed-citation>
</ref>
<ref id="pgen.1004342-Rannala1"><label>84</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Rannala</surname><given-names>B</given-names></name>, <name name-style="western"><surname>Reeve</surname><given-names>JP</given-names></name> (<year>2001</year>) <article-title>High-resolution multipoint linkage-disequilibrium mapping in the context of a human genome sequence</article-title>. <source>Am J Hum Genet</source> <volume>69</volume>: <fpage>159</fpage>–<lpage>178</lpage>.</mixed-citation>
</ref>
<ref id="pgen.1004342-Larribe1"><label>85</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Larribe</surname><given-names>F</given-names></name>, <name name-style="western"><surname>Lessard</surname><given-names>S</given-names></name>, <name name-style="western"><surname>Schork</surname><given-names>NJ</given-names></name> (<year>2002</year>) <article-title>Gene mapping via the ancestral recombination graph</article-title>. <source>Theor Popul Biol</source> <volume>62</volume>: <fpage>215</fpage>–<lpage>229</lpage>.</mixed-citation>
</ref>
<ref id="pgen.1004342-Zollner1"><label>86</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Zollner</surname><given-names>S</given-names></name>, <name name-style="western"><surname>Pritchard</surname><given-names>JK</given-names></name> (<year>2005</year>) <article-title>Coalescent-based association mapping and fine mapping of complex trait loci</article-title>. <source>Genetics</source> <volume>169</volume>: <fpage>1071</fpage>–<lpage>1092</lpage>.</mixed-citation>
</ref>
<ref id="pgen.1004342-Wu2"><label>87</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Wu</surname><given-names>Y</given-names></name> (<year>2008</year>) <article-title>Association mapping of complex diseases with ancestral recombination graphs: models and efficient algorithms</article-title>. <source>J Comput Biol</source> <volume>15</volume>: <fpage>667</fpage>–<lpage>684</lpage>.</mixed-citation>
</ref>
<ref id="pgen.1004342-Besenbacher1"><label>88</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Besenbacher</surname><given-names>S</given-names></name>, <name name-style="western"><surname>Mailund</surname><given-names>T</given-names></name>, <name name-style="western"><surname>Schierup</surname><given-names>MH</given-names></name> (<year>2009</year>) <article-title>Local phylogeny mapping of quantitative traits: higher accuracy and better ranking than single-marker association in genomewide scans</article-title>. <source>Genetics</source> <volume>181</volume>: <fpage>747</fpage>–<lpage>753</lpage>.</mixed-citation>
</ref>
<ref id="pgen.1004342-PradoMartinez1"><label>89</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Prado-Martinez</surname><given-names>J</given-names></name>, <name name-style="western"><surname>Sudmant</surname><given-names>PH</given-names></name>, <name name-style="western"><surname>Kidd</surname><given-names>JM</given-names></name>, <name name-style="western"><surname>Li</surname><given-names>H</given-names></name>, <name name-style="western"><surname>Kelley</surname><given-names>JL</given-names></name>, <etal>et al</etal>. (<year>2013</year>) <article-title>Great ape genetic diversity and population history</article-title>. <source>Nature</source> <volume>499</volume>: <fpage>471</fpage>–<lpage>475</lpage>.</mixed-citation>
</ref>
<ref id="pgen.1004342-Than1"><label>90</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Than</surname><given-names>C</given-names></name>, <name name-style="western"><surname>Nakhleh</surname><given-names>L</given-names></name> (<year>2009</year>) <article-title>Species tree inference by minimizing deep coalescences</article-title>. <source>PLoS Comput Biol</source> <volume>5</volume>: <fpage>e1000501</fpage>.</mixed-citation>
</ref>
<ref id="pgen.1004342-Yu1"><label>91</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Yu</surname><given-names>Y</given-names></name>, <name name-style="western"><surname>Barnett</surname><given-names>RM</given-names></name>, <name name-style="western"><surname>Nakhleh</surname><given-names>L</given-names></name> (<year>2013</year>) <article-title>Parsimonious inference of hybridization in the presence of incomplete lineage sorting</article-title>. <source>Syst Biol</source> <volume>62</volume>: <fpage>738</fpage>–<lpage>751</lpage>.</mixed-citation>
</ref>
<ref id="pgen.1004342-Gronau1"><label>92</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Gronau</surname><given-names>I</given-names></name>, <name name-style="western"><surname>Hubisz</surname><given-names>MJ</given-names></name>, <name name-style="western"><surname>Gulko</surname><given-names>B</given-names></name>, <name name-style="western"><surname>Danko</surname><given-names>CG</given-names></name>, <name name-style="western"><surname>Siepel</surname><given-names>A</given-names></name> (<year>2011</year>) <article-title>Bayesian inference of ancient human demography from individual genome sequences</article-title>. <source>Nature Genetics</source> <volume>43</volume>: <fpage>1031</fpage>–<lpage>1034</lpage>.</mixed-citation>
</ref>
<ref id="pgen.1004342-Tang1"><label>93</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Tang</surname><given-names>H</given-names></name>, <name name-style="western"><surname>Coram</surname><given-names>M</given-names></name>, <name name-style="western"><surname>Wang</surname><given-names>P</given-names></name>, <name name-style="western"><surname>Zhu</surname><given-names>X</given-names></name>, <name name-style="western"><surname>Risch</surname><given-names>N</given-names></name> (<year>2006</year>) <article-title>Reconstructing genetic ancestry blocks in admixed individuals</article-title>. <source>Am J Hum Genet</source> <volume>79</volume>: <fpage>1</fpage>–<lpage>12</lpage>.</mixed-citation>
</ref>
<ref id="pgen.1004342-Sankararaman1"><label>94</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Sankararaman</surname><given-names>S</given-names></name>, <name name-style="western"><surname>Sridhar</surname><given-names>S</given-names></name>, <name name-style="western"><surname>Kimmel</surname><given-names>G</given-names></name>, <name name-style="western"><surname>Halperin</surname><given-names>E</given-names></name> (<year>2008</year>) <article-title>Estimating local ancestry in admixed populations</article-title>. <source>Am J Hum Genet</source> <volume>82</volume>: <fpage>290</fpage>–<lpage>303</lpage>.</mixed-citation>
</ref>
<ref id="pgen.1004342-Scheet1"><label>95</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Scheet</surname><given-names>P</given-names></name>, <name name-style="western"><surname>Stephens</surname><given-names>M</given-names></name> (<year>2006</year>) <article-title>A fast and flexible statistical model for large-scale population genotype data: applications to inferring missing genotypes and haplotypic phase</article-title>. <source>Am J Hum Genet</source> <volume>78</volume>: <fpage>629</fpage>–<lpage>644</lpage>.</mixed-citation>
</ref>
<ref id="pgen.1004342-Browning1"><label>96</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Browning</surname><given-names>SR</given-names></name>, <name name-style="western"><surname>Browning</surname><given-names>BL</given-names></name> (<year>2007</year>) <article-title>Rapid and accurate haplotype phasing and missing-data inference for whole-genome association studies by use of localized haplotype clustering</article-title>. <source>Am J Hum Genet</source> <volume>81</volume>: <fpage>1084</fpage>–<lpage>1097</lpage>.</mixed-citation>
</ref>
<ref id="pgen.1004342-McVean2"><label>97</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>McVean</surname><given-names>GA</given-names></name>, <name name-style="western"><surname>Myers</surname><given-names>SR</given-names></name>, <name name-style="western"><surname>Hunt</surname><given-names>S</given-names></name>, <name name-style="western"><surname>Deloukas</surname><given-names>P</given-names></name>, <name name-style="western"><surname>Bentley</surname><given-names>DR</given-names></name>, <etal>et al</etal>. (<year>2004</year>) <article-title>The fine-scale structure of recombination rate variation in the human genome</article-title>. <source>Science</source> <volume>304</volume>: <fpage>581</fpage>–<lpage>584</lpage>.</mixed-citation>
</ref>
<ref id="pgen.1004342-Hobolth2"><label>98</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Hobolth</surname><given-names>A</given-names></name>, <name name-style="western"><surname>Jensen</surname><given-names>JL</given-names></name> (<year>2014</year>) <article-title>Markovian approximation to the finite loci coalescent with recombination along multiple sequences</article-title>. <source>Theor Popul Biol</source> <volume>2014</volume>: <fpage>S0040</fpage>–<lpage>5809</lpage> <comment>doi:<ext-link ext-link-type="uri" xlink:href="http://dx.doi.org/10.1016/j.tpb.2014.01.002" xlink:type="simple">10.1016/j.tpb.2014.01.002</ext-link></comment></mixed-citation>
</ref>
<ref id="pgen.1004342-Wu3"><label>99</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Wu</surname><given-names>Y</given-names></name>, <name name-style="western"><surname>Gusfield</surname><given-names>D</given-names></name> (<year>2007</year>) <article-title>Efficient computation of minimum recombination with genotypes (not haplotypes)</article-title>. <source>Journal of Bioinformatics and Computational Biology</source> <fpage>181</fpage>–<lpage>200</lpage>.</mixed-citation>
</ref>
<ref id="pgen.1004342-Tavare1"><label>100</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Tavare</surname><given-names>S</given-names></name> (<year>1984</year>) <article-title>Line-of-descent and genealogical processes, and their applications in population genetics models</article-title>. <source>Theor Popul Biol</source> <volume>26</volume>: <fpage>119</fpage>–<lpage>164</lpage>.</mixed-citation>
</ref>
<ref id="pgen.1004342-Siepel1"><label>101</label>
<mixed-citation publication-type="book" xlink:type="simple">Siepel A, Haussler D (2005) Phylogenetic hidden Markov models. In: Nielsen R, editor, Statistical Methods in Molecular Evolution, New York: Springer. pp. 325–351.</mixed-citation>
</ref>
<ref id="pgen.1004342-Rabiner1"><label>102</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Rabiner</surname><given-names>LR</given-names></name> (<year>1989</year>) <article-title>A tutorial on hidden Markov models and selected applications in speech recognition</article-title>. <source>Proceedings of the IEEE</source> <volume>77</volume>: <fpage>257</fpage>–<lpage>286</lpage>.</mixed-citation>
</ref>
<ref id="pgen.1004342-Durbin1"><label>103</label>
<mixed-citation publication-type="book" xlink:type="simple">Durbin R, Eddy S, Krogh A, Mitchison G (1998) Biological Sequence Analysis: Probabilistic Models of Proteins and Nucleic Acids. Cambridge, UK: Cambridge University Press.</mixed-citation>
</ref>
<ref id="pgen.1004342-Cawley1"><label>104</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Cawley</surname><given-names>SL</given-names></name>, <name name-style="western"><surname>Pachter</surname><given-names>L</given-names></name> (<year>2003</year>) <article-title>HMM sampling and applications to gene finding and alternative splicing</article-title>. <source>Bioinformatics</source> <volume>19 Suppl 2</volume>: <fpage>II36</fpage>–<lpage>II41</lpage>.</mixed-citation>
</ref>
<ref id="pgen.1004342-Zhu1"><label>105</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Zhu</surname><given-names>J</given-names></name>, <name name-style="western"><surname>Liu</surname><given-names>JS</given-names></name>, <name name-style="western"><surname>Lawrence</surname><given-names>CE</given-names></name> (<year>1998</year>) <article-title>Bayesian adaptive sequence alignment algorithms</article-title>. <source>Bioinformatics</source> <volume>14</volume>: <fpage>25</fpage>–<lpage>39</lpage>.</mixed-citation>
</ref>
<ref id="pgen.1004342-International1"><label>106</label>
<mixed-citation publication-type="journal" xlink:type="simple"><collab xlink:type="simple">International HapMap Consortium</collab> (<year>2007</year>) <name name-style="western"><surname>Frazer</surname><given-names>KA</given-names></name>, <name name-style="western"><surname>Ballinger</surname><given-names>DG</given-names></name>, <name name-style="western"><surname>Cox</surname><given-names>DR</given-names></name>, <name name-style="western"><surname>Hinds</surname><given-names>DA</given-names></name>, <etal>et al</etal>. (<year>2007</year>) <article-title>A second generation human haplotype map of over 3.1 million snps</article-title>. <source>Nature</source> <volume>449</volume>: <fpage>851</fpage>–<lpage>861</lpage>.</mixed-citation>
</ref>
<ref id="pgen.1004342-Gronau2"><label>107</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Gronau</surname><given-names>I</given-names></name>, <name name-style="western"><surname>Arbiza</surname><given-names>L</given-names></name>, <name name-style="western"><surname>Mohammed</surname><given-names>J</given-names></name>, <name name-style="western"><surname>Siepel</surname><given-names>A</given-names></name> (<year>2013</year>) <article-title>Inference of natural selection from interspersed genomic elements based on polymorphism and divergence</article-title>. <source>Mol Biol Evol</source> <volume>30</volume>: <fpage>1159</fpage>–<lpage>1171</lpage>.</mixed-citation>
</ref>
<ref id="pgen.1004342-Robinson1"><label>108</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Robinson</surname><given-names>DF</given-names></name>, <name name-style="western"><surname>Foulds</surname><given-names>LR</given-names></name> (<year>1981</year>) <article-title>Comparison of phylogenetic trees</article-title>. <source>Mathematical Biosciences</source> <volume>53</volume>: <fpage>131</fpage>–<lpage>147</lpage>.</mixed-citation>
</ref>
<ref id="pgen.1004342-Arbiza1"><label>109</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Arbiza</surname><given-names>L</given-names></name>, <name name-style="western"><surname>Gronau</surname><given-names>I</given-names></name>, <name name-style="western"><surname>Aksoy</surname><given-names>BA</given-names></name>, <name name-style="western"><surname>Hubisz</surname><given-names>MJ</given-names></name>, <name name-style="western"><surname>Gulko</surname><given-names>B</given-names></name>, <etal>et al</etal>. (<year>2013</year>) <article-title>Genome-wide inference of natural selection on human transcription factor binding sites</article-title>. <source>Nat Genet</source> <volume>45</volume>: <fpage>723</fpage>–<lpage>729</lpage>.</mixed-citation>
</ref>
</ref-list></back>
</article>